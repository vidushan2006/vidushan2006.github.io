<!DOCTYPE HTML>
<html>
<head>
  <title>VIDU</title>
  <!-- OPTIMIZATION: Corrected charset from utf--8 to utf-8 for proper text rendering. -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <!-- OPTIMIZATION: Added preconnect links. This tells the browser to start establishing a connection to these domains early, speeding up resource loading (fonts, thumbnails, YouTube API). -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.youtube.com">
  <link rel="preconnect" href="https://i.ytimg.com">
  <link rel="preconnect" href="https://i.pinimg.com">
  
  <link rel="stylesheet" href="assets/css/main.css" />
  <!-- OPTIMIZATION: The 'display=swap' parameter ensures that text remains visible while the custom font is loading, improving perceived performance. -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-overlay: rgba(4,6,12,0.46);
      --glass: rgba(255,255,255,0.04);
      --glass-strong: rgba(255,255,255,0.06);
      --accent-1: #7b61ff;
      --accent-2: #39ff14; /* green for seek/volume fill / thumb */
      --accent-3: #ff6b6b;
      --muted: #bfc8dd;
      --text: #f2f6ff;
      --card-radius: 10px;
      --ease: cubic-bezier(.16,.84,.24,1);
    }

    body{
      background: url('assets/images/background.png') no-repeat center center fixed;
      background-size: cover;
      background-color: #04060c; /* Fallback color */
      font-family:"Inter","Helvetica Neue",Arial,sans-serif;
      color:var(--text);
      margin:0;
      min-height:100vh;
      position:relative;
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    body::before{
      content:'';
      position:fixed;
      inset:0;
      background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.38));
      pointer-events:none;
      z-index:0;
    }

    #wrapper{position:relative;z-index:3;padding-bottom:48px;}

    header#header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 22px;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      z-index: 10;
      position: sticky;
      top: 12px;
      width: 100%;
      max-width: 750px;
      margin: 0 auto;
      box-shadow: 0 8px 30px rgba(2, 4, 12, 0.5);
    }

    .header-right-controls {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text);user-select:none;position:relative;}
    .logo-circle{width: clamp(72px, 9vw, 120px);aspect-ratio:1/1;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background: rgba(255,255,255,0.03);border: 10px solid rgba(255,255,255,0.06);box-shadow: 0 10px 24px rgba(0,0,0,0.4);transform: translateZ(0);flex-shrink:0;}
    .logo-circle img{width:100%;height:100%;object-fit:cover;object-position:center center;display:block;transform: translateZ(0);}

    nav ul{list-style:none;margin:0;padding:0;display:flex;gap:10px;align-items:center;}
    
    nav ul li a {
      font-weight: 700;
      font-size: 14px;
      position: relative;
      padding: 8px 16px;
      color: var(--accent-2);
      text-decoration: none;
      border-radius: 8px;
      transition: all .18s var(--ease);
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(57, 255, 20, 0.08);
      border: 1px solid rgba(57, 255, 20, 0.25);
      text-shadow: 0 0 10px rgba(57, 255, 20, 0.4);
      box-shadow: inset 0 0 12px rgba(57, 255, 20, 0.15);
    }

    nav ul li a:hover {
      color: #fff;
      transform: translateY(-3px) scale(1.03);
      background: rgba(57, 255, 20, 0.15);
      border-color: rgba(57, 255, 20, 0.5);
      box-shadow: inset 0 0 12px rgba(57, 255, 20, 0.3), 0 0 20px rgba(57, 255, 20, 0.3);
    }
    
    header nav ul li a::after,
    .logo::after{
      content: "";
      position: absolute;
      inset: -4px;
      border-radius: 12px;
      border: 1px solid transparent;
      opacity: 0.75;
      z-index: -1;
      pointer-events: none;
      transition: border-color .18s ease;
    }
    header nav ul li a:hover::after,
    .logo:hover::after{
      border-color: rgba(57,190,60,0.38);
    }

    .wrapper.style1{padding-top:12px;}
    .inner{max-width:1100px;margin:0 auto;padding:20px;position:relative;z-index:3;}

    .list-container{list-style:none;padding:0;display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;align-items:flex-start;margin-top:6px;}
    .list-item{
      width:150px;
      cursor:pointer;
      text-align:center;
      background:rgba(18, 20, 28, 0.5);
      border-radius:var(--card-radius);
      padding:10px;
      transition:transform .25s var(--ease),box-shadow .25s var(--ease); 
      border:1px solid rgba(255,255,255,0.06); 
      box-shadow:0 8px 24px rgba(6,8,16,0.5);
      position:relative;
      will-change:transform, opacity;
      /* OPTIMIZATION: Isolates the rendering of this element, telling the browser its contents won't affect the rest of the page layout. This can speed up rendering. */
      contain: content;
    }

    .list-item::after{content:'';position:absolute;left:8px;right:8px;bottom:8px;height:4px;border-radius:4px;background:linear-gradient(90deg, rgba(123,97,255,0.25), rgba(57,255,20,0.18), rgba(255,107,107,0.12));opacity:0;transform:translateY(6px);transition:opacity .25s var(--ease),transform .25s var(--ease);pointer-events:none;}
    .list-item:hover::after{opacity:1;transform:translateY(0);}
    .list-item:hover{transform: translateY(-6px) scale(1.02); box-shadow:0 16px 32px rgba(6,8,16,0.6);}
    .list-item img{width:100%;border-radius:6px;display:block;transition:transform .4s var(--ease);box-shadow:0 8px 20px rgba(0,0,0,0.4);will-change:transform;background:rgba(0,0,0,0.1);}
    .list-item:hover img{transform:scale(1.04);}

    .list-item .title{display:block;margin-top:0.45rem;color:var(--text);font-weight:700;font-size:14px;text-shadow:0 1px 0 rgba(0,0,0,0.45);}

    .modal-backdrop{position:fixed;inset:0;background:linear-gradient(180deg, rgba(2,3,8,0.6), rgba(0,0,0,0.75));display:flex;align-items:center;justify-content:center;z-index:9999;}
    .modal{width:min(960px,95%);background:linear-gradient(180deg, rgba(12,12,12,0.96), rgba(6,6,8,0.98));border-radius:14px;padding:18px;color:#fff;border:1px solid rgba(255,255,255,0.035);box-shadow:0 25px 50px rgba(2,6,18,0.7);}

    .controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px;}
    .btn{background:linear-gradient(90deg, var(--accent-1), var(--accent-3));color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700;}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);box-shadow:none;}

    .password-row{display:flex;gap:8px;margin-top:8px;}
    .password-row input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,0,0.02);color:var(--text);outline:none;transition:box-shadow .15s;}
    .password-row input:focus{box-shadow:0 0 0 2px var(--accent-1);}
    .muted{color:var(--muted);font-size:13px;}

    @media (max-width:720px){ .list-item{width:calc(50% - 12px);} .modal iframe{height:320px;} }

    .list-item{opacity:0;transform-origin:center;animation:floatIn .5s forwards;}
    @keyframes floatIn{from{opacity:0;transform:translateY(12px) scale(.995);}to{opacity:1;transform:translateY(0) scale(1);} }

    .ripple{position:relative;overflow:hidden;}
    .ripple .drop{position:absolute;border-radius:50%;transform:scale(0);background:rgba(255,255,255,0.10);animation:rip .6s ease-out;pointer-events:none;}
    @keyframes rip{to{transform:scale(6);opacity:0;}}

    header nav ul li a.touch-active, .logo.touch-active{transform:scale(0.985);transition:transform .08s linear;box-shadow:0 6px 18px rgba(0,0,0,0.6);}
    header nav ul li a.pulse, .logo.pulse{animation:btnPulse .5s ease-out;}
    @keyframes btnPulse{0%{box-shadow:0 0 0 rgba(57,255,20,0.28);}50%{box-shadow:0 0 30px rgba(57,255,20,0.22);}100%{box-shadow:0 0 0 rgba(57,255,20,0);} }


    /* --- FUTURISTIC PLAYER CSS (PERFORMANCE OPTIMIZED) --- */
    .vidu-player-host {
      position: relative;
      width: 100%;
      overflow: hidden;
      border-radius: 12px;
      background: #000;
      /* OPTIMIZATION: Promotes the player to its own compositing layer, which can significantly improve animation and video playback performance. */
      transform: translateZ(0);
      /* OPTIMIZATION: A strong performance hint for the browser that the player is a completely self-contained widget. */
      contain: strict;
      -webkit-font-smoothing: antialiased;
      height: 100%;
    }
    .vidu-player-host.cursor-hidden {
      cursor: none;
    }
    .vidu-mount {
      width:100%; height:100%; background:#000; display:block;
    }
    .vidu-mount iframe{
      width:100%; height:100%; display:block; border:0; pointer-events:none;
    }

    #player-wrap .vidu-mount { height: 520px; }
     @media (max-width:720px){ #player-wrap .vidu-mount{ height:320px; } }

    .vidu-loading {
      position:absolute; inset:0; z-index:9995; display:flex; align-items:center; justify-content:center;
      background: rgba(10, 12, 18, 0.85);
      transition: opacity .3s ease;
      will-change: opacity;
    }
    .vidu-loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid var(--glass-strong);
        border-top-color: var(--accent-2);
        border-radius: 50%;
        animation: vidu-spin 1s linear infinite;
    }
    @keyframes vidu-spin { to { transform: rotate(360deg); } }
    
    .vidu-loading.hidden {
      opacity:0; pointer-events:none;
    }

    .vidu-controls-bg {
      position:absolute; left:0; right:0; bottom:0; height:120px;
      background:linear-gradient(180deg, transparent, rgba(0,0,0,0.85));
      pointer-events:none; z-index:9996;
      transition:opacity .3s var(--ease);
      will-change:opacity;
    }
    .vidu-controls-bg.hidden { opacity:0; }

    .vidu-overlay {
      position:absolute; left:12px; right:12px; bottom:12px; z-index:9999;
      padding: 10px 16px;
      border-radius: 12px;
      box-sizing:border-box;
      transition:opacity .3s var(--ease),transform .3s var(--ease);
      will-change: opacity, transform;
      background: rgba(20, 22, 28, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 32px rgba(2, 4, 12, 0.3);
    }
    .vidu-overlay.hidden {
      opacity:0;
      transform: translateY(100%);
      pointer-events:none;
    }
    
    .vidu-controls-grid {
      display: grid;
      grid-template-areas:
        "seek seek seek"
        "left center right";
      grid-template-columns: 1fr auto 1fr;
      grid-template-rows: auto auto;
      gap: 8px 16px;
      align-items: center;
    }

    .vidu-seek-container { grid-area: seek; position: relative; padding: 8px 0; }
    .vidu-controls-left { grid-area: left; display: flex; align-items: center; gap: 12px; justify-self: start; }
    .vidu-controls-center { grid-area: center; }
    .vidu-controls-right { grid-area: right; display: flex; align-items: center; gap: 8px; justify-self: end; }


    .vidu-btn {
      background: transparent; color:#fff; padding:0; border-radius:8px; cursor:pointer; user-select:none; border:none;
      display:flex; align-items:center; justify-content:center; width:40px; height:40px;
      transition: background .18s var(--ease), transform .12s ease;
      position: relative;
    }
    .vidu-btn:hover { background: rgba(255,255,255,0.1); }
    .vidu-btn:active{ transform: scale(.95); transition-duration: .08s; }
    .vidu-btn svg { width: 22px; height: 22px; transition: transform .2s var(--ease); }
    .vidu-btn:hover svg { transform: scale(1.1); }

    #vidu_playbtn {
      width: 44px; height: 44px; background: rgba(255, 255, 255, 0.1); border-radius: 12px;
    }
    #vidu_playbtn:hover { background: rgba(255, 255, 255, 0.2); }
    #vidu_playbtn svg { width: 24px; height: 24px; }
    
    .vidu-range {
      -webkit-appearance: none; appearance: none;
      width: 100%; height: 6px; background: transparent; cursor: pointer;
      position: absolute; top: 0; left: 0; bottom: 0; right: 0; margin: auto 0; padding: 0;
    }
    .vidu-range:focus {
      outline: none;
    }
    .seek-track {
      position: relative; width: 100%; height: 6px;
      background: rgba(255, 255, 255, 0.15); border-radius: 6px;
      pointer-events: none; overflow: hidden;
    }
    .seek-progress {
      position: absolute; left: 0; top: 0; height: 100%;
      background: var(--accent-2); border-radius: 6px;
      will-change: width;
    }
    .vidu-range::-webkit-slider-thumb {
      -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%;
      background: #fff; border: none;
      box-shadow: 0 0 10px rgba(57, 255, 20, 0.5), 0 0 20px rgba(57, 255, 20, 0.3);
    }
    .vidu-range::-moz-range-thumb {
      width: 16px; height: 16px; border-radius: 50%; background: #fff; border: none;
      box-shadow: 0 0 10px rgba(57, 255, 20, 0.5), 0 0 20px rgba(57, 255, 20, 0.3);
    }
    .seek-thumb {
      position: absolute; top: 50%; left: 0; width: 16px; height: 16px;
      background: #fff; border-radius: 50%; transform: translateY(-50%) scale(1);
      pointer-events: none; box-shadow: 0 0 8px rgba(0,0,0,0.5);
      transition: transform .2s var(--ease); will-change: left, transform;
    }
    .vidu-seek-container:hover .seek-thumb {
      transform: translateY(-50%) scale(1.15); box-shadow: 0 0 12px rgba(57, 255, 20, 0.7);
    }

    .vidu-time-container { display: flex; align-items: baseline; }
    .vidu-time {
      min-width: auto; font-size:14px; font-weight:600; color:var(--text); text-align:center;
      letter-spacing:0.5px; text-shadow:0 1px 2px rgba(0,0,0,0.6); user-select:none;
    }
    .vidu-time-separator { color: var(--muted); margin: 0 6px; font-size: 13px; }

    .vidu-pip-btn, .vidu-close-btn {
      position:absolute; top:12px; z-index:10002;
      width:38px; height:38px; padding:6px; border-radius:50%;
      background:rgba(20, 22, 28, 0.85);
      border:1px solid rgba(255,255,255,0.08); color:#fff;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      box-shadow:0 8px 20px rgba(0,0,0,0.5);
      transition: opacity .3s ease, transform .3s ease, background .3s ease;
      will-change: opacity, transform;
    }
    .vidu-close-btn { right:12px; font-size: 18px; font-weight:700; }
    .vidu-pip-btn { left:12px; }
    .vidu-pip-btn svg { width: 22px; height: 22px; }

    .vidu-pip-btn:hover, .vidu-close-btn:hover {
      transform: scale(1.1);
      background: rgba(30, 32, 40, 0.9);
    }
    .vidu-close-btn:hover { transform: scale(1.1) rotate(90deg); }

    .vidu-pip-btn.hidden, .vidu-close-btn.hidden {
      opacity:0; transform: translateY(-8px) scale(0.95); pointer-events:none;
    }

    #close-player { display:none !important; }

    .vidu-player-host:-webkit-full-screen .vidu-mount, .vidu-player-host:fullscreen .vidu-mount { height:100vh !important; width:100% !important; }
    .vidu-player-host:-webkit-full-screen .vidu-mount iframe, .vidu-player-host:fullscreen .vidu-mount iframe { height:100vh !important; width:100% !important; max-height:none !important; }
    .vidu-player-host:-webkit-full-screen .vidu-overlay, .vidu-player-host:fullscreen .vidu-overlay { left:18px !important; right:18px !important; bottom:18px !important; }
    
    @media (max-width:540px){ .vidu-controls-grid { grid-template-areas: "seek seek" "left right"; grid-template-columns: 1fr 1fr; } .vidu-time-container { display: none; } }
    
    .vidu-vol-feedback{
      position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index:10003;
      padding:12px 18px; border-radius:12px; 
      background:rgba(20, 22, 28, 0.9);
      border:1px solid rgba(255,255,255,0.08);
      font-weight:800; font-size:18px; color:var(--text); box-shadow:0 10px 25px rgba(0,0,0,0.5);
      pointer-events:none; opacity:0; transition:opacity .28s ease; display:none; min-width:72px; text-align:center;
    }
    
    .vidu-playback-menu {
      position: absolute;
      bottom: 82px;
      right: 12px;
      z-index: 10001;
      width: 90px;
      background: rgba(30, 32, 38, 0.96);
      border-radius: 12px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.5);
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      opacity: 0;
      transform-origin: bottom right;
      transform: translateY(10px) scale(0.95);
      transition: opacity .2s var(--ease), transform .2s var(--ease);
      pointer-events: none;
      will-change: opacity, transform;
    }
    .vidu-playback-menu.open {
        opacity: 1; transform: translateY(0) scale(1); pointer-events: auto;
    }
    .vidu-playback-menu button {
        background: transparent; border: none; color: var(--text);
        padding: 8px 12px;
        cursor: pointer; font-weight: 700; font-size: 14px;
        width: 100%; text-align: center; border-radius: 8px;
        transition: background .18s ease, color .18s ease;
    }
    .vidu-playback-menu button:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    .vidu-playback-menu button.active {
        color: #fff;
        font-weight: 700;
        background: #4a7453;
    }


    .header-icon-btn { background: transparent; border: none; color: var(--muted); cursor: pointer; padding: 8px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all .18s var(--ease); position: relative; width: 38px; height: 38px; }
    .header-icon-btn:hover { color: var(--text); background: var(--glass); transform: scale(1.1); }
    .header-icon-btn svg { width: 22px; height: 22px; fill: currentColor; }

    .notification-panel { position: fixed; top: 80px; right: 22px; width: 340px; max-width: 90vw; background: rgba(20, 22, 28, 0.95); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: var(--card-radius); box-shadow: 0 16px 50px rgba(2, 4, 12, 0.6); z-index: 10000; color: var(--text); opacity: 0; transform: translateY(-10px) scale(0.98); transition: opacity .25s var(--ease), transform .25s var(--ease); pointer-events: none; will-change: opacity, transform; }
    .notification-panel.show { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
    .notification-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 18px; border-bottom: 1px solid rgba(255, 255, 255, 0.07); }
    .notification-header h3 { margin: 0; font-size: 16px; font-weight: 700; }
    .notification-close-btn { background: none; border: none; color: var(--muted); font-size: 26px; line-height: 1; cursor: pointer; padding: 0 4px; transition: color .18s ease, transform .18s ease; }
    .notification-close-btn:hover { color: var(--text); transform: scale(1.1); }
    .notification-content { padding: 18px; font-size: 14px; max-height: 400px; overflow-y: auto; }
    .notification-content p { margin: 0; line-height: 1.6; }

    .loading-popup-overlay { position: fixed; inset: 0; background: rgba(4, 6, 12, 0.7); z-index: 20000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s var(--ease); will-change: opacity; }
    .loading-popup-overlay.show { opacity: 1; pointer-events: auto; }
    .loading-popup-content { background: linear-gradient(180deg, #1c1c20, #121214); padding: 28px 35px; border-radius: var(--card-radius); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 12px 40px rgba(0,0,0,0.5); text-align: center; max-width: 400px; width: 90%; color: var(--text); }
    .loading-popup-content p { margin: 0 0 18px 0; font-size: 16px; font-weight: 600; line-height: 1.6; }
    .loading-bar-container { width: 100%; height: 8px; background: var(--glass-strong); border-radius: 8px; overflow: hidden; }
    .loading-bar-fill { width: 0%; height: 100%; background: linear-gradient(90deg, var(--accent-1), var(--accent-2)); border-radius: 8px; }
    
    #restoring-position-overlay.loading-popup-overlay {
        background: rgba(4, 6, 12, 0.85);
    }

    .fs-playlist-overlay { position: fixed; inset: 0; background: rgba(8, 9, 14, 0.9); z-index: 15000; display: none; flex-direction: column; color: var(--text); opacity: 0; transform: scale(1.02); transition: opacity 0.3s var(--ease), transform 0.3s var(--ease); will-change: opacity, transform; }
    .fs-playlist-overlay.show { display: flex; opacity: 1; transform: scale(1); }
    .fs-playlist-header { display: flex; align-items: center; padding: 18px 24px; background: rgba(255, 255, 255, 0.03); border-bottom: 1px solid rgba(255, 255, 255, 0.08); flex-shrink: 0; }
    .fs-playlist-header h3 { margin: 0; font-size: 18px; font-weight: 800; }
    .fs-playlist-count { margin-left: 16px; font-size: 14px; font-weight: 600; color: var(--muted); background: var(--glass-strong); padding: 4px 10px; border-radius: 16px; }
    .fs-playlist-close-btn { margin-left: auto; background: none; border: none; color: var(--muted); font-size: 32px; line-height: 1; cursor: pointer; transition: color .2s ease, transform .2s ease; }
    .fs-playlist-close-btn:hover { color: var(--text); transform: scale(1.1) rotate(90deg); }
    .fs-playlist-content { flex: 1; overflow-y: auto; padding: 24px; display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; align-content: start; }
    .fs-playlist-item { position: relative; background: rgba(255,255,255,0.02); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: var(--card-radius); padding: 12px; cursor: pointer; transition: transform 0.25s var(--ease), box-shadow 0.25s var(--ease), background 0.25s var(--ease); will-change: transform; }
    .fs-playlist-item:hover { transform: translateY(-8px); box-shadow: 0 12px 30px rgba(0,0,0,0.4); background: var(--glass-strong); }
    
    .video-number-thumbnail {
        width: 100%; aspect-ratio: 16/9; border-radius: 6px; margin-bottom: 12px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3); background: #000;
        display: flex; align-items: center; justify-content: center; overflow: hidden;
    }
    .video-number-thumbnail span {
        font-family: 'Inter', sans-serif; font-weight: 800; font-size: clamp(3.5rem, 8vw, 5rem);
        color: var(--accent-2); text-shadow: 0 0 12px rgba(57, 255, 20, 0.7); line-height: 1;
    }

    .fs-playlist-item .title { font-weight: 700; font-size: 14px; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; }
    
    .fs-playlist-loader { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(8, 9, 14, 0.7); }
    .fs-playlist-loader .spinner { width: 50px; height: 50px; border: 4px solid var(--glass-strong); border-top-color: var(--accent-2); border-radius: 50%; animation: spin 1s linear infinite; }
    .fs-playlist-loader p { margin-top: 16px; font-weight: 600; color: var(--muted); }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* --- CUSTOM PICTURE-IN-PICTURE STYLES --- */
    #custom-pip {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 400px; /* Base width */
      max-width: 90vw;
      background: #1a1c20;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.6);
      z-index: 100000;
      display: none; /* Initially hidden */
      flex-direction: column;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }
    #custom-pip-header {
      padding: 4px 10px; /* Reduced padding */
      background: rgba(30, 32, 38, 0.9);
      color: #fff;
      font-weight: 600; /* Slightly lighter weight */
      font-size: 12px; /* Reduced font size */
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
      flex-shrink: 0;
    }
     #custom-pip-title {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        padding-right: 10px;
    }
    #custom-pip-close {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 20px;
      cursor: pointer;
      line-height: 1;
      transition: color 0.2s, transform 0.2s;
      padding: 0 4px;
    }
    #custom-pip-close:hover {
      color: #fff;
      transform: scale(1.1);
    }
    #custom-pip-content {
      flex-grow: 1;
      background: #000;
      position: relative;
      aspect-ratio: 16 / 9; /* This is the key fix for black bars */
    }

    /* --- PiP Player Control Overrides --- */
    #custom-pip .vidu-overlay {
        left: 6px; right: 6px; bottom: 6px;
        padding: 4px 8px;
        border-radius: 8px;
    }
    #custom-pip .vidu-controls-bg {
        height: 60px; /* Reduced gradient height */
    }
     #custom-pip .vidu-controls-grid {
        gap: 2px 6px;
        grid-template-areas: "seek seek" "left right";
        grid-template-columns: 1fr 1fr;
    }
     #custom-pip .vidu-controls-left { justify-self: start; }
     #custom-pip .vidu-controls-right { justify-self: end; }
     #custom-pip .vidu-time-container { display: none; } /* Hide time to save space */
     #custom-pip .vidu-seek-container { padding: 4px 0; }
     #custom-pip .seek-track { height: 5px; }
     #custom-pip .seek-thumb { width: 12px; height: 12px; }
     #custom-pip .vidu-range::-webkit-slider-thumb { width: 12px; height: 12px; }
     #custom-pip .vidu-range::-moz-range-thumb { width: 12px; height: 12px; }

    #custom-pip .vidu-btn {
        width: 30px; height: 30px;
    }
    #custom-pip .vidu-btn svg {
        width: 16px; height: 16px;
    }
    #custom-pip #vidu_playbtn {
        width: 32px; height: 32px;
    }
    #custom-pip #vidu_playbtn svg {
        width: 18px; height: 18px;
    }
    #custom-pip .vidu-playback-menu {
        bottom: 40px; /* Adjusted position */
        right: 6px;
        width: 80px;
    }
    #custom-pip .vidu-playback-menu button {
        font-size: 13px;
        padding: 6px 10px;
    }
    #custom-pip .vidu-pip-btn, #custom-pip .vidu-close-btn { display: none; } /* Hide PiP/Close buttons inside PiP */
  </style>
</head>
<body class="landing is-preload">
 <div id="wrapper">
  <header id="header">
    <a href="index.html" class="logo" aria-label="VIDU home" title="VIDU home">
      <div class="logo-circle" aria-hidden="true">
        <img src="https://i.pinimg.com/736x/4d/fa/7b/4dfa7b57656b556f257b4a2e4f8fc8fa.jpg" alt="VIDU Logo" />
      </div>
    </a>
    <div class="header-right-controls">
        <button id="download-btn-header" class="header-icon-btn" data-link="https://vidu2006.netlify.app/assets/tools/coming%20soon" aria-label="Download" title="Download">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z"/></svg>
        </button>
        <nav>
          <ul>
            <li><a href="videos.html">üîíPrivate</a></li>
            <li><a href="Tools.html" id="nav-tools" title="Tools" aria-label="Tools">ü§ñTools</a></li>
            <li><a href="about.html">‚ÑπÔ∏èAbout</a></li>
          </ul>
        </nav>
        <button id="notification-btn" class="header-icon-btn" aria-label="Notifications" title="Notifications">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
        </button>
    </div>
  </header>
  <section id="home" class="wrapper style1 fade-up">
    <div class="inner">
      <h2></h2>
      <ul id="playlist-list" class="list-container"></ul>
      <div id="playlist-videos" style="margin-top:2rem; display:none;"></div>
    </div>
  </section>
  <footer id="footer">
    <p>&copy; VIDU. 2025 All rights reserved.</p>
  </footer>
 </div>
 <div id="modal-root" style="display:none;"></div>
 <div id="notification-panel" class="notification-panel" role="dialog" aria-labelledby="notification-title" aria-hidden="true">
    <div class="notification-header">
        <h3 id="notification-title">Notifications</h3>
        <button id="notification-close-btn" class="notification-close-btn" aria-label="Close notifications">&times;</button>
    </div>
  <div class="notification-content">
  <p style="margin:0 0 12px 0; font-weight:800; font-size:18px; color: #fff;">
    Ayo, VIDU here. The architect of this whole operation. üë®‚Äçüíª
  </p>
  <p style="margin:0 0 20px 0; color: #b8c1d9;">
    You wanted to know what's under the hood? Aight, here‚Äôs the full breakdown of every single feature I personally coded into this site. It's a vibe.
  </p>

  <h4 style="color: #00ff8a; margin: 20px 0 10px 0; border-bottom: 1px solid rgba(0, 255, 138, 0.2); padding-bottom: 5px;">üé¨ The VIDU Player‚Ñ¢Ô∏è (Yeah, I built that)</h4>
  <ul style="padding-left: 20px; line-height: 1.7; list-style-type: '‚úÖ '; margin-bottom: 20px;">
    <li>
      <strong>Custom Controls:</strong> The default YouTube player is mid, so I built my own slick interface over the YouTube Iframe API. All the buttons and sliders? That's pure HTML and CSS, controlled by my JavaScript.
    </li>
     <li>
      <strong>Custom PiP Mode:</strong> I built a fully custom Picture-in-Picture mode from scratch. It's not the browser default‚Äîit's a draggable window with my own slick player controls right on top. Seamlessly transition in and out without losing your spot.
    </li>
    <li>
      <strong>Keyboard Warrior Mode:</strong> I added `keydown` event listeners so you can go full hacker mode. <strong>Space</strong> for play/pause, <strong>Arrow Keys</strong> for skipping and volume control, and <strong>F</strong> for fullscreen. No mouse required.
    </li>
    <li>
      <strong>Speed Demon Settings:</strong> The little gear icon lets you change playback speed. I'm hooking into the player's `setPlaybackRate()` function to let you bend time. You're welcome.
    </li>
    <li>
      <strong>"Never Lose Your Spot" Save:</strong> Your browser has a secret diary called `localStorage`. I wrote a script to save your video timestamp there every minute. When you come back, it reads that file and `seekTo()` puts you right back where you were. Magic. ‚ú®
    </li>
  </ul>

  <h4 style="color: #00ff8a; margin: 20px 0 10px 0; border-bottom: 1px solid rgba(0, 255, 138, 0.2); padding-bottom: 5px;">üîê Security & Playlists</h4>
  <ul style="padding-left: 20px; line-height: 1.7; list-style-type: '‚úÖ '; margin-bottom: 20px;">
    <li>
      <strong>The Vault (Password Protection):</strong> For the exclusive content, I added a password check. It's a simple but effective system using Base64 encoding on the password string, which my JavaScript decodes and verifies before letting you in. ü§´
    </li>
    <li>
      <strong>Multi-User Login:</strong> The private page isn't a free-for-all. I built a client-side login system with a JavaScript object acting as a user database. It checks your creds and grants access only to the playlists you're cleared for. VIP treatment only. üíÖ
    </li>
    <li>
      <strong>YT Playlist Importer:</strong> This is the big one. I'm using the official YouTube Data API. When you paste a link, my code makes a `fetch` call, pulls all the video data, and then dynamically builds that slick fullscreen playlist view for you to scroll through.
    </li>
  </ul>

  <h4 style="color: #00ff8a; margin: 20px 0 10px 0; border-bottom: 1px solid rgba(0, 255, 138, 0.2); padding-bottom: 5px;">üõ†Ô∏è The VIDU Tool Shed</h4>
  <ul style="padding-left: 20px; line-height: 1.7; list-style-type: '‚úÖ '; margin-bottom: 20px;">
    <li>
      <strong>The Video Yoinker (YT Downloader):</strong> Need a video offline? Just paste one or more links. I use a clever bit of code called a Regular Expression (regex) to instantly find the video ID from any link format. Then I just hand it off to a download service for you.
    </li>
    <li>
      <strong>Link Glo-Up (YT Converter):</strong> Long, ugly YouTube links are a crime. This tool also uses regex to find the video ID and then rebuilds the URL into the clean `youtu.be` format. So much better for sharing.
    </li>
  </ul>
  
  <h4 style="color: #00ff8a; margin: 20px 0 10px 0; border-bottom: 1px solid rgba(0, 255, 138, 0.2); padding-bottom: 5px;">‚ú® The Vibe (UI/UX)</h4>
  <ul style="padding-left: 20px; line-height: 1.7; list-style-type: '‚úÖ '; margin-bottom: 20px;">
    <li>
      <strong>Glassy Everything:</strong> That cool, see-through blur effect on the modals and header? That's a CSS property called `backdrop-filter: blur()`. Makes everything look premium.
    </li>
    <li>
      <strong>Buttery Smooth Animations:</strong> Every fade-in, every sliding card, every loading bar‚Äîthat's all custom CSS `transitions` and `animations` I wrote to make the experience feel alive and responsive. No jank here.
    </li>
  </ul>

  <p style="margin:20px 0 0 0; font-size:13px; color:#aeb8d0; text-align: center;">
    <em>Literally coded the soul into this site. Hope you dig it.</em><br/>
    <strong>- VIDU ‚úåÔ∏è</strong>
  </p>
</div>
</div>
 <div id="loading-popup-overlay" class="loading-popup-overlay">
  <div class="loading-popup-content">
    <p id="loading-popup-message">Downloading VIDU For Windows(x64) please wait...</p>
    <div class="loading-bar-container">
      <div id="loading-bar-fill" class="loading-bar-fill"></div>
    </div>
  </div>
</div>
<div id="fullscreen-playlist-overlay" class="fs-playlist-overlay">
  <div class="fs-playlist-header">
    <h3 id="fs-playlist-title"></h3>
    <span id="fs-playlist-count" class="fs-playlist-count">0 Videos</span>
    <button id="fs-playlist-close-btn" class="fs-playlist-close-btn" aria-label="Close Playlist">&times;</button>
  </div>
  <div id="fs-playlist-content" class="fs-playlist-content"></div>
  <div id="fs-playlist-loader" class="fs-playlist-loader" style="display: none;">
    <div class="spinner"></div>
    <p>Initializing VIDU Fetcher...</p>
  </div>
</div>
<div id="player-loading-overlay" class="loading-popup-overlay">
  <div class="loading-popup-content">
    <p>Initializing VIDU Player</p>
    <div class="loading-bar-container">
      <div id="player-loading-bar-fill" class="loading-bar-fill"></div>
    </div>
  </div>
</div>
<!-- New PiP Loading Overlay -->
<div id="pip-loading-overlay" class="loading-popup-overlay">
  <div class="loading-popup-content">
    <p>Initializing VIDU PIP Player</p>
    <div class="loading-bar-container">
      <div id="pip-loading-bar-fill" class="loading-bar-fill"></div>
    </div>
  </div>
</div>
<div id="restoring-position-overlay" class="loading-popup-overlay">
  <div class="loading-popup-content">
    <p>Restoring Last Position</p>
    <div class="loading-bar-container">
      <div id="restoring-bar-fill" class="loading-bar-fill"></div>
    </div>
  </div>
</div>

<!-- Custom Picture-in-Picture Container -->
<div id="custom-pip">
    <div id="custom-pip-header">
        <span id="custom-pip-title">Picture-in-Picture</span>
        <button id="custom-pip-close">&times;</button>
    </div>
    <div id="custom-pip-content"></div>
</div>


<script>
// PLAYER SCRIPT
(function(){
  if(window.__viduPlayerLoaded) return;
  window.__viduPlayerLoaded = true;

  // This will manage the state of the MAIN player in the modal
  window.mainPlayerState = {
      instance: null,
      videoId: null,
      title: null,
      eventListeners: {},
      timers: {},
      animationFrameId: null,
      lastVolume: (() => { try { const v = localStorage.getItem('vidu_player_volume'); return (v !== null && !isNaN(v)) ? parseFloat(v) : 100; } catch(e) { return 100; } })(),
  };

  // This will manage the state of the PiP player
  window.pipPlayerState = {
      instance: null,
      videoId: null,
      title: null,
      eventListeners: {},
      timers: {},
      animationFrameId: null,
  };


  function loadYTApi(){
    if(window.YT && window.YT.Player) return Promise.resolve();
    if(window._vidu_loading_yt){
      return new Promise((res, rej)=>{
        const t = setInterval(()=>{ if(window.YT && window.YT.Player){ clearInterval(t); res(); } },80);
        setTimeout(()=>{ clearInterval(t); rej(new Error('YT load timeout')); },20000);
      });
    }
    window._vidu_loading_yt = true;
    return new Promise((resolve,reject)=>{
      const s=document.createElement('script');
      s.src='https://www.youtube.com/iframe_api';
      s.async=true;
      s.onerror = ()=> reject(new Error('YT API failed to load'));
      document.head.appendChild(s);
      window.onYouTubeIframeAPIReady = function(){ resolve(); };
      setTimeout(()=>{ if(window.YT && window.YT.Player) resolve(); },1200);
      setTimeout(()=>{ if(!(window.YT && window.YT.Player)) reject(new Error('YT API timed out')); },20000);
    });
  }
  try{ window.loadYTApi = loadYTApi; }catch(e){}

  function pad2(n){
    n = Math.max(0, Math.floor(n||0));
    return (n < 10 ? '0' + n : String(n));
  }
  function fmtHHMMSS(s){
    s = Math.max(0, Math.floor(s||0));
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;
    if (h > 0) {
        return pad2(h) + ':' + pad2(m) + ':' + pad2(sec);
    }
    return pad2(m) + ':' + pad2(sec);
  }

  function playSVG(){ return `<svg viewBox="0 0 24 24" fill="currentColor" style="transform: translateX(1px);"><path d="M8 5v14l11-7z"/></svg>`; }
  function pauseSVG(){ return `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>`; }
  function gearSVG(){ return `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69-.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19-.15-.24-.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49 1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49.42l.38-2.65c.61-.25 1.17-.59-1.69.98l2.49 1c.23.09.49 0 .61.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>`; }
  function fullscreenSVG(){ return `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>`; }
  function exitFullscreenSVG(){ return `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>`; }
  function pipSVG() { return `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 11h-8v6h8v-6zm4 8V4.98C23 3.88 22.1 3 21 3H3c-1.1 0-2 .88-2 1.98V19c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H3V4.97h18v14.05z"/></svg>`; }


  function createHostElements(container, isPip = false){
      container.innerHTML = ''; // Clear previous content
      const host = document.createElement('div'); host.className = 'vidu-player-host';
      const mount = document.createElement('div'); mount.className = 'vidu-mount'; mount.id = `vidu_mount_${Math.floor(Math.random()*1e6)}`;
      host.appendChild(mount);
      const loadingDiv = document.createElement('div'); loadingDiv.className = 'vidu-loading';
      loadingDiv.innerHTML = `<div class="vidu-loading-spinner"></div>`;
      host.appendChild(loadingDiv);
      const ctrlBg = document.createElement('div'); ctrlBg.className = 'vidu-controls-bg';
      host.appendChild(ctrlBg);
      const overlay = document.createElement('div'); overlay.className = 'vidu-overlay';
      
      overlay.innerHTML = `
        <div class="vidu-controls-grid">
          <div class="vidu-seek-container">
            <div class="seek-track"><div class="seek-progress"></div></div>
            <div class="seek-thumb"></div>
            <input class="vidu-range" type="range" min="0" max="100" step="0.1" value="0" aria-label="Video progress"/>
          </div>
          <div class="vidu-controls-left">
            <button class="vidu-btn" id="vidu_playbtn" aria-label="Play">${playSVG()}</button>
            <div class="vidu-time-container">
              <span class="vidu-time current">${fmtHHMMSS(0)}</span>
              <span class="vidu-time-separator">/</span>
              <span class="vidu-time duration">${fmtHHMMSS(0)}</span>
            </div>
          </div>
          <div class="vidu-controls-center"></div>
          <div class="vidu-controls-right">
            <button class="vidu-btn playback-btn" title="Playback speed" aria-label="Playback speed">${gearSVG()}</button>
            <button class="vidu-btn fullscreen-btn" title="Fullscreen" aria-label="Fullscreen">${fullscreenSVG()}</button>
          </div>
        </div>`;
      host.appendChild(overlay);
      
      const playbackMenu = document.createElement('div');
      playbackMenu.className = 'vidu-playback-menu';
      playbackMenu.innerHTML = `<button data-speed="5">üòé</button><button data-speed="2">2x</button><button data-speed="1.75">1.75x</button><button data-speed="1.5">1.5x</button><button data-speed="1.25">1.25x</button><button data-speed="1" class="active">1x</button>`;
      host.appendChild(playbackMenu);

      const pipBtn = document.createElement('button');
      pipBtn.className = 'vidu-pip-btn';
      pipBtn.title = 'Picture-in-Picture';
      pipBtn.innerHTML = pipSVG();
      host.appendChild(pipBtn);

      const closeBtn = document.createElement('button');
      closeBtn.className = 'vidu-close-btn';
      closeBtn.title = 'Close';
      closeBtn.innerHTML = '‚úï';
      host.appendChild(closeBtn);
      
      const volFeedback = document.createElement('div');
      volFeedback.className = 'vidu-vol-feedback';
      volFeedback.style.display = 'none';
      host.appendChild(volFeedback);
      
      container.appendChild(host);
      return { host, mount };
  }

  function setupPlayer(videoInfo, container, stateObject, isPip = false) {
      // Clean up previous instance and its listeners
      destroyPlayerInstance(stateObject);

      stateObject.videoId = videoInfo.videoId;
      stateObject.title = videoInfo.title;

      const { host, mount } = createHostElements(container, isPip);
      
      // Selectors scoped to the new host
      const $ = (selector) => host.querySelector(selector);
      
      const playBtn = $('.vidu-controls-left .vidu-btn');
      const curEl = $('.vidu-time.current');
      const durEl = $('.vidu-time.duration');
      const seekEl = $('.vidu-range');
      const fullBtn = $('.fullscreen-btn');
      const playbackBtn = $('.playback-btn');
      const volFeedbackEl = $('.vidu-vol-feedback');
      const seekProgressEl = $('.seek-progress');
      const seekThumbEl = $('.seek-thumb');
      const overlay = $('.vidu-overlay');
      const ctrlBg = $('.vidu-controls-bg');
      const closeBtn = $('.vidu-close-btn');
      const pipBtn = $('.vidu-pip-btn');
      const loadingDiv = $('.vidu-loading');
      const playbackMenu = $('.vidu-playback-menu');

      let desiredPlaying = null;
      let lastSaveTime = 0;

      function setOverlayHidden(hidden){ 
          if(hidden){ 
              overlay.classList.add('hidden'); ctrlBg.classList.add('hidden'); 
              if(closeBtn) closeBtn.classList.add('hidden'); if(pipBtn) pipBtn.classList.add('hidden'); 
              if(playbackMenu) playbackMenu.classList.remove('open'); 
              host.classList.add('cursor-hidden');
          } else { 
              overlay.classList.remove('hidden'); ctrlBg.classList.remove('hidden'); 
              if(closeBtn) closeBtn.classList.remove('hidden'); if(pipBtn) pipBtn.classList.remove('hidden'); 
              host.classList.remove('cursor-hidden');
          } 
      }

      function resetInactivityTimer(){
          stateObject.lastActivity = Date.now();
          setOverlayHidden(false);
          if(stateObject.timers.inactivity) clearTimeout(stateObject.timers.inactivity);
          stateObject.timers.inactivity = setTimeout(() => {
              if (stateObject.instance && typeof stateObject.instance.getPlayerState === 'function') {
                  const isMenuOpen = playbackMenu.classList.contains('open');
                  const isDragging = seekEl._drag;
                  if (stateObject.instance.getPlayerState() === 1 && !isMenuOpen && !isDragging) {
                      setOverlayHidden(true);
                  }
              }
          }, 3000);
      }
      
      const activityEvents = ['mousemove','pointermove','touchstart','touchmove','keydown','mousedown'];
      stateObject.eventListeners.activity = resetInactivityTimer; // Store for removal
      activityEvents.forEach(ev => host.addEventListener(ev, resetInactivityTimer, {passive:true}));


      playbackBtn.addEventListener('click', (e) => { e.stopPropagation(); playbackMenu.classList.toggle('open'); });
      playbackMenu.addEventListener('click', (e) => {
          if (e.target.tagName === 'BUTTON' && e.target.dataset.speed) {
              const speed = parseFloat(e.target.dataset.speed);
              if (stateObject.instance) {
                  stateObject.instance.setPlaybackRate(speed);
                  playbackMenu.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                  e.target.classList.add('active');
                  playbackMenu.classList.remove('open');
              }
          }
      });
      stateObject.eventListeners.docClick = (e) => {
        if (playbackMenu.classList.contains('open') && !playbackMenu.contains(e.target) && !playbackBtn.contains(e.target)) {
          playbackMenu.classList.remove('open');
        }
      };
      document.addEventListener('click', stateObject.eventListeners.docClick);

      function updatePlayerUI() {
          if (!stateObject.instance || !document.body.contains(host)) {
              if(stateObject.animationFrameId) cancelAnimationFrame(stateObject.animationFrameId);
              return;
          }
          try {
              const dur = stateObject.instance.getDuration() || 0;
              const cur = stateObject.instance.getCurrentTime() || 0;
              if (curEl) curEl.textContent = fmtHHMMSS(cur);
              if (durEl) durEl.textContent = (dur && isFinite(dur)) ? fmtHHMMSS(dur) : '00:00';
              if (!seekEl._drag && dur && isFinite(dur)) {
                  const percent = (cur / Math.max(1, dur)) * 100;
                  seekEl.value = percent;
                  seekProgressEl.style.width = `${percent}%`;
                  seekThumbEl.style.left = `${percent}%`;
              }
              const st = stateObject.instance.getPlayerState();
              
              if (desiredPlaying !== null) {
                  if(desiredPlaying && st !== 1) stateObject.instance.playVideo();
                  else if(!desiredPlaying && st === 1) stateObject.instance.pauseVideo();
              }

              const isPlaying = (st === 1);
              const currentIcon = isPlaying ? pauseSVG() : playSVG();
              if (playBtn.innerHTML !== currentIcon) playBtn.innerHTML = currentIcon;
              playBtn.setAttribute('aria-label', isPlaying ? 'Pause' : 'Play');

              const now = Date.now();
              if (stateObject.videoId && isPlaying && now - lastSaveTime > 60000) {
                  if (cur > 1) {
                      window.saveVideoProgress(stateObject.videoId, cur);
                      lastSaveTime = now;
                  }
              }
          } catch (e) {}
          stateObject.animationFrameId = requestAnimationFrame(updatePlayerUI);
      }
      
      const keyHandler = (e) => {
          const active = document.activeElement; const seekIsActive = (active === seekEl);
          if(active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA' || active.isContentEditable) && !seekIsActive) return;

          const isMainPlayerFocused = document.getElementById('modal-root').style.display !== 'none';
          const isPipPlayerFocused = document.getElementById('custom-pip').style.display !== 'none';
          if (!isMainPlayerFocused && !isPipPlayerFocused) return;
          
          switch(e.code) {
              case 'Space': e.preventDefault(); desiredPlaying = !(stateObject.instance.getPlayerState() === 1); resetInactivityTimer(); break;
              case 'KeyF': e.preventDefault(); if (fullBtn) toggleFullscreen(); break;
              case 'ArrowRight': e.preventDefault(); stateObject.instance.seekTo(stateObject.instance.getCurrentTime() + 10, true); resetInactivityTimer(); break;
              case 'ArrowLeft': e.preventDefault(); stateObject.instance.seekTo(stateObject.instance.getCurrentTime() - 10, true); resetInactivityTimer(); break;
              case 'ArrowUp':
                  e.preventDefault();
                  const volUp = Math.min(100, stateObject.instance.getVolume() + 5);
                  stateObject.instance.setVolume(volUp);
                  mainPlayerState.lastVolume = volUp; // Always save to main state
                  localStorage.setItem('vidu_player_volume', volUp);
                  if (volUp > 0) stateObject.instance.unMute();
                  showVolumeFeedback(volUp);
                  resetInactivityTimer();
                  break;
              case 'ArrowDown':
                  e.preventDefault();
                  const volDown = Math.max(0, stateObject.instance.getVolume() - 5);
                  stateObject.instance.setVolume(volDown);
                  mainPlayerState.lastVolume = volDown;
                  localStorage.setItem('vidu_player_volume', volDown);
                  if (volDown === 0) stateObject.instance.mute();
                  showVolumeFeedback(volDown);
                  resetInactivityTimer();
                  break;
          }
      };
      stateObject.eventListeners.keyHandler = keyHandler;
      document.addEventListener('keydown', keyHandler);

      // Fullscreen specific logic
      if (!isPip) {
          function getFullscreenElement(){ return document.fullscreenElement || document.webkitFullscreenElement; }
          
          // --- NEW FEATURE & OPTIMIZATION: Automatic Landscape on Fullscreen (Mobile) ---
          function toggleFullscreen() {
              if (!getFullscreenElement()) {
                  // Request fullscreen
                  const promise = host.requestFullscreen ? host.requestFullscreen() : host.webkitRequestFullscreen();
                  if (!promise) return;

                  // On mobile devices, after entering fullscreen, try to lock the orientation to landscape for a better viewing experience.
                  if (window.matchMedia("(max-width: 768px)").matches) {
                      promise.then(() => {
                          try {
                              if (screen.orientation && typeof screen.orientation.lock === 'function') {
                                  // This is an asynchronous request. We catch potential errors.
                                  screen.orientation.lock('landscape').catch(err => console.warn("Could not lock to landscape:", err));
                              }
                          } catch (e) {
                              console.warn("Screen Orientation API is not available.", e);
                          }
                      }).catch(err => {
                          console.warn("Fullscreen request failed:", err);
                      });
                  }
              } else {
                  // Exit fullscreen
                  if (document.exitFullscreen) document.exitFullscreen();
                  else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
              }
          }
          fullBtn.addEventListener('click', toggleFullscreen);

          const fsListener = () => {
              const isFullscreen = !!getFullscreenElement();
              if (isFullscreen) {
                  fullBtn.innerHTML = exitFullscreenSVG();
              } else {
                  fullBtn.innerHTML = fullscreenSVG();
                  // --- NEW FEATURE: When exiting fullscreen, unlock the screen orientation to allow it to return to normal.
                  try {
                      if (screen.orientation && typeof screen.orientation.unlock === 'function') {
                          screen.orientation.unlock();
                      }
                  } catch (e) {
                      console.warn("Could not unlock screen orientation.", e);
                  }
              }
          };

          stateObject.eventListeners.fsListener = fsListener;
          document.addEventListener('fullscreenchange', fsListener);
          document.addEventListener('webkitfullscreenchange', fsListener);
      } else {
          fullBtn.style.display = 'none'; // No fullscreen in PiP
      }

      function showVolumeFeedback(volume) {
        if (stateObject.timers.volumeFeedback) clearTimeout(stateObject.timers.volumeFeedback);
        volFeedbackEl.textContent = `${Math.round(volume)}%`;
        volFeedbackEl.style.display = 'block';
        setTimeout(() => { volFeedbackEl.style.opacity = 1; }, 10);
        stateObject.timers.volumeFeedback = setTimeout(() => {
            volFeedbackEl.style.opacity = 0;
            setTimeout(() => { volFeedbackEl.style.display = 'none'; }, 280);
        }, 3000);
      }
      
      // Setup main controls
      closeBtn.addEventListener('click', isPip ? closeCustomPiP : closeModal);
      pipBtn.addEventListener('click', toggleCustomPiP);
      playBtn.addEventListener('click', () => { desiredPlaying = !(stateObject.instance.getPlayerState() === 1); resetInactivityTimer(); });
      seekEl.addEventListener('pointerdown', () => seekEl._drag=true, {passive:true});
      seekEl.addEventListener('pointerup', () => { seekEl._drag=false; const dur = stateObject.instance.getDuration(); if(dur) stateObject.instance.seekTo(dur * (parseFloat(seekEl.value)/100), true); }, {passive:true});
      seekEl.addEventListener('input', () => {
          if(seekEl._drag){
              const v = parseFloat(seekEl.value) || 0;
              seekProgressEl.style.width = `${v}%`;
              seekThumbEl.style.left = `${v}%`;
              const dur = stateObject.instance.getDuration();
              if (dur && curEl) curEl.textContent = fmtHHMMSS(Math.floor(dur * (v / 100)));
          }
      }, {passive:true});

      return loadYTApi().then(() => new Promise((resolve, reject) => {
          loadingDiv.classList.remove('hidden');
          stateObject.instance = new YT.Player(mount.id, {
              videoId: videoInfo.videoId,
              playerVars: { controls: 0, disablekb: 1, rel: 0, modestbranding: 1, playsinline: 1, iv_load_policy: 3, origin: location.origin },
              events: {
                  onReady: (evt) => {
                      const player = evt.target;
                      player.setVolume(mainPlayerState.lastVolume);
                      if (videoInfo.startTime) {
                          player.seekTo(videoInfo.startTime, true);
                      } else {
                         const savedTime = window.getVideoProgress(videoInfo.videoId);
                         if (savedTime > 0) player.seekTo(savedTime, true);
                      }
                      if(videoInfo.startPlaying) player.playVideo();
                      else player.pauseVideo();
                      
                      const iframe = player.getIframe();
                      if(iframe) iframe.style.pointerEvents = 'none';

                      if(stateObject.animationFrameId) cancelAnimationFrame(stateObject.animationFrameId);
                      updatePlayerUI();
                      resetInactivityTimer();
                      resolve(player);
                  },
                  onStateChange: (e) => {
                      if (e.data === 1) { // Playing
                          loadingDiv.classList.add('hidden');
                          resetInactivityTimer();
                      }
                  },
                  onError: (err) => { reject(err); }
              }
          });
      }));
  }

  function destroyPlayerInstance(stateObject) {
      if (stateObject.instance) {
          // Save final progress
          if (stateObject.videoId) {
              const cur = stateObject.instance.getCurrentTime();
              const dur = stateObject.instance.getDuration();
              if (cur > 1 && dur > 0 && dur - cur > 5) {
                window.saveVideoProgress(stateObject.videoId, cur);
              } else {
                window.saveVideoProgress(stateObject.videoId, 0);
              }
          }
          stateObject.instance.destroy();
          stateObject.instance = null;
      }
      if (stateObject.animationFrameId) {
          cancelAnimationFrame(stateObject.animationFrameId);
          stateObject.animationFrameId = null;
      }
      // Remove all event listeners
      document.removeEventListener('keydown', stateObject.eventListeners.keyHandler);
      document.removeEventListener('click', stateObject.eventListeners.docClick);
      document.removeEventListener('fullscreenchange', stateObject.eventListeners.fsListener);
      document.removeEventListener('webkitfullscreenchange', stateObject.eventListeners.fsListener);
      // Clear all timers
      for(const key in stateObject.timers) clearTimeout(stateObject.timers[key]);
  }

  window.setupPlayer = setupPlayer; // Expose to global scope for PiP script
  window.destroyPlayerInstance = destroyPlayerInstance; // Expose to global scope for PiP script

  window.showViduPlayer = function(videoInfo){
      const container = document.getElementById('player-wrap');
      return setupPlayer(videoInfo, container, window.mainPlayerState, false);
  };
  window.destroyViduPlayer = function() {
      destroyPlayerInstance(window.mainPlayerState);
      const w = document.getElementById('player-wrap');
      if (w) w.innerHTML = '';
  }

   window.addEventListener('beforeunload', () => {
        destroyPlayerInstance(window.mainPlayerState);
        destroyPlayerInstance(window.pipPlayerState);
    }, { passive: true });

})();
</script>
<script>
/*************************************************************************
 * Custom Picture-in-Picture Logic
 *************************************************************************/
const pipWindow = document.getElementById('custom-pip');
const pipHeader = document.getElementById('custom-pip-header');
const pipContent = document.getElementById('custom-pip-content');
const pipCloseBtn = document.getElementById('custom-pip-close');
const pipTitle = document.getElementById('custom-pip-title');

let isDragging = false;
let offsetX, offsetY;

async function toggleCustomPiP() {
    if (pipWindow.style.display === 'flex') {
        await closeCustomPiP();
    } else {
        await openCustomPiP();
    }
}

async function openCustomPiP() {
    const mainPlayer = window.mainPlayerState.instance;
    if (!mainPlayer || typeof mainPlayer.getCurrentTime !== 'function') return;

    // --- NEW: Show loading overlay ---
    const loadingPopup = document.getElementById('pip-loading-overlay');
    const loadingBar = document.getElementById('pip-loading-bar-fill');
    loadingBar.style.transition = 'none';
    loadingBar.style.width = '0%';
    loadingPopup.classList.add('show');
    setTimeout(() => {
        loadingBar.style.transition = 'width 2.5s cubic-bezier(0.25, 0.1, 0.25, 1)';
        loadingBar.style.width = '95%';
    }, 50);

    // 1. Get state from the main player
    const videoId = window.mainPlayerState.videoId;
    const title = window.mainPlayerState.title;
    const currentTime = mainPlayer.getCurrentTime();
    // --- FIX: Check for buffering state to ensure autoplay ---
    const isPlaying = [1, 3].includes(mainPlayer.getPlayerState()); // 1: playing, 3: buffering

    // 2. Hide main modal & destroy main player
    document.getElementById('modal-root').style.display = 'none';
    window.destroyViduPlayer();

    // 3. Setup PiP window
    pipTitle.textContent = title;
    pipWindow.style.display = 'flex';
    
    // 4. Create new player in PiP
    try {
        await window.setupPlayer({
            videoId: videoId,
            title: title,
            startTime: currentTime,
            startPlaying: isPlaying
        }, pipContent, window.pipPlayerState, true);

        // --- NEW: Hide loading overlay on success ---
        loadingBar.style.transition = 'width 0.3s ease-out';
        loadingBar.style.width = '100%';
        setTimeout(() => {
            loadingPopup.classList.remove('show');
        }, 300);

    } catch (error) {
        console.error("Failed to create PiP player:", error);
        pipContent.innerHTML = `<p style="color:white;padding:10px;">Player error.</p>`;
         // --- NEW: Hide loading overlay on error ---
        loadingPopup.classList.remove('show');
    }
}

async function closeCustomPiP() {
    const pipPlayer = window.pipPlayerState.instance;
    if (!pipPlayer || typeof pipPlayer.getCurrentTime !== 'function') {
        pipWindow.style.display = 'none';
        window.destroyPlayerInstance(window.pipPlayerState);
        pipContent.innerHTML = '';
        return;
    };
    
    // 1. Get state from PiP player
    const videoId = window.pipPlayerState.videoId;
    const title = window.pipPlayerState.title;
    const currentTime = pipPlayer.getCurrentTime();
    const isPlaying = pipPlayer.getPlayerState() === 1;

    // 2. Hide PiP window & destroy PiP player
    pipWindow.style.display = 'none';
    window.destroyPlayerInstance(window.pipPlayerState);
    pipContent.innerHTML = ''; // Clear content

    // 3. Re-create main player with the saved state
    playVideoWithLoading({ 
        videoId, 
        title, 
        startTime: currentTime,
        startPlaying: isPlaying
    });
}

// Drag functionality
pipHeader.addEventListener('mousedown', (e) => {
    isDragging = true;
    pipWindow.style.transition = 'none';
    offsetX = e.clientX - pipWindow.getBoundingClientRect().left;
    offsetY = e.clientY - pipWindow.getBoundingClientRect().top;
    document.body.style.userSelect = 'none';
});

document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    let newX = e.clientX - offsetX;
    let newY = e.clientY - offsetY;
    const maxX = window.innerWidth - pipWindow.offsetWidth;
    const maxY = window.innerHeight - pipWindow.offsetHeight;
    newX = Math.max(0, Math.min(newX, maxX));
    newY = Math.max(0, Math.min(newY, maxY));
    pipWindow.style.left = `${newX}px`;
    pipWindow.style.top = `${newY}px`;
    pipWindow.style.bottom = 'auto';
    pipWindow.style.right = 'auto';
});

document.addEventListener('mouseup', () => {
    isDragging = false;
    pipWindow.style.transition = '';
    document.body.style.userSelect = '';
});

pipCloseBtn.addEventListener('click', closeCustomPiP);


/*************************************************************************
 * Playlist data + UI + modal + YouTube playlist fetching (RESTORED)
 *************************************************************************/
const playlists = [ { id: 0, name: 'SUBJECTS', thumbnail: 'https://i.pinimg.com/736x/71/82/6e/71826ec9ece9f33d9034bb0acd3b8d1f.jpg', videos: [ { id: 1, name: 'ET', thumbnail: 'https://i.pinimg.com/736x/19/b2/42/19b2424009813fc558e8a785c794cbdf.jpg', videos: [ { name:'', thumbnail:'https://i.pinimg.com/736x/19/b2/42/19b2424009813fc558e8a785c794cbdf.jpg', type:'playlist', idEnc: "JiVdDwdDMwE8CD82enZEX0A4SQVvRzEEFj8eAEZGAlA/WkIGNk4VIgs9WWlhent5Pl81JjhB", passEnc: "" }, { name:'', thumbnail:'https://i.pinimg.com/736x/ea/60/d8/ea60d83595332fe2a7d11f1844072251.jpg', type:'playlist', idEnc: "JiVdDwdDMwE8CD82dFNrdjcTAhYmOlUACF0XEFRJZVkiCkIGNk4LOUBXQDRCQnRSMi4wMmYp", passEnc: "" } ] }, { id: 2, name: 'SFT', thumbnail: 'https://i.pinimg.com/736x/b8/de/57/b8de57f639bb30fd9f48cda542dd96d2.jpg', videos: [ { name:'', thumbnail:'https://i.pinimg.com/736x/2d/9d/1a/2d9d1a4affd566269879267ca70b74b8.jpg', type:'playlist', idEnc: "JiVdDwdDMwE8CD82dQkGUzsDJUIpXlMNBVBBN0ZnWAM6IUIGNk41NioUP21FXHtcGDYQIAUe", passEnc: "" }, { name:'', thumbnail:'https://i.pinimg.com/736x/42/9d/84/429d847241cfba744292224956707f45.jpg', type:'playlist', idEnc: "JiVdDwdDMwE8CD82d11cAxxZK01oQz06HiMmPkFpc3cyW0IGNk4TCT08RCt5AHdYQyU+AywV", passEnc: "" }, { name:'', thumbnail:'https://i.pinimg.com/736x/1f/24/4e/1f244ec99cab31c5d72348a736d361df.jpg', type:'playlist', idEnc: "JiVdDwdDMwE8CD82dUQDDD4zXQIlOhIgXzMlAHN+Ak9PIkIGNk5VCTgGQRdmUQQNIQwVTWpC", passEnc: "" } ] }, { id: 3, name: 'ICT', thumbnail: 'https://i.pinimg.com/736x/81/f4/0d/81f40de2906f0c61f2f17d6db61d7271.jpg', videos: [ { name:'', thumbnail:'https://i.pinimg.com/736x/81/f4/0d/81f40de2906f0c61f2f17d6db61d7271.jpg', type:'playlist', idEnc: "JiVdDwdDMwE8CD82dGVabCUtAhwaJTMuBycWPABxW0IGKkIGNk5UBEpVGytfan1tEhlVHRos", passEnc: "" } ] } ] } ];
function b64decode(s){ try{ return atob(s); }catch(e){ return s; } }
const decodeEnc = (function(){ const key = new TextEncoder().encode('vidu_secret_2025'); function xorDecode(bytes){ const out = new Uint8Array(bytes.length); for(let i=0;i<bytes.length;i++) out[i] = bytes[i] ^ key[i % key.length]; return out; } return function(encStr){ try{ if(!encStr) return ''; const raw = atob(encStr); const bytes = new Uint8Array(raw.split('').map(c=>c.charCodeAt(0))); const dec = xorDecode(bytes); return new TextDecoder().decode(dec); }catch(e){ return ''; } }; })();
function escapeHtml(s){ return (s||'').replace(/[&<>"'`]/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;","`":"&#96;"}[ch])); }

function getVideoProgress(videoId) {
    if (!videoId) return 0;
    try {
        const progress = JSON.parse(localStorage.getItem('vidu_video_progress') || '{}');
        return progress[videoId] || 0;
    } catch (e) {
        console.warn('Could not get video progress', e);
        return 0;
    }
}

function saveVideoProgress(videoId, time) {
    if (!videoId) return;
    try {
        const progress = JSON.parse(localStorage.getItem('vidu_video_progress') || '{}');
        if (time > 1) {
            progress[videoId] = time;
        } else {
            delete progress[videoId];
        }
        localStorage.setItem('vidu_video_progress', JSON.stringify(progress));
    } catch (e) {
        console.error("Failed to save video progress", e);
    }
}

function renderPlaylists(){
  const ul = document.getElementById('playlist-list');
  if(!ul) return;
  ul.innerHTML = '';
  if(!playlists || playlists.length === 0){ ul.innerHTML = '<li class="muted">No playlists available.</li>'; return; }
  playlists.forEach(pl=>{
    const li = document.createElement('li'); li.className='list-item ripple';
    // OPTIMIZATION: Added loading="lazy" to defer loading of off-screen images. Added width/height to prevent layout shift.
    li.innerHTML = `<img src="${escapeHtml(pl.thumbnail)}" alt="${escapeHtml(pl.name)}" loading="lazy" width="150" height="150" /><span class="title">${escapeHtml(pl.name)}</span>`;
    li.addEventListener('click', (ev)=>{ spawnRipple(ev, li); showPlaylistVideos(pl); });
    ul.appendChild(li);
  });
  ul.style.display = 'flex';
}

function showPlaylistVideos(pl, skipPush){
  const ul = document.getElementById('playlist-list');
  const container = document.getElementById('playlist-videos');
  if(!container || !ul) return;
  if(!window.__viduGlobal) window.__viduGlobal = {};
  if(!window.__viduGlobal.playlistStack) window.__viduGlobal.playlistStack = [];
  if(!skipPush){ window.__viduGlobal.playlistStack.push(window.__viduGlobal.currentPl || null); }
  window.__viduGlobal.currentPl = pl;
  ul.style.display = 'none';
  container.style.display = 'block';
  container.innerHTML = `<h3 style="text-align:center;color:#fff;">${escapeHtml(pl.name)}</h3>`;
  const vids = document.createElement('ul'); vids.className='list-container';
  (pl.videos||[]).forEach(v=>{
    const vli = document.createElement('li'); vli.className='list-item ripple';
    const thumb = v.thumbnail || '';
    // OPTIMIZATION: Added loading="lazy" to defer loading of off-screen images. Added width/height to prevent layout shift.
    vli.innerHTML = `<img src="${escapeHtml(thumb)}" alt="${escapeHtml(v.name)}" loading="lazy" width="150" height="150" /><span class="title">${escapeHtml(v.name)}</span>`;
    if(v && Array.isArray(v.videos)){
      vli.addEventListener('click',(ev)=>{ spawnRipple(ev, vli); showPlaylistVideos(v); });
    } else {
      vli.addEventListener('click',(ev)=>{
        spawnRipple(ev, vli);
        const expectedPassword = b64decode(v.passEnc || '');
        if (expectedPassword === '') {
          currentItem = v;
          showUnlockedItem(v);
        } else {
          openPasswordModal(v);
        }
      });
    }
    vids.appendChild(vli);
  });
  const back = document.createElement('div'); back.style.textAlign='center'; back.style.marginTop='16px';
  back.innerHTML = `<button id="back-to-playlists" class="btn secondary">Back</button>`;
  container.appendChild(vids); container.appendChild(back);
  document.getElementById('back-to-playlists').onclick = ()=>{
    const prev = (window.__viduGlobal.playlistStack && window.__viduGlobal.playlistStack.length) ? window.__viduGlobal.playlistStack.pop() : null;
    if(prev === null){ ul.style.display='flex'; container.style.display='none'; window.__viduGlobal.currentPl = null; }
    else { showPlaylistVideos(prev, true); }
  };
}

function spawnRipple(ev,target){ const rect = target.getBoundingClientRect(); const drop = document.createElement('div'); drop.className = 'drop'; drop.style.left = (ev.clientX - rect.left) + 'px'; drop.style.top = (ev.clientY - rect.top) + 'px'; target.appendChild(drop); setTimeout(()=> drop.remove(),700); }

let currentItem = null;
let currentPlaylistCache = {};

function createModal(){
  const root = document.getElementById('modal-root');
  root.innerHTML = `<div class="modal-backdrop" id="modal-backdrop"><div class="modal" role="dialog" aria-modal="true"><div class="controls"><div><strong id="modal-title">Locked</strong><div class="muted" id="modal-subtitle" style="color:#bbb;font-size:12px;"></div></div><div><button id="modal-close" class="btn secondary">Close</button></div></div><div id="modal-body"><div id="password-block"><div style="color:#bbb;margin-bottom:8px;">This item is password-protected.</div><div class="password-row"><input id="password-input" type="password" placeholder="Enter password" /><button id="password-submit" class="btn">Unlock</button></div><div id="password-error" style="margin-top:8px;color:#f66;display:none;"></div></div><div id="player-block" style="display:none;margin-top:12px;"><div id="player-wrap"></div></div></div></div>`;
  document.getElementById('modal-close').onclick = closeModal;
  document.getElementById('password-submit').onclick = onPasswordSubmit;
  document.getElementById('password-input').onkeydown = (e)=>{ if(e.key === 'Enter') onPasswordSubmit(); };
  document.getElementById('modal-backdrop').onclick = function(e){ if(e.target === this) closeModal(); };
}

function showUnlockedItem(item) {
  if (item.type === 'playlist') {
    openFullScreenPlaylist(item);
  } else {
    const id = decodeEnc(item.idEnc || '');
    playVideoWithLoading({ videoId: id, title: item.name || 'Video', startPlaying: true });
  }
}

function openPasswordModal(item){
  currentItem = item;
  const root = document.getElementById('modal-root');
  root.style.display = 'block';
  document.getElementById('modal-title').textContent = item.name || 'Protected';
  document.getElementById('modal-subtitle').textContent = (item.type || 'video') + ' ‚Äî password required';
  document.getElementById('password-input').value = '';
  document.getElementById('password-error').style.display = 'none';
  document.getElementById('password-block').style.display = 'block';
  document.getElementById('player-block').style.display = 'none';
  setTimeout(()=>document.getElementById('password-input').focus(), 50);
}

function closeModal(){
  const root = document.getElementById('modal-root');
  if(root) {
    root.style.display = 'none';
    root.style.visibility = 'visible';
  }
  if(window.destroyViduPlayer) try{ window.destroyViduPlayer(); }catch(e){}
  if (currentItem && currentItem.type === 'playlist') {
    const fsPlaylist = document.getElementById('fullscreen-playlist-overlay');
    if (fsPlaylist) fsPlaylist.classList.add('show');
  } else {
    currentItem = null;
  }
}

function onPasswordSubmit(){
  const val = (document.getElementById('password-input').value || '').trim();
  if(!currentItem) return;
  const expected = b64decode(currentItem.passEnc || '');
  if(val === expected){
    const root = document.getElementById('modal-root');
    if(root) root.style.display = 'none';
    showUnlockedItem(currentItem);
  } else {
    const err = document.getElementById('password-error'); err.style.display = 'block'; err.textContent = 'Incorrect password ‚Äî try again.';
  }
}

const YT_API_KEY = 'AIzaSyB8UVKOZOnUnYdqbFGOtlg6BPfR9HpD35c';
async function fetchPlaylistVideos(playlistId){
  if(!YT_API_KEY || YT_API_KEY === 'YOUR_API_KEY_HERE') throw new Error('No API key configured.');
  if (currentPlaylistCache[playlistId]) return currentPlaylistCache[playlistId];
  const items=[]; let pageToken='';
  do{
    const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${encodeURIComponent(playlistId)}&key=${encodeURIComponent(YT_API_KEY)}` + (pageToken?`&pageToken=${pageToken}`:'');
    const res = await fetch(url);
    if(!res.ok){ const txt = await res.text().catch(()=>null); throw new Error(`YouTube API error: ${res.status} ${txt||''}`); }
    const data = await res.json();
    (data.items||[]).forEach(it=>{
      const sn = it.snippet || {};
      if(sn.resourceId && sn.resourceId.videoId && sn.title !== 'Private video' && sn.title !== 'Deleted video'){
        const thumb = (sn.thumbnails && (sn.thumbnails.high||sn.thumbnails.medium||sn.thumbnails.default))||{};
        items.push({ videoId: sn.resourceId.videoId, title: sn.title||'Untitled', thumb: thumb.url||`https://img.youtube.com/vi/${sn.resourceId.videoId}/hqdefault.jpg` });
      }
    });
    pageToken = data.nextPageToken || '';
  } while(pageToken);
  currentPlaylistCache[playlistId] = items;
  return items;
}

async function openFullScreenPlaylist(item) {
  const overlay = document.getElementById('fullscreen-playlist-overlay');
  const titleEl = document.getElementById('fs-playlist-title');
  const countEl = document.getElementById('fs-playlist-count');
  const contentEl = document.getElementById('fs-playlist-content');
  const loaderEl = document.getElementById('fs-playlist-loader');
  titleEl.textContent = item.name || 'Playlist';
  countEl.textContent = '... Videos';
  contentEl.innerHTML = '';
  loaderEl.style.display = 'flex';
  overlay.classList.add('show');
  const rawId = decodeEnc(item.idEnc);
  const playlistId = rawId.split('&')[0];
  try {
    const videos = await fetchPlaylistVideos(playlistId);
    renderFullScreenPlaylist(videos, item.name);
  } catch (err) {
    console.error('Playlist fetch error', err);
    contentEl.innerHTML = `<p style="text-align:center; color: var(--muted);">Failed to load playlist: ${escapeHtml(err.message)}</p>`;
  } finally {
    loaderEl.style.display = 'none';
  }
}

function renderFullScreenPlaylist(videos, title) {
  const titleEl = document.getElementById('fs-playlist-title');
  const countEl = document.getElementById('fs-playlist-count');
  const contentEl = document.getElementById('fs-playlist-content');
  titleEl.textContent = title || 'Playlist';
  countEl.textContent = `${videos.length} Videos`;
  contentEl.innerHTML = '';
  const fragment = document.createDocumentFragment();
  videos.forEach((video, index) => {
    const li = document.createElement('div');
    li.className = 'fs-playlist-item';
    li.innerHTML = `
        <div class="video-number-thumbnail">
            <span>${index + 1}</span>
        </div>
        <div class="title">${escapeHtml(video.title)}</div>
    `;
    li.onclick = () => playVideoWithLoading({ videoId: video.videoId, title: video.title, startPlaying: true });
    fragment.appendChild(li);
  });
  contentEl.appendChild(fragment);
}

function playVideoWithLoading(videoInfo) {
  if (document.getElementById('custom-pip').style.display === 'flex') {
      closeCustomPiP(); 
  }

  const fsPlaylist = document.getElementById('fullscreen-playlist-overlay');
  const loadingPopup = document.getElementById('player-loading-overlay');
  const loadingBar = document.getElementById('player-loading-bar-fill');
  const root = document.getElementById('modal-root');

  fsPlaylist.classList.remove('show');
  loadingPopup.classList.add('show');

  loadingBar.style.transition = 'none';
  loadingBar.style.width = '0%';
  setTimeout(() => {
    loadingBar.style.transition = 'width 4s cubic-bezier(0.25, 0.1, 0.25, 1)';
    loadingBar.style.width = '90%';
  }, 50);

  root.style.display = 'block';
  root.style.visibility = 'hidden';
  document.getElementById('modal-title').textContent = videoInfo.title;
  document.getElementById('modal-subtitle').textContent = 'Now Playing';
  document.getElementById('password-block').style.display = 'none';
  document.getElementById('player-block').style.display = 'block';

  window.showViduPlayer(videoInfo)
      .then(player => {
        loadingBar.style.transition = 'width 0.3s ease-out';
        loadingBar.style.width = '100%';

        setTimeout(() => {
          loadingPopup.classList.remove('show');
          root.style.visibility = 'visible';

            if (!videoInfo.startTime) {
              const savedTime = getVideoProgress(videoInfo.videoId);
              if (savedTime && savedTime > 0) {
                const restoringPopup = document.getElementById('restoring-position-overlay');
                const restoringBar = document.getElementById('restoring-bar-fill');
                if(restoringPopup && restoringBar) {
                  restoringPopup.classList.add('show');
                  restoringBar.style.transition = 'none';
                  restoringBar.style.width = '0%';
                  setTimeout(() => {
                    restoringBar.style.transition = 'width 2s cubic-bezier(0.25, 1, 0.5, 1)';
                    restoringBar.style.width = '100%';
                  }, 10);
                  setTimeout(() => {
                    restoringPopup.classList.remove('show');
                  }, 2000);
                }
              }
            }


          setTimeout(() => {
            loadingBar.style.transition = 'none';
            loadingBar.style.width = '0%';
          }, 300);
        }, 300);
      })
      .catch(err => {
        console.error('showViduPlayer failed', err);
        loadingPopup.classList.remove('show');
        root.style.visibility = 'visible';
        const wrap = document.getElementById('player-wrap');
        if (wrap) wrap.innerHTML = `<div class="muted">Failed to load player: ${escapeHtml(err.message || '')}</div>`;
      });
}

document.addEventListener('DOMContentLoaded', function(){
  createModal();
  renderPlaylists();
  (function stagger(){ const cards=document.querySelectorAll('.list-item'); cards.forEach((c,i)=> c.style.animationDelay=(i*60)+'ms'); })();
  document.getElementById('fs-playlist-close-btn').addEventListener('click', () => {
    document.getElementById('fullscreen-playlist-overlay').classList.remove('show');
    currentItem = null;
  });
});

document.addEventListener('contextmenu', e => e.preventDefault(), false);
document.addEventListener('keydown', e => { if ((e.ctrlKey && e.shiftKey && (e.key==='I'||e.key==='i'||e.key==='J'||e.key==='j')) || (e.ctrlKey && (e.key==='U'||e.key==='u')) || (e.key==='F12')) e.preventDefault(); });
document.addEventListener('keydown', e => { 
    if (e.key === 'Escape') { 
        const root = document.getElementById('modal-root'); 
        const fsPlaylist = document.getElementById('fullscreen-playlist-overlay');
        const customPip = document.getElementById('custom-pip');
        if (customPip && customPip.style.display === 'flex') closeCustomPiP();
        else if (root && root.style.display !== 'none') closeModal();
        else if (fsPlaylist && fsPlaylist.classList.contains('show')) {
            fsPlaylist.classList.remove('show');
            currentItem = null;
        }
    } 
});
</script>

<!-- OPTIMIZATION: Added the 'defer' attribute to these scripts. This allows the browser to parse the HTML without being blocked by script loading, improving the initial page load time. The scripts will execute in order after the document is parsed. -->
<script src="assets/js/jquery.min.js" defer></script>
<script src="assets/js/browser.min.js" defer></script>
<script src="assets/js/breakpoints.min.js" defer></script>
<script src="assets/js/util.js" defer></script>
<script src="assets/js/main.js" defer></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const notificationBtn = document.getElementById('notification-btn'), notificationPanel = document.getElementById('notification-panel'), notificationCloseBtn = document.getElementById('notification-close-btn');
    if (notificationBtn && notificationPanel && notificationCloseBtn) {
        function showPanel() { notificationPanel.classList.add('show'); notificationPanel.setAttribute('aria-hidden', 'false'); }
        function hidePanel() { notificationPanel.classList.remove('show'); notificationPanel.setAttribute('aria-hidden', 'true'); }
        notificationBtn.addEventListener('click', (event) => { event.stopPropagation(); notificationPanel.classList.contains('show') ? hidePanel() : showPanel(); });
        notificationCloseBtn.addEventListener('click', hidePanel);
        document.addEventListener('click', (event) => { if (notificationPanel.classList.contains('show') && !notificationPanel.contains(event.target) && !notificationBtn.contains(event.target)) hidePanel(); });
        document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && notificationPanel.classList.contains('show')) hidePanel(); });
    }
    const downloadBtn = document.getElementById('download-btn-header'), loadingPopup = document.getElementById('loading-popup-overlay'), loadingBar = document.getElementById('loading-bar-fill');
    if (downloadBtn && loadingPopup && loadingBar) {
        downloadBtn.addEventListener('click', () => {
            const url = downloadBtn.dataset.link;
            loadingBar.style.transition = 'none'; loadingBar.style.width = '0%';
            loadingPopup.classList.add('show');
            setTimeout(() => { loadingBar.style.transition = 'width 3s linear'; loadingBar.style.width = '100%'; }, 50);
            setTimeout(() => {
                window.open(url, '_blank', 'noopener,noreferrer');
                loadingPopup.classList.remove('show');
                setTimeout(() => { loadingBar.style.transition = 'none'; loadingBar.style.width = '0%'; }, 300);
            }, 3000);
        });
    }
});
</script>
</body>
</html>
