<!DOCTYPE HTML>
<html>
<head>
  <title>VIDU</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    /* ====== Original page CSS (unchanged logic) ====== */
    :root{ --bg-overlay: rgba(4,6,12,0.46); --glass: rgba(255,255,255,0.04); --glass-strong: rgba(255,255,255,0.06); --accent-1: #7b61ff; --accent-2:#39ff14; --accent-3:#ff6b6b; --muted:#bfc8dd; --text:#f2f6ff; --card-radius:10px; --ease:cubic-bezier(.16,.84,.24,1);}

    body{
      background:url('assets/images/background.gif') no-repeat center center fixed;
      background-size:cover;
      font-family:"Inter","Helvetica Neue",Arial,sans-serif;
      color:var(--text);
      margin:0;
      min-height:100vh;
      position:relative;
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    body::before{ content:''; position:fixed; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.38)); pointer-events:none; z-index:0; mix-blend-mode:multiply; }
    #wrapper{position:relative;z-index:3;padding-bottom:48px;}
    header#header{ display:flex; align-items:center; justify-content:space-between; padding:14px 22px; backdrop-filter: blur(8px) saturate(130%); background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-bottom: none; border-radius:0 0 10px 10px; z-index:4; position:relative; box-shadow:0 8px 40px rgba(2,4,12,0.6); }
    .logo{ display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text); user-select:none; position:relative; }
    .logo-circle{ width: clamp(72px, 9vw, 120px); aspect-ratio: 1/1; border-radius:50%; overflow:hidden; display:flex; align-items:center; justify-content:center; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border: 10px solid rgba(255,255,255,0.06); box-shadow: 0 10px 28px rgba(0,0,0,0.55); backdrop-filter: blur(6px) saturate(120%); transform: translateZ(0); flex-shrink:0; }
    .logo-circle img{ width:100%; height:100%; object-fit:cover; object-position:center center; display:block; transform: translateZ(0); }
    nav ul{list-style:none;margin:0;padding:0;display:flex;gap:10px;align-items:center;}
    nav ul li a{ font-weight:700; font-size:14px; position:relative; padding:8px 12px; color:var(--muted); text-decoration:none; border-radius:8px; transition:all .18s var(--ease); display:inline-block; border: none; box-shadow: none; outline: none; background: transparent; }
    nav ul li a:hover{color:var(--text);transform: translateY(-3px) scale(1.02);box-shadow:0 10px 30px rgba(66,44,145,0.12);}

    .wrapper.style1{padding-top:24px;}
    .inner{max-width:1100px;margin:0 auto;padding:20px;position:relative;z-index:3;}
    .list-container{list-style:none;padding:0;display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;align-items:flex-start;margin-top:6px;}
    .list-item{width:150px;cursor:pointer;text-align:center;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--card-radius);padding:10px;transition:transform .28s var(--ease),box-shadow .28s var(--ease),filter .28s var(--ease); border:1px solid rgba(255,255,255,0.04); box-shadow:0 8px 30px rgba(6,8,16,0.6);position:relative;overflow:visible;transform-style:preserve-3d;will-change:transform;backdrop-filter:blur(6px) saturate(120%);}
    .list-item::after{content:'';position:absolute;left:8px;right:8px;bottom:8px;height:4px;border-radius:4px;background:linear-gradient(90deg, rgba(123,97,255,0.25), rgba(57,255,20,0.18), rgba(255,107,107,0.12));opacity:0;transform:translateY(6px);transition:opacity .25s var(--ease),transform .25s var(--ease);pointer-events:none;}
    .list-item:hover::after{opacity:1;transform:translateY(0);}
    .list-item:hover{transform: translateY(-10px) rotateX(6deg) scale(1.03); box-shadow:0 28px 60px rgba(6,8,16,0.75); filter:saturate(1.08);}
    .list-item img{width:100%;border-radius:6px;display:block;transition:transform .6s var(--ease),box-shadow .4s var(--ease);transform-origin:center;box-shadow:0 8px 24px rgba(0,0,0,0.45), inset 0 -6px 16px rgba(0,0,0,0.08);will-change:transform;background:linear-gradient(180deg, rgba(0,0,0,0.08), rgba(0,0,0,0.02));}
    .list-item:hover img{transform:scale(1.06) translateZ(18px);}
    .list-item .title{display:block;margin-top:0.45rem;color:var(--text);font-weight:700;font-size:14px;text-shadow:0 1px 0 rgba(0,0,0,0.45);}

    .modal-backdrop{position:fixed;inset:0;background:linear-gradient(180deg, rgba(2,3,8,0.6), rgba(0,0,0,0.75));display:flex;align-items:center;justify-content:center;z-index:9999;}
    .modal{width:min(960px,95%);background:linear-gradient(180deg, rgba(12,12,12,0.96), rgba(6,6,8,0.98));border-radius:14px;padding:18px;color:#fff;border:1px solid rgba(255,255,255,0.035);box-shadow:0 40px 100px rgba(2,6,18,0.9);}
    .modal iframe{width:100%;height:540px;border-radius:8px;border:0;background:#000;box-shadow:0 10px 40px rgba(0,0,0,0.7);}

    .controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px;}
    .btn{background:linear-gradient(90deg, var(--accent-1), var(--accent-3));color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700;}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);box-shadow:none;}

    .password-row{display:flex;gap:8px;margin-top:8px;}
    .password-row input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:var(--text);outline:none;transition:box-shadow .15s;}
    .password-row input:focus{box-shadow:0 8px 30px rgba(123,97,255,0.12);}
    .muted{color:var(--muted);font-size:13px;}

    @media (max-width:720px){ .list-item{width:calc(50% - 12px);} .modal iframe{height:320px;} }

    .list-item{opacity:0;transform-origin:center;animation:floatIn .5s forwards;}
    @keyframes floatIn{from{opacity:0;transform:translateY(12px) scale(.995);}to{opacity:1;transform:translateY(0) scale(1);}}

    .ripple{position:relative;overflow:hidden;}
    .ripple .drop{position:absolute;border-radius:50%;transform:scale(0);background:rgba(255,255,255,0.10);animation:rip .6s ease-out;pointer-events:none;}
    @keyframes rip{to{transform:scale(6);opacity:0;}}

    header nav ul li a, .logo{position:relative;z-index:2;overflow:visible;}
    header nav ul li a::before, .logo::before{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius:14px;
      background:linear-gradient(90deg,
        rgba(57,190,60,0.06) 0%,
        rgba(57,190,60,0.20) 25%,
        rgba(57,190,60,0.45) 50%,
        rgba(57,190,60,0.20) 75%,
        rgba(57,190,60,0.06) 100%);
      background-size:300% 100%;
      filter:blur(8px) saturate(120%);
      opacity:0.88;
      z-index:-1;
      transition:opacity .22s ease, transform .22s ease;
      pointer-events:none;
      background-position: var(--neon-x, 0%) 50%;
    }
    header nav ul li a::after, .logo::after{content:"";position:absolute;inset:-4px;border-radius:12px;border:1px solid rgba(57,190,60,0.22);opacity:0.75;z-index:-1;pointer-events:none;transition:opacity .18s ease, transform .18s ease;backdrop-filter:blur(2px);}

    header nav ul li a.hover-strong::before, .logo.hover-strong::before{filter:blur(12px) saturate(180%);transform:scale(1.03);opacity:1;}
    header nav ul li a.hover-strong::after, .logo.hover-strong::after{border-color:rgba(57,190,60,0.38);opacity:1;transform:translateY(-2px);}
    header nav ul li a.touch-active, .logo.touch-active{transform:scale(0.985);transition:transform .08s linear;box-shadow:0 6px 18px rgba(0,0,0,0.6);}
    header nav ul li a.touch-active::before, .logo.touch-active::before{filter:blur(6px) saturate(160%);transform:scale(1.01);opacity:1;animation-duration:1.6s;}
    header nav ul li a.pulse, .logo.pulse{animation:btnPulse .5s ease-out;}
    @keyframes btnPulse{0%{box-shadow:0 0 0 rgba(57,255,20,0.28);}50%{box-shadow:0 0 30px rgba(57,255,20,0.22);}100%{box-shadow:0 0 0 rgba(57,255,20,0);}}
    @media (prefers-reduced-motion: reduce){ header nav ul li a::before, .logo::before{animation:none;transition:none;filter:blur(6px);} }

    .playlist-list{display:flex;flex-direction:column;gap:8px;margin-top:12px;max-height:320px;overflow:auto;padding-top:6px;}
    .playlist-list .list-item{width:100%;display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;}
    .playlist-list .list-item img{width:140px;height:78px;object-fit:cover;border-radius:6px;}

    /* ====== Overlay CSS (namespaced & updated) ====== */
    .vidu-overlay-global {
      position: absolute;
      z-index: 2147483647;
      pointer-events: auto;
      display:flex;
      align-items:center;
      gap:12px;
      background: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.28));
      padding:10px;
      border-radius:8px;
      transition: opacity .12s ease;
      box-sizing:border-box;
      min-width: 220px;
    }
    .vidu-overlay-global .vidu-btn { background: rgba(255,255,255,0.06); color:#fff; padding:8px; border-radius:8px; cursor:pointer; font-weight:700; user-select:none; border:1px solid rgba(255,255,255,0.04); display:flex; align-items:center; justify-content:center; width:44px; height:44px; }
    .vidu-overlay-global .vidu-range { flex:1; -webkit-appearance:none; height:8px; border-radius:8px; background: rgba(255,255,255,0.06); }
    .vidu-overlay-global .vidu-range::-webkit-slider-thumb { -webkit-appearance:none; width:14px; height:14px; border-radius:50%; background:#7b61ff; box-shadow:0 2px 8px rgba(0,0,0,0.5); }
    .vidu-overlay-global .vidu-time { min-width:48px; font-size:12px; color:#cbd5ff; text-align:center; }

    .vidu-overlay-fixed {
      position: fixed !important;
      left: 0 !important; top: 0 !important; width: 100% !important; height: auto !important;
      display:flex; align-items:flex-end; justify-content:center; padding:18px; pointer-events:auto;
      box-sizing:border-box;
    }

    @media (max-width:720px){ .vidu-overlay-global{ left:8px; right:8px; bottom:8px; } }
  </style>
</head>
<body class="landing is-preload">

  <div id="wrapper">
    <header id="header">
      <a href="index.html" class="logo" aria-label="VIDU home" title="VIDU home">
        <div class="logo-circle" aria-hidden="true">
          <img src="https://i.pinimg.com/736x/4d/fa/7b/4dfa7b57656b556f257b4a2e4f8fc8fa.jpg" alt="VIDU Logo" />
        </div>
      </a>

      <nav>
        <ul>
          <li><a id="nav-home">Classes</a></li>
          <li><a href="videos.html">Private</a></li>
          <li><a href="about.html">About</a></li>
        </ul>
      </nav>
    </header>

    <section id="home" class="wrapper style1 fade-up">
      <div class="inner">
        <h2></h2>
        <ul id="playlist-list" class="list-container"></ul>
        <div id="playlist-videos" style="margin-top:2rem; display:none;"></div>
      </div>
    </section>

    <footer id="footer">
      <p>&copy; VIDU. 2025 All rights reserved.</p>
    </footer>
  </div>

  <!-- Modal root -->
  <div id="modal-root" style="display:none;"></div>

  <script>
  /*************************************************************************
   * Final overlay player script
   * - Fix: fullscreen toggles (enter/exit)
   * - Fix: iframe grows to full viewport in fullscreen
   * - Fix: play/pause icon (SVG) instead of text
   * - All other behavior preserved
   *************************************************************************/

  const YT_API_KEY = 'AIzaSyDFyNxJJ_LbTEwLZkcLZ0wT3bDNfGcHCAI';
  if(!window.__viduGlobal) window.__viduGlobal = {};
  if(!window.__viduGlobal.vOverlayInit) {
    window.__viduGlobal.vOverlayInit = true;

    (function(){
      const state = { player: null, updateTimer: null, overlayEl: null, rafId: null, keyHandler: null, mo: null, host: null, mount: null };

      function loadYTApi(){
        if(window.YT && window.YT.Player) return Promise.resolve();
        if(window._vidu_loading_yt) {
          return new Promise((res, rej) => {
            const t = setInterval(()=>{ if(window.YT && window.YT.Player){ clearInterval(t); res(); } }, 120);
            setTimeout(()=>{ clearInterval(t); rej(new Error('YT load timeout')); }, 20000);
          });
        }
        window._vidu_loading_yt = true;
        return new Promise((resolve, reject)=>{
          const s = document.createElement('script');
          s.src = 'https://www.youtube.com/iframe_api';
          s.async = true;
          s.onerror = ()=> reject(new Error('YT API failed to load'));
          document.head.appendChild(s);
          window.onYouTubeIframeAPIReady = function(){ resolve(); };
          setTimeout(()=>{ if(window.YT && window.YT.Player) resolve(); }, 800);
          setTimeout(()=>{ if(!(window.YT && window.YT.Player)) reject(new Error('YT API timed out')); }, 20000);
        });
      }

      function formatTime(s){
        s = Math.max(0, Math.floor(s||0));
        const mm = Math.floor(s/60), ss = s%60;
        return mm + ':' + (ss < 10 ? '0'+ss : ss);
      }

      function playIconSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 4.5v15l12-7.5L6 4.5z" fill="#fff"/></svg>`; }
      function pauseIconSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="5" y="4" width="4" height="16" rx="1.2" fill="#fff"/><rect x="15" y="4" width="4" height="16" rx="1.2" fill="#fff"/></svg>`; }
      function setPlayIcon(isPlaying){
        const ov = state.overlayEl; if(!ov) return;
        const btn = ov.querySelector('#vidu_btn_play');
        if(!btn) return;
        btn.innerHTML = isPlaying ? pauseIconSVG() : playIconSVG();
      }

      function ensureOverlay(){
        if(state.overlayEl) return state.overlayEl;
        const ov = document.createElement('div');
        ov.className = 'vidu-overlay-global';
        ov.setAttribute('role','region');
        ov.setAttribute('aria-label','Video controls');
        ov.style.pointerEvents = 'auto';
        ov.innerHTML = `
          <button class="vidu-btn" id="vidu_btn_play">${playIconSVG()}</button>
          <div class="vidu-time" id="vidu_time_cur">0:00</div>
          <input id="vidu_range" class="vidu-range" type="range" min="0" max="100" step="0.1" value="0" />
          <div class="vidu-time" id="vidu_time_dur">0:00</div>
          <button class="vidu-btn" id="vidu_btn_full">⤢</button>
        `;
        document.body.appendChild(ov);
        state.overlayEl = ov;

        const btnPlay = ov.querySelector('#vidu_btn_play');
        btnPlay.addEventListener('click', ()=>{
          if(!state.player) return;
          try{
            const st = state.player.getPlayerState();
            if(st === 1) state.player.pauseVideo();
            else state.player.playVideo();
          }catch(e){ console.warn('play toggle err', e); }
        });

        const range = ov.querySelector('#vidu_range');
        range.addEventListener('pointerdown', ()=> range._dragging = true, {passive:true});
        range.addEventListener('pointerup', ()=>{
          range._dragging = false;
          if(!state.player) return;
          const dur = state.player.getDuration ? state.player.getDuration() : 0;
          if(dur) state.player.seekTo(dur * (parseFloat(range.value)/100), true);
        }, {passive:true});
        range.addEventListener('input', ()=>{
          if(!state.player) return;
          if(range._dragging){
            const dur = state.player.getDuration ? state.player.getDuration() : 0;
            if(dur) ov.querySelector('#vidu_time_cur').textContent = formatTime(dur * (parseFloat(range.value)/100));
          }
        }, {passive:true});

        ov.querySelector('#vidu_btn_full').addEventListener('click', ()=>{
          // toggle fullscreen: if fullscreen -> exit; else request on host
          const fs = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
          if(fs){
            const exit = document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen;
            if(exit) exit.call(document);
          } else {
            const container = state.host || document.getElementById('player-wrap');
            if(container){
              const req = container.requestFullscreen || container.webkitRequestFullscreen || container.mozRequestFullScreen || container.msRequestFullscreen;
              if(req) req.call(container);
            }
          }
        });

        return ov;
      }

      // make overlay track the host bounding rect (and switch to fixed in fullscreen)
      function positionOverlayFor(host){
        if(!host) return;
        state.host = host;
        const ov = ensureOverlay();
        function applyRect(r){
          if(!ov) return;
          const fs = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
          if(fs){
            ov.classList.add('vidu-overlay-fixed');
            ov.style.left = '0px'; ov.style.top = '0px'; ov.style.width = '100%'; ov.style.height = 'auto';
            ov.style.padding = '18px'; ov.style.justifyContent = 'center'; ov.style.alignItems = 'flex-end';
          } else {
            ov.classList.remove('vidu-overlay-fixed');
            ov.style.position = 'absolute';
            ov.style.left = (Math.round(r.left) + 12) + 'px';
            // place overlay near bottom, but keep it inside host
            const bottomY = Math.round(r.top + r.height - 68);
            ov.style.top = bottomY + 'px';
            ov.style.width = Math.max(300, Math.round(r.width - 24)) + 'px';
            ov.style.height = 'auto';
            ov.style.justifyContent = 'space-between';
            ov.style.alignItems = 'center';
          }
        }

        // initial placement
        applyRect(host.getBoundingClientRect());

        // RAF loop
        cancelAnimationFrame(state.rafId || 0);
        function rafLoop(){
          try{
            const rect = host.getBoundingClientRect();
            applyRect(rect);
          }catch(e){}
          state.rafId = requestAnimationFrame(rafLoop);
        }
        state.rafId = requestAnimationFrame(rafLoop);
      }

      function killOverlayPositioning(){
        if(state.rafId){ cancelAnimationFrame(state.rafId); state.rafId = null; }
      }

      function disableIframeInteraction(h){
        try{
          const iframe = h.querySelector('iframe');
          if(iframe){
            iframe.style.pointerEvents = 'none';
            iframe.classList.add('vidu-yt-blocked');
            if(!iframe.hasAttribute('allow')) iframe.setAttribute('allow', 'autoplay; encrypted-media; fullscreen');
            iframe.setAttribute('allowfullscreen','');
            iframe.setAttribute('tabindex','-1');
          }
        }catch(e){ console.warn('disableIframeInteraction', e); }
      }

      // create player host + mount, ensure later fullscreen expands iframe to viewport height
      function createPlayerIn(container, videoId){
        if(!container) return Promise.reject(new Error('player-wrap missing'));
        // clear only player-wrap
        container.innerHTML = '';
        // host wrapper
        const host = document.createElement('div');
        host.className = 'vidu-player-container-host';
        host.style.width = '100%';
        host.style.position = 'relative';
        host.style.height = 'auto';
        container.appendChild(host);

        // mount
        const mountId = 'vidu_yt_mount_' + Math.floor(Math.random()*1000000);
        const mount = document.createElement('div');
        mount.id = mountId;
        mount.style.width = '100%';
        mount.style.height = '520px';
        mount.style.background = '#000';
        host.appendChild(mount);

        // save for later
        state.host = host; state.mount = mount;

        // position overlay and set up full-screen awareness
        ensureOverlay();
        positionOverlayFor(host);

        // fullscreen change handler: expand mount height when host is fullscreen
        function onFSC(){
          const fs = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
          if(fs === host){ // our host entered fullscreen
            try{ mount.style.height = window.innerHeight + 'px'; }catch(e){}
          } else {
            try{ mount.style.height = '520px'; }catch(e){}
          }
          // also switch overlay class handled by positionOverlayFor's RAF, but call onFullScreenChange to re-evaluate
        }
        document.addEventListener('fullscreenchange', onFSC);
        document.addEventListener('webkitfullscreenchange', onFSC);
        document.addEventListener('mozfullscreenchange', onFSC);

        // load YT player
        return loadYTApi().then(()=> {
          return new Promise((resolve, reject)=>{
            // if there's already a player, destroy
            if(state.player && typeof state.player.destroy === 'function'){
              try{ state.player.destroy(); }catch(e){} state.player = null;
            }
            state.player = new YT.Player(mountId, {
              videoId: videoId,
              width: '100%',
              height: '100%',
              playerVars: {
                controls: 0,
                disablekb: 1,
                rel: 0,
                modestbranding: 1,
                playsinline: 1,
                iv_load_policy: 3,
                origin: location.origin
              },
              events: {
                onReady: function(evt){
                  // block iframe clicks
                  disableIframeInteraction(host);
                  try{ evt.target.playVideo(); }catch(e){}
                  // ensure mount height respects potential fullscreen state
                  const fsEl = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
                  if(fsEl === host){ mount.style.height = window.innerHeight + 'px'; } else { mount.style.height = '520px'; }

                  // update loop
                  if(state.updateTimer) clearInterval(state.updateTimer);
                  state.updateTimer = setInterval(()=> {
                    try{
                      if(!state.player) return;
                      const dur = state.player.getDuration ? state.player.getDuration() : 0;
                      const cur = state.player.getCurrentTime ? state.player.getCurrentTime() : 0;
                      const ov = ensureOverlay();
                      if(ov){
                        const rcur = ov.querySelector('#vidu_time_cur');
                        const rdur = ov.querySelector('#vidu_time_dur');
                        const rrange = ov.querySelector('#vidu_range');
                        if(rcur) rcur.textContent = formatTime(cur);
                        if(rdur) rdur.textContent = (dur && isFinite(dur)) ? formatTime(dur) : '0:00';
                        if(rrange && !rrange._dragging && dur && isFinite(dur)){
                          rrange.value = (cur / Math.max(1,dur))*100;
                        }
                        const st = state.player.getPlayerState ? state.player.getPlayerState() : -1;
                        setPlayIcon(st === 1);
                      }
                    }catch(e){}
                  }, 160);

                  // spacebar toggling when modal visible
                  state.keyHandler = function(e){
                    if(e.code === 'Space' || e.key === ' '){
                      const tag = (document.activeElement && document.activeElement.tagName) || '';
                      if(tag === 'INPUT' || tag === 'TEXTAREA' || (document.activeElement && document.activeElement.isContentEditable)) return;
                      const root = document.getElementById('modal-root');
                      if(!root || root.style.display === 'none') return;
                      e.preventDefault();
                      try{
                        const st = state.player.getPlayerState();
                        if(st === 1) state.player.pauseVideo();
                        else state.player.playVideo();
                      }catch(e){}
                    }
                  };
                  document.addEventListener('keydown', state.keyHandler);

                  // watch host subtree for iframe changes
                  if(state.mo) state.mo.disconnect();
                  state.mo = new MutationObserver(()=> disableIframeInteraction(host));
                  state.mo.observe(host, { childList:true, subtree:true });

                  resolve(state.player);
                },
                onStateChange: function(evt){ /* ok */ },
                onError: function(err){ console.error('YT player error', err); }
              }
            });
          });
        }).catch(err => { console.error('create player error', err); throw err; });
      }

      function destroyPlayer(){
        try{
          if(state.updateTimer){ clearInterval(state.updateTimer); state.updateTimer = null; }
          if(state.player){ try{ state.player.destroy(); }catch(e){} state.player = null; }
          if(state.keyHandler){ document.removeEventListener('keydown', state.keyHandler); state.keyHandler = null; }
          if(state.mo){ try{ state.mo.disconnect(); }catch(e){} state.mo = null; }
          if(state.overlayEl){ try{ state.overlayEl.remove(); }catch(e){} state.overlayEl = null; }
          if(state.rafId){ cancelAnimationFrame(state.rafId); state.rafId = null; }
          // reset mount if present
          if(state.mount) try{ state.mount.style.height = '520px'; }catch(e){}
        }catch(e){ console.warn('destroyPlayer err', e); }
      }

      // Public API
      window.showViduPlayer = function(videoId, title){
        const wrap = document.getElementById('player-wrap');
        if(!wrap){
          console.warn('showViduPlayer: #player-wrap not found. Ensure your modal contains <div id="player-wrap"></div>');
          return Promise.reject(new Error('#player-wrap not found'));
        }
        return createPlayerIn(wrap, videoId);
      };
      window.destroyViduPlayer = function(){
        const wrap = document.getElementById('player-wrap');
        if(wrap) wrap.innerHTML = '';
        destroyPlayer();
      };

      // cleanup on navigation
      window.addEventListener('beforeunload', ()=> { try{ window.destroyViduPlayer(); }catch(e){} }, {passive:true});

      // react to fullscreenchange and ensure mount gets full height when our host is fullscreen
      document.addEventListener('fullscreenchange', function(){
        const fs = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
        if(fs && fs.classList && fs.classList.contains('vidu-player-container-host')){
          // host entered fullscreen; expand mount
          try{ if(state.mount) state.mount.style.height = window.innerHeight + 'px'; }catch(e){}
        } else {
          try{ if(state.mount) state.mount.style.height = '520px'; }catch(e){}
        }
      }, {passive:true});

    })();
  } // end guard
  </script>

  <script>
  /*************************************************************************
   * Playlist/Modal/Password & UI — preserved (no layout changes)
   * Use showViduPlayer(videoId) to mount player
   *************************************************************************/

  const playlists = [
    {
      id: 0,
      name: 'SUBJECTS',
      thumbnail: 'https://i.pinimg.com/736x/71/82/6e/71826ec9ece9f33d9034bb0acd3b8d1f.jpg',
      videos: [
        {
          id: 1,
          name: 'ET',
          thumbnail: 'https://i.pinimg.com/736x/19/b2/42/19b2424009813fc558e8a785c794cbdf.jpg',
          videos: [
            { name:'', thumbnail:'https://i.pinimg.com/736x/19/b2/42/19b2424009813fc558e8a785c794cbdf.jpg', type:'playlist', idB64: btoa("PL9zX0VbNmKiHFvj6Q-p04TgdZj_tv0eI3&si=pAyX-6SJILH6QSg2"), passB64: btoa("vidu123et") },
            { name:'', thumbnail:'https://i.pinimg.com/736x/ea/60/d8/ea60d83595332fe2a7d11f1844072251.jpg', type:'playlist', idB64: btoa("PL9zX0VbNmKiFcYCAzfcyI0cz8cOfyWlTc&si=nZ224kprFgDGTG9Z"), passB64: btoa("vidu123et") }
          ]
        },
        {
          id: 2,
          name: 'SFT',
          thumbnail: 'https://i.pinimg.com/736x/b8/de/57/b8de57f639bb30fd9f48cda542dd96d2.jpg',
          videos: [
            { name:'', thumbnail:'https://i.pinimg.com/736x/2d/9d/1a/2d9d1a4affd566269879267ca70b74b8.jpg', type:'playlist', idB64: btoa("PL9zX0VbNmKiG94fMjA7v-6nw55htWj6LH&si=PUXqK2wlIin_tUZm"), passB64: btoa("vidu123sft") },
            { name:'', thumbnail:'https://i.pinimg.com/736x/42/9d/84/429d847241cfba744292224956707f45.jpg', type:'playlist', idB64: btoa("PL9zX0VbNmKiEmn6j0O870XYlFRasYABD2&si=vjOY0tK0Em5LZvsf"), passB64: btoa("vidu123sft") }
          ]
        },
        {
          id: 3,
          name: 'ICT',
          thumbnail: 'https://i.pinimg.com/736x/81/f4/0d/81f40de2906f0c61f2f17d6db61d7271.jpg',
          videos: [
            { name:'', thumbnail:'https://i.pinimg.com/736x/81/f4/0d/81f40de2906f0c61f2f17d6db61d7271.jpg', type:'playlist', idB64: btoa("PL9zX0VbNmKiFUhYSDfiEVVMuBbc2AiwpC&si=1g80otmZOXdp1hE_"), passB64: btoa("vidu123ict") }
          ]
        }
      ]
    }
  ];

  function b64decode(s){ try{ return atob(s); }catch(e){ return s; } }
  function escapeHtml(s){ return (s||'').replace(/[&<>"'`]/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;","`":"&#96;"}[ch])); }

  function renderPlaylists(){
    const ul = document.getElementById('playlist-list');
    if(!ul) return;
    ul.innerHTML = '';
    if(!playlists || playlists.length === 0){ ul.innerHTML = '<li class="muted">No playlists available.</li>'; return; }
    playlists.forEach(pl=>{
      const li = document.createElement('li'); li.className='list-item ripple';
      li.innerHTML = `<img src="${escapeHtml(pl.thumbnail)}" alt="${escapeHtml(pl.name)}" /><span class="title">${escapeHtml(pl.name)}</span>`;
      li.addEventListener('click', (ev)=>{ spawnRipple(ev, li); showPlaylistVideos(pl); });
      attachTilt(li);
      ul.appendChild(li);
    });
    ul.style.display = 'flex';
  }

  function showPlaylistVideos(pl, skipPush){
    const ul = document.getElementById('playlist-list');
    const container = document.getElementById('playlist-videos');
    if(!container || !ul) return;
    if(!window.__viduGlobal.playlistStack) window.__viduGlobal.playlistStack = [];
    if(!skipPush){ window.__viduGlobal.playlistStack.push(window.__viduGlobal.currentPl || null); }
    window.__viduGlobal.currentPl = pl;
    ul.style.display = 'none';
    container.style.display = 'block';
    container.innerHTML = `<h3 style="text-align:center;color:#fff;">${escapeHtml(pl.name)}</h3>`;
    const vids = document.createElement('ul'); vids.className='list-container';
    (pl.videos||[]).forEach(v=>{
      const vli = document.createElement('li'); vli.className='list-item ripple';
      const thumb = v.thumbnail || '';
      vli.innerHTML = `<img src="${escapeHtml(thumb)}" alt="${escapeHtml(v.name)}" /><span class="title">${escapeHtml(v.name)}</span>`;
      if(v && Array.isArray(v.videos)){ vli.addEventListener('click',(ev)=>{ spawnRipple(ev, vli); showPlaylistVideos(v); }); }
      else { vli.addEventListener('click',(ev)=>{ spawnRipple(ev, vli); openPasswordModal(v); }); }
      attachTilt(vli); vids.appendChild(vli);
    });
    const back = document.createElement('div'); back.style.textAlign='center'; back.style.marginTop='16px';
    back.innerHTML = `<button id="back-to-playlists" class="btn secondary">Back</button>`;
    container.appendChild(vids); container.appendChild(back);
    document.getElementById('back-to-playlists').onclick = ()=>{
      const prev = (window.__viduGlobal.playlistStack && window.__viduGlobal.playlistStack.length) ? window.__viduGlobal.playlistStack.pop() : null;
      if(prev === null){ ul.style.display='flex'; container.style.display='none'; window.__viduGlobal.currentPl = null; }
      else { showPlaylistVideos(prev, true); }
    };
  }

  function spawnRipple(ev,target){ const rect = target.getBoundingClientRect(); const drop = document.createElement('div'); drop.className = 'drop'; drop.style.left = (ev.clientX - rect.left) + 'px'; drop.style.top = (ev.clientY - rect.top) + 'px'; target.appendChild(drop); setTimeout(()=> drop.remove(),700); }
  function attachTilt(card){ if(!card) return; const img = card.querySelector('img'); function onMove(e){ if(window.__viduGlobal && window.__viduGlobal.visualsPaused) return; const r = card.getBoundingClientRect(); const px = (e.clientX - r.left) / r.width; const py = (e.clientY - r.top) / r.height; const rx = (py - 0.5) * 10; const ry = (px - 0.5) * -10; card.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(6px)`; if(img) img.style.transform = `translateZ(26px) scale(1.06) translateY(${(0.5-py)*6}px)`; } function onLeave(){ card.style.transform = ''; if(img) img.style.transform = ''; } card.addEventListener('pointermove', onMove, {passive:true}); card.addEventListener('pointerleave', onLeave, {passive:true}); }

  // Modal + player mount
  let currentItem = null;
  function createModal(){
    const root = document.getElementById('modal-root');
    root.innerHTML = `
      <div class="modal-backdrop" id="modal-backdrop">
        <div class="modal" role="dialog" aria-modal="true">
          <div class="controls">
            <div>
              <strong id="modal-title">Locked</strong>
              <div class="muted" id="modal-subtitle" style="color:#bbb;font-size:12px;"></div>
            </div>
            <div>
              <button id="modal-close" class="btn secondary">Close</button>
            </div>
          </div>

          <div id="modal-body">
            <div id="password-block">
              <div style="color:#bbb;margin-bottom:8px;">This item is password-protected. Enter password to unlock and play.</div>
              <div class="password-row">
                <input id="password-input" type="password" placeholder="Enter password" />
                <button id="password-submit" class="btn">Unlock</button>
              </div>
              <div id="password-error" style="margin-top:8px;color:#f66;display:none;"></div>
            </div>

            <div id="player-block" style="display:none;margin-top:12px;">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                <div style="color:#bbb" id="now-playing-label">Now playing</div>
                <div>
                  <button id="close-player" class="btn">Close</button>
                </div>
              </div>

              <!-- mount point - DO NOT rename -->
              <div id="player-wrap"></div>

              <div id="playlist-list-wrap" style="display:none;margin-top:12px;">
                <div class="muted">Playlist contents</div>
                <div class="playlist-list" id="playlist-video-list"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
    document.getElementById('modal-close').onclick = closeModal;
    document.getElementById('close-player').onclick = closeModal;
    document.getElementById('password-submit').onclick = onPasswordSubmit;
    document.getElementById('password-input').onkeydown = (e)=>{ if(e.key === 'Enter') onPasswordSubmit(); };
    document.getElementById('modal-backdrop').onclick = function(e){ if(e.target === this) closeModal(); };
  }

  function openPasswordModal(item){
    currentItem = item;
    const root = document.getElementById('modal-root');
    root.style.display = 'block';
    document.getElementById('modal-title').textContent = item.name || 'Protected';
    document.getElementById('modal-subtitle').textContent = (item.type || 'video') + ' — password required';
    document.getElementById('password-input').value = '';
    document.getElementById('password-error').style.display = 'none';
    document.getElementById('password-block').style.display = 'block';
    document.getElementById('player-block').style.display = 'none';
    const plwrap = document.getElementById('playlist-list-wrap'); if(plwrap) plwrap.style.display = 'none';
    setTimeout(()=>document.getElementById('password-input').focus(), 50);
    if(!window.__viduGlobal) window.__viduGlobal = {};
    window.__viduGlobal.visualsPaused = true;
    window.dispatchEvent(new CustomEvent('vidu:visuals:pause', { detail:{ reason:'modal-open' } }));
  }

  function closeModal(){
    const root = document.getElementById('modal-root'); if(root) root.style.display = 'none';
    const wrap = document.getElementById('player-wrap'); if(wrap) wrap.innerHTML = '';
    const plwrap = document.getElementById('playlist-video-list'); if(plwrap) plwrap.innerHTML = '';
    currentItem = null;
    if(window.destroyViduPlayer) try{ window.destroyViduPlayer(); }catch(e){}
    window.__viduGlobal.visualsPaused = false;
    window.dispatchEvent(new CustomEvent('vidu:visuals:resume', { detail:{ reason:'modal-closed' } }));
  }

  function onPasswordSubmit(){
    const val = (document.getElementById('password-input').value || '').trim();
    if(!currentItem) return;
    const expected = b64decode(currentItem.passB64 || '');
    if(val === expected){
      document.getElementById('password-block').style.display = 'none';
      document.getElementById('password-error').style.display = 'none';
      document.getElementById('player-block').style.display = 'block';
      if(currentItem.type === 'playlist'){
        showPlaylistInsideModal(currentItem);
      } else {
        const id = b64decode(currentItem.idB64 || '');
        document.getElementById('now-playing-label').textContent = currentItem.name || 'Now playing';
        if(window.showViduPlayer) window.showViduPlayer(id, currentItem.name || '').catch(err => {
          console.error('showViduPlayer failed', err);
          const wrap = document.getElementById('player-wrap'); if(wrap) wrap.innerHTML = `<div class="muted">Failed to load player.</div>`;
        });
      }
    } else {
      const err = document.getElementById('password-error'); err.style.display = 'block'; err.textContent = 'Incorrect password — try again.';
    }
  }

  // Playlist fetching (kept)
  async function fetchPlaylistVideos(playlistId){
    if(!YT_API_KEY || YT_API_KEY === 'YOUR_API_KEY_HERE') throw new Error('No API key configured.');
    const items=[]; let pageToken='';
    do{
      const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${encodeURIComponent(playlistId)}&key=${encodeURIComponent(YT_API_KEY)}` + (pageToken?`&pageToken=${pageToken}`:'');
      const res = await fetch(url);
      if(!res.ok){ const txt = await res.text().catch(()=>null); throw new Error('YouTube API error: '+res.status+' '+res.statusText+' '+(txt||'')); }
      const data = await res.json();
      (data.items||[]).forEach(it=>{
        const sn = it.snippet || {};
        if(sn.resourceId && sn.resourceId.videoId){
          const thumb = (sn.thumbnails && (sn.thumbnails.high||sn.thumbnails.medium||sn.thumbnails.default))||{};
          items.push({ videoId: sn.resourceId.videoId, title: sn.title||'Untitled', thumb: thumb.url||`https://img.youtube.com/vi/${sn.resourceId.videoId}/hqdefault.jpg` });
        }
      });
      pageToken = data.nextPageToken || '';
    } while(pageToken);
    return items;
  }

  async function showPlaylistInsideModal(item){
    const rawId = b64decode(item.idB64);
    const playlistId = rawId.split('&')[0];
    window.__viduGlobal.visualsPaused = true;
    window.dispatchEvent(new CustomEvent('vidu:visuals:pause', { detail:{ reason:'playlist-load' } }));

    try{
      const videos = await fetchPlaylistVideos(playlistId);
      if(!videos.length){
        const wrap = document.getElementById('player-wrap');
        if(wrap) wrap.innerHTML = `<div class="muted">No videos found or playlist is private.</div>`;
        document.getElementById('player-block').style.display='block';
        return;
      }

      let listWrap = document.getElementById('playlist-video-list');
      if(!listWrap){
        const wrapper = document.createElement('div');
        wrapper.id = 'playlist-list-wrap';
        wrapper.style.marginTop = '12px';
        wrapper.innerHTML = `<div class="muted">Playlist contents</div><div class="playlist-list" id="playlist-video-list"></div>`;
        const playerBlock = document.getElementById('player-block');
        if(playerBlock) playerBlock.appendChild(wrapper);
        listWrap = document.getElementById('playlist-video-list');
      }

      if(listWrap) listWrap.innerHTML = '';
      videos.forEach(v=>{
        const li = document.createElement('div'); li.className = 'list-item';
        li.setAttribute('data-video-id', v.videoId);
        li.style.display='flex'; li.style.alignItems='center'; li.style.gap='12px'; li.style.padding='8px';
        li.innerHTML = `<img src="${escapeHtml(v.thumb)}" alt="${escapeHtml(v.title)}" style="width:120px;height:68px;object-fit:cover;border-radius:6px;" /><div style="flex:1;"><div class="title" style="font-size:13px;">${escapeHtml(v.title)}</div></div>`;
        li.onclick = ()=> {
          document.getElementById('now-playing-label').textContent = v.title || 'Now playing';
          if(window.showViduPlayer) window.showViduPlayer(v.videoId, v.title || '').catch(err => {
            console.error('showViduPlayer failed', err);
            const wrap = document.getElementById('player-wrap'); if(wrap) wrap.innerHTML = `<div class="muted">Failed to load player.</div>`;
          });
        };
        listWrap.appendChild(li);
      });

      document.getElementById('player-block').style.display='block';
      const outer = document.getElementById('playlist-list-wrap'); if(outer) outer.style.display='block';
      document.getElementById('now-playing-label').textContent = videos[0].title || 'Now playing';
      if(window.showViduPlayer) window.showViduPlayer(videos[0].videoId, videos[0].title || '').catch(err => {
        console.error('showViduPlayer failed', err);
        const wrap = document.getElementById('player-wrap'); if(wrap) wrap.innerHTML = `<div class="muted">Failed to load player.</div>`;
      });
    } catch(err){
      console.error('Playlist fetch error', err);
      const wrap = document.getElementById('player-wrap');
      if(wrap) wrap.innerHTML = `<div class="muted">Failed to load playlist: ${escapeHtml(err.message || '')}</div>`;
      document.getElementById('player-block').style.display='block';
    }
  }

  // Visual helpers
  function pauseVisuals(reason){ if(!window.__viduGlobal) window.__viduGlobal = {}; window.__viduGlobal.visualsPaused = true; window.dispatchEvent(new CustomEvent('vidu:visuals:pause',{detail:{reason}})); }
  function resumeVisuals(reason){ if(!window.__viduGlobal) window.__viduGlobal = {}; window.__viduGlobal.visualsPaused = false; window.dispatchEvent(new CustomEvent('vidu:visuals:resume',{detail:{reason}})); }

  document.addEventListener('DOMContentLoaded', function(){
    createModal();
    renderPlaylists();
    const navHome = document.getElementById('nav-home');
    if(navHome) navHome.addEventListener('click', ()=>{ document.getElementById('playlist-list').style.display='flex'; document.getElementById('playlist-videos').style.display='none'; });
    document.querySelectorAll('.list-item').forEach(el=>attachTilt(el));
    (function stagger(){ const cards=document.querySelectorAll('.list-item'); cards.forEach((c,i)=> c.style.animationDelay=(i*60)+'ms'); })();
  });

  // deterrents
  document.addEventListener('contextmenu', function(e){ e.preventDefault(); }, false);
  document.addEventListener('keydown', function(e){ if ((e.ctrlKey && e.shiftKey && (e.key==='I'||e.key==='i'||e.key==='J'||e.key==='j')) || (e.ctrlKey && (e.key==='U'||e.key==='u')) || (e.key==='F12')) { e.preventDefault(); return false; } });
  document.addEventListener('keydown', function(e){ if (e.key === 'Escape') { const root=document.getElementById('modal-root'); if(root) root.style.display='none'; resumeVisuals('esc'); } });

  (function modalWatcher(){ const root=document.getElementById('modal-root'); if(!root) return; const obs = new MutationObserver(()=>{ const isVisible = (root.style.display !== 'none' && root.style.display !== ''); if(!isVisible){ setTimeout(()=> { if(!document.querySelector('.modal-backdrop') || document.querySelectorAll('.modal-backdrop').length === 0) resumeVisuals('modalWatcher'); }, 60); } }); obs.observe(root, { attributes: true, attributeFilter: ['style', 'class'] }); window.addEventListener('beforeunload', ()=> obs.disconnect(), {passive:true}); })();
  </script>

  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/browser.min.js"></script>
  <script src="assets/js/breakpoints.min.js"></script>
  <script src="assets/js/util.js"></script>
  <script src="assets/js/main.js"></script>
</body>
</html>
