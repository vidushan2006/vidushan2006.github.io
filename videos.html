<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Private Archive — VIDU</title>

  <link href="https://api.fontshare.com/v2/css?f[]=clash-display@700&f[]=satoshi@700,500&display=swap" rel="stylesheet">

  <style>
    /* ===== Modern Style Overhaul ===== */

    /* ---- 1. Root Variables & Base Setup ---- */
    :root {
      --bg-color: #0c0a10;
      --text-primary: #e6e6fa;
      --text-secondary: rgba(230, 230, 250, 0.6);
      --accent-primary: #00ff8a;
      --accent-secondary: #9e5fff;
      --card-bg: rgba(20, 18, 28, 0.5);
      --border-color: rgba(255, 255, 255, 0.07);
      --font-heading: 'Clash Display', sans-serif;
      --font-body: 'Satoshi', sans-serif;
    }

    *{box-sizing:border-box}

    html,body{height:100%;margin:0;font-family: var(--font-body); -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}

    body{
      /* ===== MODIFIED: Reintegrated background image with a modern overlay ===== */
      background-color: var(--bg-color);
      background-image: linear-gradient(rgba(12, 10, 16, 0.85), rgba(12, 10, 16, 0.95)), url('assets/images/background.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      color: var(--text-primary);
      line-height:1.5;
      overflow-x: hidden;
    }

    /* ---- 2. Dynamic Aurora Background (layered on top) ---- */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background:
        radial-gradient(circle at 15% 25%, rgba(0, 255, 138, 0.15), transparent 30%),
        radial-gradient(circle at 85% 75%, rgba(158, 95, 255, 0.15), transparent 30%);
      z-index: -1;
      animation: background-pan 30s linear infinite;
    }
    @keyframes background-pan {
      0% { transform: translate(0%, 0%) rotate(0deg); }
      25% { transform: translate(5%, -10%) rotate(10deg); }
      50% { transform: translate(0%, 0%) rotate(0deg); }
      75% { transform: translate(-5%, 10%) rotate(-10deg); }
      100% { transform: translate(0%, 0%) rotate(0deg); }
    }
    
    /* ---- 3. Custom Scrollbar ---- */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
    ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.15); }

    /* ---- 4. Redesigned Top Bar ---- */
    .topbar{
      position:fixed;
      left:0;right:0;top:0;
      z-index:120;
      background:rgba(12, 10, 16, 0.5);
      backdrop-filter:blur(12px);
      border-bottom:1px solid var(--border-color);
    }
    .topbar-inner{max-width:1400px;margin:0 auto;padding:16px 24px;display:flex;justify-content:space-between;align-items:center;}
    
    .left{display:flex;align-items:center;gap:24px}
    .logo-btn{display:inline-flex;align-items:center;justify-content:center;text-decoration:none; transition: transform 0.2s ease;}
    .logo-btn:hover { transform: scale(1.05) rotate(-5deg); }

    .nav{display:flex;gap:8px;align-items:center}
    .nav a,.nav button{
      color:var(--text-secondary);
      text-decoration:none;padding:8px 14px;
      font-weight:700;border-radius:8px;font-size:15px;
      background:transparent;border:0;cursor:pointer;
      transition: all .2s ease;
    }
    .nav a:hover,.nav button:hover{ color: var(--text-primary); background: var(--border-color); transform: translateY(-2px); }

    /* ---- 5. Page Layout & Hero Section ---- */
    .page{margin-top:80px;min-height:calc(100vh - 80px)}
    .container{max-width:1400px;margin:0 auto;padding:48px 24px}
    .hero { text-align: center; margin-bottom: 64px; }
    .title{
      font-family: var(--font-heading);
      font-size:clamp(3rem, 10vw, 6rem); /* Responsive font size */
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0;
      letter-spacing: -2px;
    }
    .subtitle{color: var(--text-secondary); font-size:18px; margin-top: 16px; max-width: 600px; margin-left: auto; margin-right: auto;}

    /* ---- 6. Modern Card Grid & Design ---- */
    .tiles{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));
      gap:32px;
    }
    
    .card{
      position: relative;
      display:flex;flex-direction:column;
      background:var(--card-bg);
      border-radius:16px;
      border:1px solid var(--border-color);
      cursor:pointer;
      transition:transform .2s ease, box-shadow .2s ease;
      min-height:350px;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      left: 0; top: 0;
      width: 100%; height: 100%;
      border-radius: 16px;
      background: radial-gradient(
        400px circle at var(--mouse-x) var(--mouse-y),
        rgba(0, 255, 138, 0.2),
        transparent 40%
      );
      z-index: 0;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .card:hover::before { opacity: 1; }
    .card:hover{transform:translateY(-8px); border-color: rgba(255, 255, 255, 0.15);}
    
    .card-media{position:relative;height:250px;display:flex;align-items:center;justify-content:center; border-bottom:1px solid var(--border-color); overflow:hidden;}
    .neon-wrap{ text-align:center; position: relative; z-index: 1; pointer-events: none;}
    .neon{
      font-family: var(--font-heading);
      letter-spacing: 2px;
      color: var(--accent-primary);
      text-shadow:0 0 8px var(--accent-primary), 0 0 24px rgba(0, 255, 138, 0.4);
      line-height:1;
      user-select:none;
      white-space:nowrap;
      font-size: 56px !important;
    }
    .neon-reflect{
      position:relative;
      transform:scaleY(-1);
      opacity:0.1;
      filter:blur(5px);
      font-family: var(--font-heading);
      letter-spacing: 2px;
      color: var(--accent-primary);
      pointer-events:none;
      white-space:nowrap;
      font-size: 56px !important;
      margin-top:12px;
    }
    .card-caption{padding:20px;display:flex;flex-direction:column;gap:10px; position: relative; z-index: 1;}
    .card-title{font-weight:700;color:var(--text-primary);font-size:18px;}
    .card-type{
      font-size:12px;
      color: var(--accent-primary);
      background: rgba(0, 255, 138, 0.1);
      border: 1px solid rgba(0, 255, 138, 0.2);
      font-weight:700;
      text-transform:uppercase;
      padding: 4px 10px;
      border-radius: 99px;
      align-self: flex-start;
    }

    /* ---- 7. Restyled Modals & Buttons ---- */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);z-index:300;padding:18px}
    .modal.hidden{display:none}
    .modal-box{
      max-width:460px;
      width:100%;
      background:rgba(18, 16, 24, 0.6);
      backdrop-filter: blur(16px);
      border-radius:16px;
      padding:32px;
      border: 1px solid var(--border-color);
      box-shadow:0 20px 60px rgba(0,0,0,0.5);
      color:var(--text-primary);
      text-align:center;position:relative
    }
    .modal-close{position:absolute;right:16px;top:16px;background:transparent;border:none;color:var(--text-secondary);font-size:18px;cursor:pointer; transition: color 0.2s ease;}
    .modal-close:hover { color: var(--text-primary); }

    .login-input{
      width:100%;padding:14px 16px;border-radius:8px;
      border:1px solid var(--border-color);
      background:rgba(0,0,0,0.2);
      color:var(--text-primary);margin-top:12px;font-size:16px;
      transition: all 0.2s ease;
    }
    .login-input:focus { border-color: var(--accent-primary); box-shadow: 0 0 8px rgba(0, 255, 138, 0.3); outline: none; }
    
    .pw-actions, .login-actions{display:flex;gap:12px;margin-top:24px;justify-content:center}
    
    .btn{
      padding:12px 24px;border-radius:8px;border:none;font-weight:700;
      cursor:pointer;
      /* ===== MODIFIED: Darker green gradient for better text contrast ===== */
      background: linear-gradient(90deg, #00c86f, #00a955);
      color:#0c0a10;font-size:16px;
      transition: all 0.2s ease;
      box-shadow: 0 4px 15px rgba(0, 212, 116, 0.2);
    }
    .btn:hover{transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 25px rgba(0, 212, 116, 0.3);}
    .btn:disabled { background: var(--border-color); color: var(--text-secondary); cursor: not-allowed; transform: none; box-shadow: none; }

    .login-btn-top{
        background: linear-gradient(90deg, #00c86f, #00a955);
        color: #0c0a10;
        font-weight: 700;
        font-size: 15px;
        padding: 10px 18px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        transition: all .2s ease;
    }
    .login-btn-top:hover{ transform: translateY(-2px) scale(1.02); }
    .login-btn-top:disabled {
        background: var(--border-color);
        color: var(--text-secondary);
        cursor: not-allowed; transform: none;
    }

    .copyright{text-align:center;margin-top:64px;color:var(--text-secondary);font-size:14px}

    /* ===== Player, playlist, and utility styles below this line ===== */
    /* These styles are required for the player JavaScript to function correctly. */
    .viewer{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.78);z-index:400;padding:22px}
    .viewer.hidden{display:none}
    .viewer-inner{width:100%;max-width:1100px;height:72vh;border-radius:12px;overflow:hidden;background:rgba(2,2,2,0.75);position:relative;box-shadow:0 30px 80px rgba(0,0,0,0.8);display:flex;flex-direction:column}
    .viewer-close{position:absolute;top:10px;right:10px;background:transparent;border:none;color:#ddd;font-size:20px;cursor:pointer;z-index:5}
    .now-playing {width:100%;padding:10px 16px;box-sizing:border-box;background:linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.45));color:#e8f7e8;font-weight:900;letter-spacing:0.6px;font-size:15px;display:flex;align-items:center;gap:12px;border-bottom:1px solid rgba(255,255,255,0.03);z-index:8;}
    .now-playing .label { color:rgba(200,255,190,0.85); font-weight:800; font-size:13px; opacity:0.95; text-transform:uppercase; }
    /* ===== MODIFIED: Fixed styling for the "Now Playing" title ===== */
    .now-playing .title { color:var(--text-primary); font-family: var(--font-body); font-size:16px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; letter-spacing: normal; }
    .iframe-wrap{width:100%;height:100%;display:block;background:#000;position:relative;border-bottom:1px solid rgba(255,255,255,0.03)}
    .vidu-player-host{position:relative;width:100%;height:100%;overflow:hidden;border-radius:8px;background:#000}
    .vidu-mount{width:100%;height:100%;background:#000}
    .vidu-mount iframe{width:100%;height:100%;border:0;display:block}
    .vidu-loading{position:absolute;inset:0;z-index:9998;display:flex;align-items:center;justify-content:center;background-image: url('assets/images/header.png');background-repeat:no-repeat;background-position:center;background-size:cover;transition:opacity .28s ease;pointer-events:none}
    .vidu-loading.hidden{opacity:0;transform:scale(1.02);pointer-events:none;display:none}
    .vidu-controls-bg{position:absolute;left:0;right:0;bottom:0;height:64px;background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.75));pointer-events:none;z-index:9996;opacity:1;transition:opacity .22s ease, transform .22s ease;backdrop-filter:blur(4px)}
    .vidu-controls-bg.hidden{opacity:0;transform:translateY(6px)}
    .vidu-overlay{position:absolute;left:12px;right:12px;bottom:12px;z-index:9999;display:flex;gap:12px;align-items:center;padding:8px 12px;border-radius:10px;box-sizing:border-box;pointer-events:auto}
    .vidu-overlay.hidden{opacity:0;transform:translateY(6px);pointer-events:none}
    .vidu-overlay .inner-bg{position:absolute;inset:0;border-radius:10px;pointer-events:none;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));z-index:-1}
    .vidu-btn{background:rgba(255,255,255,0.06);color:#fff;padding:8px;border-radius:22px;cursor:pointer;font-weight:700;user-select:none;border:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;width:46px;height:46px;transition:transform .12s ease}
    .vidu-btn:active{transform:scale(.96)}
    .vidu-range{flex:1;-webkit-appearance:none;height:8px;border-radius:8px;background:rgba(255,255,255,0.06)}
    .vidu-range::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:#39ff14;box-shadow:0 2px 8px rgba(0,0,0,0.5);border:2px solid rgba(0,0,0,0.18);margin-top:-4px}
    .vidu-range::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:#39ff14;border:2px solid rgba(0,0,0,0.18)}
    .vidu-time{min-width:90px;font-size:14px;font-weight:800;color:#cbd5ff;text-align:center;letter-spacing:1px}
    .vidu-close-btn{position:absolute;top:10px;right:10px;z-index:10002;width:36px;height:36px;padding:6px;border-radius:8px;background:rgba(0,0,0,0.46);border:1px solid rgba(255,255,255,0.06);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,0.6);transition:opacity .18s ease,transform .18s ease}
    .vidu-close-btn.hidden{opacity:0;transform:translateY(-6px);pointer-events:none}
    .vidu-volume-overlay {position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; z-index: 100010;}
    .vidu-volume-card {pointer-events: none; display: flex; gap: 12px; align-items: center; justify-content: center; min-width: 140px; max-width: 320px; padding: 12px 18px; border-radius: 12px; background: linear-gradient(180deg, rgba(8,10,8,0.98), rgba(12,14,12,0.96)); box-shadow: 0 10px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06); backdrop-filter: blur(6px) saturate(120%); transform: scale(0.86); opacity: 0; transition: transform .22s cubic-bezier(.2,.9,.2,1), opacity .22s ease; color: #f4fff4; font-weight:900; letter-spacing:0.6px;}
    .vidu-volume-overlay.visible .vidu-volume-card { transform: scale(1); opacity: 1; }
    .vidu-vol-icon {width: 36px; height: 36px; display:flex; align-items:center; justify-content:center; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border-radius: 8px; border: 1px solid rgba(255,255,255,0.04); box-shadow: 0 6px 18px rgba(0,0,0,0.45); flex: 0 0 36px;}
    .vidu-vol-percent { font-size:18px; font-weight:900; color: #e8ffe8; min-width:46px; text-align:left; }
    .vidu-vol-sub { font-size:11px; color: rgba(220,255,220,0.7); font-weight:800; margin-left:6px; }
    .vidu-playback-menu {position:absolute; z-index:100005; background:linear-gradient(180deg,#111,#0b0b0b); border:1px solid rgba(255,255,255,0.06); border-radius:8px; padding:6px; box-shadow:0 12px 30px rgba(0,0,0,0.6); min-width:88px;}
    .vidu-playback-item {display:block; padding:8px 10px; color:#e6f7e6; text-align:center; font-weight:800; cursor:pointer; border-radius:6px; margin:4px 0; background:transparent; font-size:13px;}
    .vidu-playback-item:hover { background:rgba(255,255,255,0.03); }
    .vidu-playback-item.active { background:rgba(57,255,20,0.12); color:#dfffd6; }
    .playlist-popup { position: fixed; inset: 12px; z-index: 600; display: none; align-items: center; justify-content: center; pointer-events: auto; }
    .playlist-popup.visible { display:flex; }
    .playlist-popup-inner { width: 100%; height: 100%; background: linear-gradient(180deg, rgba(18, 16, 24, 0.95), rgba(12, 10, 16, 0.98)); backdrop-filter: blur(16px); border-radius: 14px; box-shadow: 0 40px 120px rgba(0,0,0,0.8); padding: 18px; box-sizing: border-box; overflow: hidden; display: flex; flex-direction: column; border: 1px solid var(--border-color); }
    .playlist-popup-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
    .playlist-popup-count { font-weight:700; color:var(--text-primary); background: var(--border-color); padding:8px 14px; border-radius: 8px; font-size: 14px; }
    .playlist-popup-title { font-size:18px; font-weight:700; color:#fff; flex:1; text-align:left; margin-left:16px; }
    .playlist-popup-close { border:0; background:transparent; color:var(--text-secondary); font-weight:800; font-size:20px; cursor:pointer; }
    .playlist-popup-body { overflow:auto; border-radius:10px; padding:8px; background: rgba(0,0,0,0.2); flex:1; }
    .playlist-item { display:flex; gap:16px; align-items:center; padding:12px; border-radius:10px; transition: background .12s, transform .08s; cursor:pointer; margin-bottom:8px; background:transparent; }
    .playlist-item:hover { background: var(--border-color); transform: translateX(4px); }
    .playlist-item-num-thumb { width: 140px; height: 78px; flex: 0 0 140px; border-radius: 8px; background: #000; display: flex; align-items: center; justify-content: center; font-size: 42px; font-weight: 900; color: var(--accent-primary); text-shadow: 0 0 6px var(--accent-primary), 0 0 18px rgba(0,255,138,0.45); user-select: none; border: 1px solid var(--border-color); }
    .playlist-item .meta { display:flex; flex-direction:column; gap:6px; }
    .playlist-item .meta .t { font-weight:700; color:#fff; font-size:15px; }
    .playlist-item .meta .s { color: var(--text-secondary); font-size:13px; }
    .playlist-loading-indicator { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; gap: 18px; user-select: none; text-align: center; }
    .playlist-loading-indicator .spinner { width: 48px; height: 48px; border: 5px solid rgba(255, 255, 255, 0.12); border-top-color: var(--accent-primary); border-radius: 50%; animation: spin 1s linear infinite; }
    .playlist-loading-indicator .loading-text { font-size: 18px; font-weight: 700; color: var(--text-secondary); }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="left">
        <a class="logo-btn" href="index.html" title="Home" aria-label="Home">
          <svg width="42" height="42" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 11.4142L12 3.41421L20 11.4142V20C20 20.2652 19.8946 20.5196 19.7071 20.7071C19.5196 20.8946 19.2652 21 19 21H5C4.73478 21 4.48043 20.8946 4.29289 20.7071C4.10536 20.5196 4 20.2652 4 20V11.4142Z" stroke="var(--accent-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 21V12H15V21" stroke="var(--accent-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
        <nav class="nav" aria-label="Main navigation">
          <a href="index.html">🏠 Home</a>
          <a href="about.html">ℹ️ About</a>
        </nav>
      </div>
      <button id="login-btn-top" class="login-btn-top">🔑 Login</button>
    </div>
  </header>

  <main class="page" role="main">
    <div class="container">
      <section class="hero">
        <h1 class="title">The Archive</h1>
        <p class="subtitle">Exclusive access to private classes and curated playlists. Log in to view your permitted content.</p>
      </section>

      <section id="tiles" class="tiles" aria-live="polite"></section>
      <div class="copyright">© VIDU. All rights reserved.</div>
    </div>
  </main>

  <div id="login-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-box" role="document">
      <button class="modal-close" id="login-close" aria-label="Close">✕</button>
      <h3 style="font-weight:700; margin-bottom:16px; font-size: 24px;">🗝️ Secure Login</h3>
      <input id="login-username" class="login-input" type="text" placeholder="Username" autocomplete="username" />
      <input id="login-password" class="login-input" type="password" placeholder="Password" autocomplete="current-password" />
      <div class="login-actions">
        <button id="login-submit" class="btn">Login</button>
      </div>
      <p id="login-error" style="color:#ff8080;margin-top:16px;min-height:18px;"></p>
    </div>
  </div>

  <div id="access-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-box" role="document">
        <button class="modal-close" id="access-close" aria-label="Close">✕</button>
        <p style="font-size: 22px; font-weight: 700; margin: 20px 0;">🔒 Login Required</p>
        <div class="pw-actions">
            <button id="access-request-btn" class="btn">Request Access</button>
        </div>
    </div>
  </div>

  <div id="no-access-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-box" role="document">
      <button class="modal-close" id="no-access-close" aria-label="Close">✕</button>
      <p style="font-size: 22px; font-weight: 700; margin: 20px 0;">🔒 Access Denied</p>
      <p style="color: var(--text-secondary); margin-top: -10px; margin-bottom: 24px;">You don't have permission for this content.</p>
      <div class="pw-actions">
          <button id="no-access-request-btn" class="btn">Request Access</button>
      </div>
    </div>
  </div>

  <div id="viewer" class="viewer hidden" aria-hidden="true"><div class="viewer-inner"><button id="viewer-close" class="viewer-close" aria-label="Close viewer">✕</button><div class="now-playing" aria-hidden="false"><div class="label">Now playing</div><div class="title" id="now-playing-title">—</div></div><div id="iframe-wrap" class="iframe-wrap"></div></div></div>
  <div id="playlist-popup" class="playlist-popup" aria-hidden="true"><div class="playlist-popup-inner" role="dialog" aria-modal="true" aria-label="Playlist"><div class="playlist-popup-header"><div class="playlist-popup-count" id="playlist-count">0 Videos</div><div class="playlist-popup-title" id="playlist-popup-title">Playlist</div><button class="playlist-popup-close" id="playlist-popup-close" aria-label="Close playlist">✕</button></div><div class="playlist-popup-body" id="playlist-popup-body" tabindex="0"></div></div></div>
  <div id="js-fail-note" style="display:none;position:fixed;right:14px;bottom:14px;background:rgba(255,80,80,0.12);color:#ffdede;border:1px solid rgba(255,80,80,0.2);padding:8px 12px;border-radius:8px;font-size:13px;z-index:9999">Some features may be unavailable — enable JavaScript.</div>

  <script>
  (function(){
    /* ---------- configuration ---------- */
    const YT_API_KEY = 'AIzaSyB8UVKOZOnUnYdqbFGOtlg6BPfR9HpD35c'; // Use your own key for production
    const YT_API_LOAD_TIMEOUT = 18000;
    const userPermissions = {
      'vidu': { password: 'vidu123', access: ['PHONK', 'TEST', 'ICT', 'ET Speed Revision', 'ET Theory'] },
      'Imal': { password: '123', access: ['ET Speed Revision', 'ET Theory'] },
      'user': { password: 'password', access: ['PHONK', 'TEST'] }
    };
    let currentUser = null;
    let globalLastVolume = 100;

    const items = [
      { type: 'video', title: 'PHONK', idB64: btoa("m0fM0rBN7cQ")},
      { type: 'video', title: 'TEST', idB64: btoa("Lexok6H2c2s")},
      { type: 'playlist', title: 'ICT', idB64: btoa("PL9zX0VbNmKiFlxda5PCTn4_hA_7iKjEaA&si=9nF_7qpAzKt4cYZd")},
      { type: 'playlist', title: 'ET Speed Revision', idB64: btoa("PL9zX0VbNmKiF-Q7bnmM1v_DrT3_Ol-Of5&si=efJHPzWR-kZcGwYw")},
      { type: 'playlist', title: 'ET Theory', idB64: btoa("PL9zX0VbNmKiFKQ388JcZsq18mlyIe7BeI&si=cn4rwat6rsqC8kH_")}
    ];

    /* ---------- utilities ---------- */
    function escapeHtml(s){ return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function neonTextFor(title){
      if(!title) return '';
      const main = (title||'').split(/[\u2013\u2014\-+]/)[0].trim();
      const words = main.split(/\s+/);
      if(words.length === 1) return words[0].toUpperCase().slice(0, 6);
      return words[0].toUpperCase();
    }
    function normalizeIdFromB64(idB64){
      try { return atob(idB64 || '').split('&')[0]; } catch(e){ console.warn('Invalid idB64', idB64, e); return ''; }
    }

    /* ---------- render tiles ---------- */
    function buildTiles(){
      const tiles = document.getElementById('tiles');
      if (!tiles) return;
      tiles.innerHTML = '';
      items.forEach((it, idx)=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('data-idx', idx);
        card.setAttribute('aria-label', it.title + ' ' + it.type);
        const neon = neonTextFor(it.title);
        card.innerHTML = `
          <div class="card-media">
            <div class="neon-wrap">
              <div class="neon">${escapeHtml(neon)}</div>
              <div class="neon-reflect" aria-hidden="true">${escapeHtml(neon)}</div>
            </div>
          </div>
          <div class="card-caption">
            <div class="card-title">${escapeHtml(it.title)}</div>
            <div class="card-type">${escapeHtml(it.type)}</div>
          </div>`;
        card.addEventListener('click', ()=> handleTileClick(it));
        card.addEventListener('mousemove', e => {
          const rect = card.getBoundingClientRect();
          card.style.setProperty('--mouse-x', `${e.clientX - rect.left}px`);
          card.style.setProperty('--mouse-y', `${e.clientY - rect.top}px`);
        });
        tiles.appendChild(card);
      });
    }

    /* ---------- modal helpers ---------- */
    function showModal(el){ if(el){el.classList.remove('hidden'); el.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';}}
    function closeModal(el){ if(el){el.classList.add('hidden'); el.setAttribute('aria-hidden','true'); document.body.style.overflow='';}}
    
    let lastOpenedPlaylistItem = null;
    const playlistCache = {};
    const playlistPopup = document.getElementById('playlist-popup');
    const playlistBody = document.getElementById('playlist-popup-body');
    const playlistCountEl = document.getElementById('playlist-count');
    const playlistTitleEl = document.getElementById('playlist-popup-title');
    const playlistCloseBtn = document.getElementById('playlist-popup-close');
    
    function renderPlaylistBody(videos) {
      playlistBody.innerHTML = '';
      playlistCountEl.textContent = `${videos.length} Videos`;
      if (!videos.length) { playlistBody.innerHTML = `<div style="padding:18px;color:#ffdede">No videos found.</div>`; return; }
      videos.forEach((v, index) => {
        const node = document.createElement('div');
        node.className = 'playlist-item';
        node.innerHTML = `<div class="playlist-item-num-thumb">${index + 1}</div><div class="meta"><div class="t">${escapeHtml(v.title)}</div><div class="s">Click to play</div></div>`;
        node.tabIndex = 0;
        const clickHandler = () => {
          closePlaylistPopup();
          openViewer({ type: 'video', title: v.title, idB64: btoa(v.videoId) });
        };
        node.addEventListener('click', clickHandler);
        node.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); clickHandler(); } });
        playlistBody.appendChild(node);
      });
      playlistBody.scrollTop = 0;
    }
    
    async function openPlaylistPopup(item) {
      playlistTitleEl.textContent = item.title || 'Playlist';
      lastOpenedPlaylistItem = item;
      const playlistId = normalizeIdFromB64(item.idB64 || '');
      showModal(playlistPopup);

      if (playlistCache[playlistId]) {
        renderPlaylistBody(playlistCache[playlistId]);
      } else {
        playlistCountEl.textContent = 'Loading...';
        playlistBody.innerHTML = `<div class="playlist-loading-indicator"><div class="spinner"></div><div class="loading-text">Loading Videos...</div></div>`;
        try {
          const videos = await fetchPlaylistVideos(playlistId);
          playlistCache[playlistId] = videos;
          if (lastOpenedPlaylistItem === item && playlistPopup.classList.contains('visible')) {
            renderPlaylistBody(videos);
          }
        } catch (err) {
          if (lastOpenedPlaylistItem === item && playlistPopup.classList.contains('visible')) {
            playlistBody.innerHTML = `<div style="padding:18px;color:#ffdede">Failed to load: ${escapeHtml(err.message)}</div>`;
            playlistCountEl.textContent = '0 Videos';
          }
        }
      }
    }
    function closePlaylistPopup(){ closeModal(playlistPopup); }
    if(playlistCloseBtn) playlistCloseBtn.addEventListener('click', closePlaylistPopup);
    if(playlistPopup) playlistPopup.addEventListener('click', (e) => { if(e.target === playlistPopup) closePlaylistPopup(); });

    function handleTileClick(item) {
      if (currentUser) {
        if (currentUser.permissions.includes(item.title)) {
          if (item?.type === 'playlist') { openPlaylistPopup(item); }
          else { lastOpenedPlaylistItem = null; openViewer(item); }
        } else { showModal(document.getElementById('no-access-modal')); }
      } else { showModal(document.getElementById('access-modal')); }
    }
    
    function openViewer(item){
      const viewer = document.getElementById('viewer');
      if(!viewer) return;
      document.getElementById('now-playing-title').textContent = item.title || 'Now playing';
      showModal(viewer);
      const iframeWrap = document.getElementById('iframe-wrap');
      iframeWrap.innerHTML = '';
      const mountRoot = document.createElement('div');
      mountRoot.id = 'player-wrap';
      mountRoot.style.cssText='width:100%;height:100%';
      iframeWrap.appendChild(mountRoot);
      if (window.showViduPlayer) {
          window.showViduPlayer(normalizeIdFromB64(item.idB64), 'player-wrap').catch(err=>{
          mountRoot.innerHTML = `<div style="padding:18px;color:#ffdede;">${escapeHtml(err?.message)}</div>`;
        });
      }
    }
    
    document.getElementById('viewer-close').addEventListener('click', ()=>{
      closeModal(document.getElementById('viewer'));
      if(window.destroyViduPlayer) window.destroyViduPlayer();
      const wrap = document.getElementById('iframe-wrap'); if(wrap) wrap.innerHTML = '';
      if(lastOpenedPlaylistItem){ setTimeout(()=> openPlaylistPopup(lastOpenedPlaylistItem), 120); }
    });
    
    async function fetchPlaylistVideos(playlistId){
      if(!YT_API_KEY) throw new Error('No API key configured.');
      let results = [], pageToken = '';
      do {
        const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${encodeURIComponent(playlistId)}&key=${encodeURIComponent(YT_API_KEY)}` + (pageToken?`&pageToken=${pageToken}`:'');
        const res = await fetch(url);
        if(!res.ok) throw new Error('YouTube API error: '+res.status);
        const data = await res.json();
        (data.items||[]).forEach(it => {
          if(it.snippet?.resourceId?.videoId){
            results.push({ videoId: it.snippet.resourceId.videoId, title: it.snippet.title||'Untitled' });
          }
        });
        pageToken = data.nextPageToken || '';
      } while(pageToken);
      return results;
    }
    
    /* ===== RESTORED: Full player module for all features ===== */
    (function playerModule(){
      if(window.__viduPlayerLoaded) return;
      window.__viduPlayerLoaded = true;

      const state = { player: null, updateInterval: null, keyHandler: null, mo: null, host: null, mount: null, fsListener: null, fsResizeHandler: null, inactivityTimer: null, lastActivity: Date.now(), desiredPlaying: null, lastVolume: 100, volumeHideTimer: null };

      function pad2(n){ n = Math.max(0, Math.floor(n||0)); return (n < 10 ? '0' + n : String(n)); }
      function fmtTime(s){ s = Math.max(0, Math.floor(s||0)); const h = Math.floor(s/3600); const m = Math.floor((s%3600)/60); const sec = s%60; return pad2(h) + ' : ' + pad2(m) + ' : ' + pad2(sec); }
      function playSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 4.5v15l12-7.5L6 4.5z" fill="#fff"/></svg>`; }
      function pauseSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="5" y="4" width="4" height="16" rx="1.2" fill="#fff"/><rect x="15" y="4" width="4" height="16" rx="1.2" fill="#fff"/></svg>`; }
      function gearSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zm7.4-3.5c0-.4-.03-.78-.09-1.15l1.86-1.44a.5.5 0 0 0 .12-.65l-1.76-3.05a.5.5 0 0 0-.6-.22l-2.2.88a7.72 7.72 0 0 0-1.9-1.1l-.33-2.33A.5.5 0 0 0 13.9 2h-3.8a.5.5 0 0 0-.5.42l-.33 2.33c-.69.25-1.35.6-1.95 1.02l-2.2-.88a.5.5 0 0 0-.6.22L2.7 6.96a.5.5 0 0 0 .12.65l1.86 1.44c-.06.37-.09.75-.09 1.15s.03.78.09 1.15L2.82 14.95a.5.5 0 0 0-.12.65l1.76 3.05c.14.24.4.34.64.28l2.2-.88c.6.42 1.26.77 1.95 1.02l.33 2.33c.03.25.25.42.5.42h3.8c.25 0 .47-.17.5-.42l.33-2.33c.69-.25 1.35-.6 1.95-1.02l2.2.88c.24.09.5-.04.64-.28l1.76-3.05a.5.5 0 0 0-.12-.65l-1.86-1.44c.06-.37.09-.75.09-1.15z" fill="#fff"/></svg>`; }
      function enterFullscreenSVG() { return `<svg viewBox="0 0 24 24" width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 3h6v6m-2-4L11 13m-2 8H3v-6m2 4l8-8" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`; }
      function exitFullscreenSVG() { return `<svg viewBox="0 0 24 24" width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 9V3h6m4 2L5 13m16-2v6h-6m-2-4l8 8" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`; }
      
      async function createYTPlayer(videoId, mountRootId){
          await (window.YT?.Player ? Promise.resolve() : new Promise((resolve, reject) => {
              const s = document.createElement('script'); s.src = 'https://www.youtube.com/iframe_api'; s.async = true;
              s.onload = () => { window.onYouTubeIframeAPIReady = resolve; }; s.onerror = reject; document.head.appendChild(s);
              setTimeout(() => reject(new Error('YT API timed out')), YT_API_LOAD_TIMEOUT);
          }));
          const wrap = document.getElementById(mountRootId);
          if(!wrap) throw new Error('#' + mountRootId + ' not found');
          wrap.innerHTML = '';
          state.host = document.createElement('div'); state.host.className = 'vidu-player-host';
          state.mount = document.createElement('div'); state.mount.className = 'vidu-mount'; state.mount.id = 'vidu_mount_'+Date.now();
          state.host.innerHTML = `<div class="vidu-loading" id="vidu_loading"></div><div class="vidu-controls-bg"></div><div class="vidu-overlay"><div class="inner-bg"></div><button class="vidu-btn" id="vidu_playbtn">${playSVG()}</button><div class="vidu-time" id="vidu_cur">${fmtTime(0)}</div><input id="vidu_seek" class="vidu-range" type="range" min="0" max="100" value="0"/><div class="vidu-time" id="vidu_dur">${fmtTime(0)}</div><button class="vidu-btn" id="vidu_playbackbtn" title="Playback speed">${gearSVG()}</button><button class="vidu-btn" id="vidu_fullbtn" title="Fullscreen">${enterFullscreenSVG()}</button></div><button class="vidu-close-btn" id="vidu_closebtn">✕</button><div class="vidu-volume-overlay" aria-hidden="true"><div class="vidu-volume-card"><div class="vidu-vol-icon" id="vidu_vol_icon"></div><div style="display:flex;flex-direction:column;align-items:flex-start;"><div class="vidu-vol-percent" id="vidu_vol_pct">100%</div><div class="vidu-vol-sub" id="vidu_vol_sub">Volume</div></div></div></div>`;
          state.host.insertBefore(state.mount, state.host.firstChild); wrap.appendChild(state.host);
          
          const get = (id) => state.host.querySelector('#' + id);
          const playBtn=get('vidu_playbtn'), seekEl=get('vidu_seek'), fullBtn=get('vidu_fullbtn'), closeBtn=get('vidu_closebtn'), playbackBtn=get('vidu_playbackbtn'), volWrap=state.host.querySelector('.vidu-volume-overlay');

          const toggleFullscreen = () => {
              const fsEl = document.fullscreenElement || document.webkitFullscreenElement;
              if (fsEl) { document.exitFullscreen ? document.exitFullscreen() : document.webkitExitFullscreen(); }
              else { state.host.requestFullscreen ? state.host.requestFullscreen() : state.host.webkitRequestFullscreen(); }
          };
          fullBtn.addEventListener('click', toggleFullscreen); closeBtn.addEventListener('click', () => document.getElementById('viewer-close').click());
          
          const setOverlayHidden = (hidden) => { ['vidu-overlay', 'vidu-controls-bg', 'vidu-close-btn'].forEach(c => state.host.querySelector('.'+c)?.classList.toggle('hidden', hidden)); };
          const resetInactivityTimer = () => {
              state.lastActivity = Date.now(); setOverlayHidden(false);
              clearTimeout(state.inactivityTimer);
              state.inactivityTimer = setTimeout(() => { if (state.player?.getPlayerState() === 1) setOverlayHidden(true); }, 3000);
          };
          ['mousemove', 'touchstart', 'keydown'].forEach(ev => state.host.addEventListener(ev, resetInactivityTimer, { passive: true }));
          
          const showVolumeOverlay = (volume) => {
              const pct = Math.round(volume); get('vidu_vol_pct').textContent = `${pct}%`;
              get('vidu_vol_icon').innerHTML = pct === 0 ? `<svg viewBox="0 0 24 24" width="20" height="20" fill="none"><path d="M11 6L6 10H3v4h3l5 4V6z" fill="#fff"/><line x1="21" y1="3" x2="3" y2="21" stroke="#ff7f7f" stroke-width="1.6"/></svg>` : `<svg viewBox="0 0 24 24" width="20" height="20" fill="none"><path d="M11 6L6 10H3v4h3l5 4V6z" fill="#fff"/><path d="M16.5 7.5c.9.9 1.5 2.1 1.5 3.5s-.6 2.6-1.5 3.5" stroke="#bfffbf" stroke-width="1.6"/></svg>`;
              volWrap.classList.add('visible'); clearTimeout(state.volumeHideTimer);
              state.volumeHideTimer = setTimeout(() => volWrap.classList.remove('visible'), 3000);
          };
          
          state.keyHandler = (e) => {
              const active = document.activeElement;
              if (active && (active.tagName === 'INPUT' || active.isContentEditable)) return;
              if (e.key === ' ' || e.code === 'Space') { e.preventDefault(); state.player?.getPlayerState() === 1 ? state.player.pauseVideo() : state.player.playVideo(); }
              else if (e.key === 'f') { e.preventDefault(); toggleFullscreen(); }
              else if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                  e.preventDefault(); const current = state.player.getVolume(); const target = Math.max(0, Math.min(100, current + (e.key === 'ArrowUp' ? 5 : -5)));
                  state.player.setVolume(target); showVolumeOverlay(target); globalLastVolume = target;
              }
              else if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                  e.preventDefault(); const current = state.player.getCurrentTime(); const target = current + (e.key === 'ArrowRight' ? 10 : -10);
                  state.player.seekTo(target, true);
              }
          };
          document.addEventListener('keydown', state.keyHandler);

          let menuOpen = false;
          const closePlaybackMenu = () => { state.host.querySelector('.vidu-playback-menu')?.remove(); menuOpen = false; };
          playbackBtn.addEventListener('click', (e) => {
              e.stopPropagation(); if (menuOpen) { closePlaybackMenu(); return; }
              const menu = document.createElement('div'); menu.className = 'vidu-playback-menu';
              const rates = state.player.getAvailablePlaybackRates(); const currentRate = state.player.getPlaybackRate();
              rates.forEach(r => {
                  const item = document.createElement('button'); item.className = `vidu-playback-item ${r === currentRate ? 'active' : ''}`; item.textContent = `${r}×`;
                  item.onclick = () => { state.player.setPlaybackRate(r); closePlaybackMenu(); };
                  menu.appendChild(item);
              });
              const btnRect = playbackBtn.getBoundingClientRect(); const hostRect = state.host.getBoundingClientRect();
              menu.style.bottom = `${hostRect.bottom - btnRect.top + 8}px`; menu.style.left = `${btnRect.left - hostRect.left + (btnRect.width / 2) - 44}px`;
              state.host.querySelector('.vidu-overlay').appendChild(menu); menuOpen = true;
              setTimeout(() => document.addEventListener('click', closePlaybackMenu, { once: true }));
          });
          
          const updateSeekBg = (el) => { const v = el.value; el.style.background = `linear-gradient(90deg, #39ff14 ${v}%, rgba(255,255,255,0.06) ${v}%)`; };
          seekEl.addEventListener('input', () => updateSeekBg(seekEl));
          seekEl.addEventListener('change', () => state.player.seekTo(state.player.getDuration() * (seekEl.value / 100), true));
          playBtn.addEventListener('click', () => { state.player?.getPlayerState() === 1 ? state.player.pauseVideo() : state.player.playVideo(); });
          
          return new Promise((resolve, reject) => {
              state.player = new YT.Player(state.mount.id, {
                  videoId, width: '100%', height: '100%',
                  playerVars: { controls: 0, disablekb: 1, rel: 0, modestbranding: 1, playsinline: 1, iv_load_policy: 3, origin: location.origin },
                  events: {
                      onReady: (evt) => {
                          evt.target.setVolume(globalLastVolume); evt.target.playVideo();
                          state.updateInterval = setInterval(() => {
                              if (!state.player) return; const dur = state.player.getDuration(), cur = state.player.getCurrentTime();
                              get('vidu_cur').textContent = fmtTime(cur); get('vidu_dur').textContent = fmtTime(dur);
                              if(document.activeElement !== seekEl) { seekEl.value = (cur / dur) * 100 || 0; updateSeekBg(seekEl); }
                              playBtn.innerHTML = state.player.getPlayerState() === 1 ? pauseSVG() : playSVG();
                          }, 250);
                          resolve(state.player);
                      },
                      onStateChange: (e) => { if (e.data === 1) get('vidu_loading').classList.add('hidden'); },
                      onError: reject
                  }
              });
          });
      }
      function destroyPlayer(){
          if (state.updateInterval) clearInterval(state.updateInterval);
          if (state.keyHandler) document.removeEventListener('keydown', state.keyHandler);
          if (state.player) { try { state.player.destroy(); } catch (e) {} }
          if (state.host) { try { state.host.remove(); } catch(e) {} }
          Object.keys(state).forEach(k => state[k] = null);
      }
      window.showViduPlayer = createYTPlayer;
      window.destroyViduPlayer = destroyPlayer;
  })();

    // Initial setup and login wiring
    buildTiles();

    const loginBtnTop = document.getElementById('login-btn-top');
    const loginModal = document.getElementById('login-modal');
    const loginClose = document.getElementById('login-close');
    const loginUsernameInput = document.getElementById('login-username');
    const loginPasswordInput = document.getElementById('login-password');
    const loginSubmit = document.getElementById('login-submit');
    const loginError = document.getElementById('login-error');
    
    const accessModal = document.getElementById('access-modal');
    const accessClose = document.getElementById('access-close');
    const accessRequestBtn = document.getElementById('access-request-btn');

    const noAccessModal = document.getElementById('no-access-modal');
    const noAccessClose = document.getElementById('no-access-close');
    const noAccessRequestBtn = document.getElementById('no-access-request-btn');

    const requestAccessLink = 'https://wa.me/254703255099';

    function handleLogin() {
        const username = loginUsernameInput.value.trim();
        const password = loginPasswordInput.value.trim();
        loginError.textContent = '';
        const userAccount = userPermissions[username];
        if (userAccount && userAccount.password === password) {
            currentUser = { username: username, permissions: userAccount.access || [] };
            alert('✅ Logged in successfully!');
            closeModal(loginModal);
            loginBtnTop.textContent = `Logged In as ${username}`;
            loginBtnTop.disabled = true;
        } else {
            loginError.textContent = 'Invalid username or password.';
        }
    }

    loginBtnTop.addEventListener('click', () => {
        loginError.textContent = ''; loginUsernameInput.value = ''; loginPasswordInput.value = '';
        showModal(loginModal); setTimeout(() => loginUsernameInput.focus(), 120);
    });
    loginClose.addEventListener('click', () => closeModal(loginModal));
    loginModal.addEventListener('click', (e) => { if (e.target === loginModal) closeModal(loginModal); });
    loginSubmit.addEventListener('click', handleLogin);
    loginPasswordInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') handleLogin(); });

    accessClose.addEventListener('click', () => closeModal(accessModal));
    accessModal.addEventListener('click', (e) => { if (e.target === accessModal) closeModal(accessModal); });
    accessRequestBtn.addEventListener('click', () => window.open(requestAccessLink, '_blank'));

    noAccessClose.addEventListener('click', () => closeModal(noAccessModal));
    noAccessModal.addEventListener('click', (e) => { if (e.target === noAccessModal) closeModal(noAccessModal); });
    noAccessRequestBtn.addEventListener('click', () => window.open(requestAccessLink, '_blank'));
  })();
  </script>
</body>
</html>
