<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Private Classes — VIDU</title>

  <style>
    /* ---- ROOT VARIABLES & GLOBAL STYLES ---- */
    :root {
      --bg-main: #0A0C10;
      --bg-glass: rgba(16, 20, 28, 0.6);
      --border-color: rgba(136, 146, 176, 0.2);
      --glow-color: rgba(0, 255, 138, 0.8);
      --accent-primary: #00FF8A;
      --accent-secondary: #40E0D0;
      --text-primary: #E0E6F1;
      --text-secondary: #8892B0;
      --font-main: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      --font-mono: 'Roboto Mono', monospace, sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      scroll-behavior: smooth;
    }

    body {
      background-color: var(--bg-main);
      background-image: url('assets/images/background.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      color: var(--text-primary);
      font-family: var(--font-main);
      line-height: 1.5;
      height: 100%;
      position: relative;
    }
    
    /* Futuristic background overlay */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      z-index: -1;
      background: 
        radial-gradient(ellipse at center, rgba(10, 12, 16, 0.4) 0%, rgba(10, 12, 16, 0.95) 100%),
        linear-gradient(rgba(10, 12, 16, 0.2), rgba(10, 12, 16, 0.2)),
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.04'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }

    /* ---- TOP NAVIGATION BAR ---- */
    .topbar {
      position: fixed;
      left: 0;
      right: 0;
      top: 0;
      z-index: 120;
      background: rgba(10, 12, 16, 0.5);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border-color);
      box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
    }

    .topbar-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 46px;
      height: 46px;
      border-radius: 8px;
      background: linear-gradient(145deg, #10141C, #0A0C10);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      text-decoration: none;
      border: 1px solid var(--border-color);
      transition: all .2s ease;
    }
    .logo-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.6), 0 0 15px var(--glow-color);
      border-color: var(--accent-primary);
    }

    .nav {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .nav a, .nav button {
      color: var(--text-secondary);
      text-decoration: none;
      padding: 8px 12px;
      font-weight: 700;
      border-radius: 6px;
      font-size: 14px;
      background: transparent;
      border: 0;
      cursor: pointer;
      transition: color .2s ease, transform .2s ease;
    }

    .nav a:hover, .nav button:hover {
      color: var(--text-primary);
      transform: translateY(-2px);
    }
    .nav a.active, .nav button.active {
      color: var(--accent-primary);
    }

    /* ---- PAGE CONTENT ---- */
    .page {
      margin-top: 100px;
      min-height: calc(100vh - 120px);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 28px;
    }

    .title {
      font-size: 48px;
      font-weight: 900;
      color: #fff;
      text-shadow: 0 0 10px rgba(0, 255, 138, 0.2), 0 0 20px rgba(0, 0, 0, 0.8);
      margin-bottom: 8px;
      letter-spacing: -1px;
    }

    .subtitle {
      color: var(--text-secondary);
      margin-bottom: 40px;
      font-size: 16px;
      max-width: 600px;
    }

    /* ---- CONTENT CARDS ---- */
    .tiles {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 24px;
    }
    
    .card {
      all: unset; /* Reset button styles */
      display: block; /* Make it behave like a div */
      position: relative;
      background: var(--bg-glass);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border-color);
      cursor: pointer;
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.3s ease;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      transform-style: preserve-3d;
      min-height: 280px;
    }
    .card:hover {
      transform: translateY(-10px) perspective(1000px) rotateX(2deg) rotateY(-2deg) scale(1.02);
      box-shadow: 0 20px 50px rgba(0,0,0,0.7);
    }
    .card .card-border {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      border: 1px solid transparent;
      transition: border-color .3s ease;
      pointer-events: none;
    }
    .card:hover .card-border {
      border-color: var(--accent-primary);
    }
    .card .card-glow {
      position: absolute;
      inset: -2px;
      border-radius: 14px;
      background: radial-gradient(ellipse at center, var(--glow-color), transparent 70%);
      opacity: 0;
      transition: opacity .3s ease;
      pointer-events: none;
      filter: blur(20px);
    }
    .card:hover .card-glow {
      opacity: 0.15;
    }
    
    body.viewer-is-open .card:hover {
        transform: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    body.viewer-is-open .card:hover .card-border {
        border-color: transparent;
    }
    body.viewer-is-open .card:hover .card-glow {
        opacity: 0;
    }

    .card-thumbnail {
      height: 160px;
      background: linear-gradient(45deg, #0A0C10, #10141C);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      border-bottom: 1px solid var(--border-color);
    }
    .card .thumbnail-icon {
      color: var(--accent-primary);
      opacity: 0.7;
      transition: opacity .3s ease, transform .3s ease;
    }
    .card:hover .thumbnail-icon {
      opacity: 1;
      transform: scale(1.1);
    }
    .card .thumbnail-overlay {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(to right, var(--border-color) 1px, transparent 1px),
        linear-gradient(to bottom, var(--border-color) 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: 0.2;
    }
    .card-content {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .card-type {
      font-family: var(--font-mono);
      font-size: 12px;
      color: var(--accent-secondary);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .card-title {
      font-weight: 800;
      color: var(--text-primary);
      font-size: 16px;
      line-height: 1.3;
    }

    /* ---- MODALS (Unified Style) ---- */
    .modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      z-index: 300;
      padding: 18px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease;
    }
    .modal:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
    }
    .modal.hidden {
      display: none;
    }
    .modal-box {
      max-width: 420px;
      width: 100%;
      background: var(--bg-glass);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
      color: #fff;
      text-align: center;
      position: relative;
      border: 1px solid var(--border-color);
      transform: scale(0.95);
      transition: transform .2s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    .modal:not(.hidden) .modal-box {
      transform: scale(1);
    }
    .modal-close {
      position: absolute;
      right: 12px;
      top: 12px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 20px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background .2s ease, color .2s ease;
    }
    .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }

    /* ---- BUTTONS & INPUTS ---- */
    .pw-input, .login-input {
      width: 100%;
      padding: 12px 14px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: rgba(0, 0, 0, 0.3);
      color: var(--text-primary);
      margin-top: 10px;
      font-size: 15px;
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    .pw-input:focus, .login-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 10px var(--glow-color);
    }

    .pw-actions, .login-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      justify-content: center;
    }
    
    .btn {
      padding: 10px 24px;
      border-radius: 8px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(180deg, #00d675, #009d57);
      color: #FFFFFF;
      font-size: 15px;
      transition: transform 0.18s ease, box-shadow .2s ease;
      box-shadow: 0 4px 15px rgba(0, 255, 138, 0.2);
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 255, 138, 0.3);
    }
    .btn.ghost {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      box-shadow: none;
    }
    .btn.ghost:hover {
      background: rgba(255,255,255,0.05);
      border-color: var(--text-secondary);
      box-shadow: none;
    }

    /* Top Login Button */
    .login-btn-top {
      background: linear-gradient(180deg, #00b86a, #008f55);
      color: white;
      font-weight: 700;
      font-size: 14px;
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid rgba(0, 255, 138, 0.3);
      cursor: pointer;
      transition: all .18s ease;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
    .login-btn-top:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.5), 0 0 15px var(--glow-color);
      border-color: var(--accent-primary);
    }
    .login-btn-top:disabled {
      background: var(--bg-glass);
      border-color: var(--border-color);
      cursor: default;
      opacity: 0.8;
      transform: none;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    /* ---- VIDEO PLAYER VIEWER ---- */
    .viewer {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.78);
      backdrop-filter: blur(16px);
      z-index: 400;
      padding: 22px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease;
    }
    .viewer:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
    }
    .viewer.hidden {
      display: none;
    }
    .viewer-inner {
      width: 100%;
      max-width: 1100px;
      height: 72vh;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
      position: relative;
      box-shadow: 0 30px 80px rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      border: 1px solid var(--border-color);
    }
    .viewer-close {
        position: absolute;
        top: 14px;
        right: 14px;
        z-index: 10003;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(0,0,0,0.5);
        border: 1px solid var(--border-color);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        cursor: pointer;
        transition: all .18s ease;
    }
    .viewer-close:hover {
      transform: scale(1.1);
      background: rgba(255,255,255,0.1);
    }

    .now-playing {
      width: 100%;
      padding: 12px 18px;
      background: rgba(0,0,0,0.5);
      color: var(--text-primary);
      font-weight: 900;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border-color);
      z-index: 8;
    }
    .now-playing .label { 
      font-family: var(--font-mono);
      color: var(--accent-secondary);
      font-weight: 800; 
      font-size: 13px;
      text-transform: uppercase; 
    }
    .now-playing .title { 
      color: #fff;
      font-size: 15px; 
      font-weight: 900;
      white-space: nowrap; 
      overflow: hidden; 
      text-overflow: ellipsis;
      text-shadow: 0 1px 4px rgba(0,0,0,0.7);
    }

    .iframe-wrap{width:100%;height:100%;display:block;background:#000;position:relative;}
    
    /* ---- PLAYER UI STYLES ---- */
    .vidu-player-host {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        border-radius: 8px;
        background: #000;
    }
    .vidu-mount { width: 100%; height: 100%; background: #000; }
    .vidu-mount iframe { width: 100%; height: 100%; border: 0; display: block; }
    
    .vidu-loading {
      position: absolute;
      inset: 0;
      z-index: 9998;
      display: flex;
      align-items: center;
      justify-content: center;
      background-image: url('assets/images/header.png');
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      transition: opacity .28s ease;
      pointer-events: none;
    }
    .vidu-loading.hidden { opacity: 0; display: none; }

    .vidu-controls-bg {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 90px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,0.8));
      pointer-events: none;
      z-index: 9996;
      opacity: 1;
      transition: opacity .22s ease;
    }
    .vidu-controls-bg.hidden { opacity: 0; }

    .vidu-overlay {
      position: absolute;
      left: 12px;
      right: 12px;
      bottom: 12px;
      z-index: 9999;
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 8px 12px;
      border-radius: 10px;
      background: var(--bg-glass);
      border: 1px solid var(--border-color);
      backdrop-filter: blur(8px);
      transition: opacity .22s ease, transform .22s ease;
    }
    .vidu-overlay.hidden { opacity: 0; transform: translateY(6px); pointer-events: none; }

    .vidu-btn {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border-radius: 50%;
      cursor: pointer;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 42px;
      height: 42px;
      transition: transform .12s ease, background .2s ease;
    }
    .vidu-btn:hover { background: rgba(255, 255, 255, 0.2); }
    .vidu-btn:active { transform: scale(.96); }
    
    .vidu-range {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.2);
      transition: height .2s ease;
      outline: none;
    }
    .vidu-range:hover { height: 8px; }
    .vidu-range::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--accent-primary);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
      border: none;
      cursor: pointer;
    }
    .vidu-range::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--accent-primary);
      border: none;
      cursor: pointer;
    }

    .vidu-time {
      min-width: 90px;
      font-size: 14px;
      font-weight: 700;
      font-family: var(--font-mono);
      /* MODIFIED: Changed color to white for readability */
      color: #FFFFFF;
      text-align: center;
      letter-spacing: 1px;
    }
    
    .vidu-close-btn{
      position:absolute; top:10px; right:10px; z-index:10002; width:36px; height:36px; padding:6px;
      border-radius:8px; background:rgba(0,0,0,0.46); border:1px solid rgba(255,255,255,0.06);
      color:#fff; display:flex; align-items:center; justify-content:center; font-weight:800;
      cursor:pointer; box-shadow:0 8px 24px rgba(0,0,0,0.6); transition:opacity .18s ease,transform .18s ease;
    }
    .vidu-close-btn.hidden{opacity:0;transform:translateY(-6px);pointer-events:none}

    /* Responsive player controls for small screens */
    @media (max-width: 500px) {
      .vidu-overlay { gap: 6px; padding: 6px 8px; left: 6px; right: 6px; bottom: 6px; }
      .vidu-btn { width: 40px; height: 40px; }
      .vidu-time { min-width: 70px; font-size: 12px; }
    }

    /* Centered volume feedback */
    .vidu-volume-overlay {
      position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; z-index: 100010;
    }
    .vidu-volume-card {
      display: flex;
      gap: 12px;
      align-items: center;
      min-width: 160px;
      padding: 12px 18px;
      border-radius: 12px;
      background: var(--bg-glass);
      box-shadow: 0 10px 40px rgba(0,0,0,0.6);
      border: 1px solid var(--border-color);
      backdrop-filter: blur(10px);
      transform: scale(0.86);
      opacity: 0;
      transition: transform .22s cubic-bezier(.2,.9,.2,1), opacity .22s ease;
      color: #f4fff4;
    }
    .vidu-volume-overlay.visible .vidu-volume-card { transform: scale(1); opacity: 1; }
    .vidu-vol-icon {
      width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
    }
    .vidu-vol-percent { font-size: 18px; font-weight: 900; color: #fff; min-width: 46px; text-align: left; }
    .vidu-vol-sub { font-size: 12px; font-family: var(--font-mono); color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }

    /* Playback Menu */
    .vidu-playback-menu {
      position: absolute; z-index: 100005; background: var(--bg-glass); border: 1px solid var(--border-color);
      backdrop-filter: blur(10px); border-radius: 8px; padding: 6px; box-shadow: 0 12px 30px rgba(0,0,0,0.6); min-width: 88px;
    }
    .vidu-playback-item {
      display: block; width: 100%; border: 0; padding: 8px 10px; color: var(--text-primary); text-align: center;
      font-weight: 800; cursor: pointer; border-radius: 6px; margin: 0; background: transparent; font-size: 13px;
    }
    .vidu-playback-item:hover { background: rgba(255,255,255,0.1); }
    .vidu-playback-item.active { background: rgba(0, 255, 138, 0.2); color: #fff; }

    /* ---- PLAYLIST POPUP ---- */
    .playlist-popup {
      position: fixed; inset: 12px; z-index: 600; display: none; align-items: center; justify-content: center; pointer-events: auto;
    }
    .playlist-popup.visible { display: flex; }
    .playlist-popup-inner {
      width: 100%;
      height: 100%;
      background: var(--bg-glass);
      border-radius: 14px;
      box-shadow: 0 40px 120px rgba(0,0,0,0.8);
      padding: 18px;
      border: 1px solid var(--border-color);
      backdrop-filter: blur(16px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .playlist-popup-header {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 12px; flex-shrink: 0;
    }
    .playlist-popup-count {
      font-weight: 700; color: var(--text-primary); font-family: var(--font-mono); background: rgba(0, 255, 138, 0.1); padding: 8px 12px; border-radius: 8px; font-size: 14px; border: 1px solid rgba(0, 255, 138, 0.2);
    }
    .playlist-popup-title { font-size: 20px; font-weight: 900; color: #fff; flex: 1; text-align: left; margin-left: 16px; }
    .playlist-popup-close {
      border: 0; background: transparent; color: var(--text-secondary); font-weight: 800; font-size: 20px; cursor: pointer;
    }
    .playlist-popup-body {
      overflow: auto; border-radius: 10px; flex: 1;
    }
    .playlist-item {
      display: flex; gap: 16px; align-items: center; padding: 12px; border-radius: 10px;
      transition: background .12s ease; cursor: pointer; margin-bottom: 8px; background: rgba(255,255,255,0.02);
      border: 1px solid transparent;
    }
    .playlist-item:hover { background: rgba(255,255,255,0.05); border-color: var(--border-color); }
    .playlist-item-num-thumb {
      width: 120px; height: 68px; flex: 0 0 120px; border-radius: 8px; background: #000;
      display: flex; align-items: center; justify-content: center; font-size: 36px;
      font-weight: 900; color: var(--accent-primary);
      text-shadow: 0 0 8px var(--glow-color); user-select: none;
      border: 1px solid var(--border-color);
    }
    .playlist-item .meta { display: flex; flex-direction: column; gap: 4px; }
    .playlist-item .meta .t { font-weight: 700; color: #fff; font-size: 15px; }
    .playlist-item .meta .s { color: var(--text-secondary); font-size: 12px; }

    /* ---- LOADING INDICATORS ---- */
    .playlist-loading-indicator {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      height: 100%; gap: 18px; user-select: none; text-align: center;
    }
    .playlist-loading-indicator .spinner {
      width: 48px; height: 48px; border: 5px solid var(--border-color); border-top-color: var(--accent-primary);
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    .playlist-loading-indicator .loading-text {
      font-size: 18px; font-weight: 800; color: var(--text-secondary);
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-popup {
      position: fixed; inset: 0; z-index: 800; display: none; align-items: center;
      justify-content: center; pointer-events: none; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px);
    }
    .loading-popup.visible { display: flex; pointer-events: auto; }
    .loading-card {
      width: min(540px, 90%); background: var(--bg-glass); padding: 24px; border-radius: 12px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.7); text-align: center; color: var(--text-primary);
      border: 1px solid var(--border-color);
    }
    .loading-label { font-weight: 700; margin-bottom: 16px; font-size: 16px; font-family: var(--font-mono); }
    .loading-bar-wrap { background: rgba(0,0,0,0.3); border-radius: 999px; height: 10px; overflow: hidden; border: 1px solid var(--border-color); }
    .loading-bar { height: 100%; width: 0%; border-radius: 999px; background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary)); transition: width 2s linear; }

    /* ---- FOOTER ---- */
    .copyright {
      text-align: center;
      margin-top: 40px;
      padding-bottom: 20px;
      color: var(--text-secondary);
      font-size: 13px;
    }
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="left">
        <a class="logo-btn" href="index.html" title="Home" aria-label="Home">
          <svg width="30" height="30" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
            <defs><linearGradient id="gV" x1="0" x2="1" y1="0" y2="1"><stop offset="0" stop-color="#00ff8a"/><stop offset="1" stop-color="#00b86a"/></linearGradient></defs>
            <rect x="4" y="4" width="56" height="56" rx="8" fill="rgba(10,12,16,0.5)"/>
            <path d="M16 16 L32 46 L48 16" stroke="url(#gV)" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
        <nav class="nav" aria-label="Main navigation">
          <a href="index.html">🏠 Home</a>
          <a href="about.html">ℹ️ About</a>
          <button id="nav-private"></button>
        </nav>
      </div>
      <button id="login-btn-top" class="login-btn-top">🔑 Login</button>
    </div>
  </header>

  <main class="page" role="main">
    <div class="container">
      <h1 class="title">Private Classes</h1>
      <p class="subtitle">Access exclusive content by logging in with a permitted account. Contact VIDU to request access.</p>

      <section id="tiles" class="tiles" aria-live="polite"></section>
      <div class="copyright">© VIDU. All rights reserved.</div>
    </div>
  </main>

  <div id="login-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-box" role="document">
      <button class="modal-close" id="login-close" aria-label="Close">✕</button>
      <h3 style="color:#dfeee1; font-weight:800; margin-bottom:16px; font-size: 22px;">🗝️ Secure Login</h3>
      <input id="login-username" class="login-input" type="text" placeholder="Username" autocomplete="username" />
      <input id="login-password" class="login-input" type="password" placeholder="Password" autocomplete="current-password" />
      <div class="login-actions">
        <button id="login-submit" class="btn">Login</button>
      </div>
      <p id="login-error" style="color:#ff8080;margin-top:12px;min-height:18px;"></p>
    </div>
  </div>

  <div id="access-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-box" role="document">
        <button class="modal-close" id="access-close" aria-label="Close">✕</button>
        <p style="font-size: 20px; font-weight: 700; color: #eaf7ea; margin: 20px 0;">🔒 Login Required</p>
        <p style="color: var(--text-secondary); margin-bottom: 24px;">You need to be logged in to access this content.</p>
        <div class="pw-actions">
            <button id="access-request-btn" class="btn">Request Access</button>
        </div>
    </div>
  </div>

  <div id="no-access-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-box" role="document">
      <button class="modal-close" id="no-access-close" aria-label="Close">✕</button>
      <p style="font-size: 20px; font-weight: 700; color: #eaf7ea; margin: 20px 0;">🚫 Access Denied</p>
      <p style="color: var(--text-secondary); margin-bottom: 24px;">Your account does not have permission for this content.</p>
      <div class="pw-actions">
          <button id="no-access-request-btn" class="btn">Request Access</button>
      </div>
    </div>
  </div>

  <div id="pw-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-box" role="document">
      <button class="modal-close" id="pw-close" aria-label="Close">✕</button>
      <div class="modal-preview" id="modal-preview"></div>
      <h3 id="pw-title" style="color:#dfeee1;font-weight:800;margin-bottom:6px;">Enter password</h3>
      <input id="pw-input" class="pw-input" type="password" placeholder="Password" autocomplete="off" />
      <div class="pw-actions">
        <button id="pw-submit" class="btn">Unlock</button>
        <button id="pw-cancel" class="btn ghost">Cancel</button>
      </div>
      <p id="pw-error" style="color:#ff8080;margin-top:10px;min-height:18px;"></p>
    </div>
  </div>

  <div id="viewer" class="viewer hidden" aria-hidden="true">
    <div class="viewer-inner">
      <div class="now-playing" aria-hidden="false">
        <div class="label">Now playing</div>
        <div class="title" id="now-playing-title">—</div>
      </div>
      <div id="iframe-wrap" class="iframe-wrap"></div>
      <button id="viewer-close" class="viewer-close" aria-label="Close viewer">✕</button>
    </div>
  </div>

  <div id="playlist-popup" class="playlist-popup" aria-hidden="true">
    <div class="playlist-popup-inner" role="dialog" aria-modal="true" aria-label="Playlist">
      <div class="playlist-popup-header">
        <div class="playlist-popup-title" id="playlist-popup-title">Playlist</div>
        <div class="playlist-popup-count" id="playlist-count">0 Videos</div>
        <button class="playlist-popup-close" id="playlist-popup-close" aria-label="Close playlist">✕</button>
      </div>
      <div class="playlist-popup-body" id="playlist-popup-body" tabindex="0"></div>
    </div>
  </div>

  <div id="loading-popup" class="loading-popup" aria-hidden="true">
    <div class="loading-card" role="status" aria-live="polite">
      <div class="loading-label">Initializing VIDU Player</div>
      <div class="loading-bar-wrap" aria-hidden="false">
        <div id="loading-bar" class="loading-bar" style="width:0%"></div>
      </div>
    </div>
  </div>

  <div id="js-fail-note" style="display:none;position:fixed;right:14px;bottom:14px;background:rgba(255,80,80,0.12);color:#ffdede;border:1px solid rgba(255,80,80,0.2);padding:8px 12px;border-radius:8px;font-size:13px;z-index:9999">Some features may be unavailable — enable JavaScript.</div>

  <script>
  (function(){
    /* ---------- configuration ---------- */
    const YT_API_KEY = 'AIzaSyB8UVKOZOnUnYdqbFGOtlg6BPfR9HpD35c'; // keep your key here (used for playlist fetching)
    const YT_API_LOAD_TIMEOUT = 18000; // ms - how long to wait for YT API before showing error

    /* ===== MODIFIED: User Permission System ===== */
    const userPermissions = {
      'vidu': { password: 'vidu123', access: ['PHONK', 'TEST', 'ICT', 'ET Speed Revision', 'ET Theory'] },
      'Imal': { password: '123', access: ['ET Speed Revision', 'ET Theory'] },
      'user': { password: 'password', access: ['PHONK', 'TEST'] }
    };
    let currentUser = null; // Stores the logged-in user's data.

    let globalLastVolume = 100;

    /* ---------- sample items ---------- */
    const items = [
      { type: 'video', title: 'PHONK', idB64: btoa("m0fM0rBN7cQ"), passB64: btoa("")},
      { type: 'video', title: 'TEST', idB64: btoa("Lexok6H2c2s"), passB64: btoa("")},
      { type: 'playlist', title: 'ICT', idB64: btoa("PL9zX0VbNmKiFlxda5PCTn4_hA_7iKjEaA&si=9nF_7qpAzKt4cYZd"), passB64: btoa("6002vidu") },
      { type: 'playlist', title: 'ET Speed Revision', idB64: btoa("PL9zX0VbNmKiF-Q7bnmM1v_DrT3_Ol-Of5&si=efJHPzWR-kZcGwYw"), passB64: btoa("amilaet") },
      { type: 'playlist', title: 'ET Theory', idB64: btoa("PL9zX0VbNmKiFKQ388JcZsq18mlyIe7BeI&si=cn4rwat6rsqC8kH_"), passB64: btoa("amilaet") }
    ];

    /* ---------- utilities ---------- */
    function escapeHtml(s){ return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function normalizeIdFromB64(idB64){
      try { return atob(idB64 || '').split('&')[0]; } catch(e){ console.warn('Invalid idB64', idB64, e); return ''; }
    }

    /* ---------- RENDER TILES (NEW DESIGN) ---------- */
    function buildTiles(){
      const tiles = document.getElementById('tiles');
      if (!tiles) {
        console.error('Error: Tiles container #tiles not found.');
        return;
      }
      tiles.innerHTML = '';
      items.forEach((it, idx)=>{
        const card = document.createElement('button');
        card.className = 'card';
        card.type = 'button';
        card.setAttribute('data-idx', idx);
        card.setAttribute('aria-label', it.title + ' ' + it.type);
        card.setAttribute('data-type', it.type);
        
        card.innerHTML = `
          <div class="card-glow"></div>
          <div class="card-border"></div>
          <div class="card-thumbnail">
            <div class="thumbnail-overlay"></div>
            <div class="thumbnail-icon">
              ${it.type === 'playlist' ? 
                `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h4"/><path d="M14 7h6"/><path d="M14 11h6"/><path d="M14 15h6"/></svg>` : 
                `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>`
              }
            </div>
          </div>
          <div class="card-content">
            <span class="card-type">${escapeHtml(it.type)}</span>
            <h3 class="card-title">${escapeHtml(it.title)}</h3>
          </div>
        `;

        card.addEventListener('click', ()=> handleTileClick(it));
        tiles.appendChild(card);
      });
    }

    /* ---------- modal helpers ---------- */
    function showModal(el){ el.classList.remove('hidden'); el.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
    function closeModal(el){ el.classList.add('hidden'); el.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }

    /* ---------- Playlist popup helpers & state ---------- */
    let lastOpenedPlaylistItem = null;
    const playlistCache = {}; 
    const playlistPopup = document.getElementById('playlist-popup');
    const playlistBody = document.getElementById('playlist-popup-body');
    const playlistCountEl = document.getElementById('playlist-count');
    const playlistTitleEl = document.getElementById('playlist-popup-title');
    const playlistCloseBtn = document.getElementById('playlist-popup-close');
    const loadingPopup = document.getElementById('loading-popup');
    const loadingBar = document.getElementById('loading-bar');

    function renderPlaylistBody(videos) {
      playlistBody.innerHTML = '';
      playlistCountEl.textContent = `${videos.length} Videos`;

      if (!videos.length) {
        playlistBody.innerHTML = `<div style="padding:18px;color:#ffdede">No videos found in this playlist.</div>`;
        return;
      }

      videos.forEach((v, index) => {
        const node = document.createElement('div');
        node.className = 'playlist-item';
        node.innerHTML = `
          <div class="playlist-item-num-thumb">${index + 1}</div>
          <div class="meta">
            <div class="t">${escapeHtml(v.title)}</div>
            <div class="s">Click to play</div>
          </div>
        `;
        node.tabIndex = 0;

        function clickHandler() {
          closePlaylistPopup();
          showLoadingPopupThenPlay(v);
        }
        node.addEventListener('click', clickHandler);
        node.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            clickHandler();
          }
        });
        playlistBody.appendChild(node);
      });
      playlistBody.scrollTop = 0;
    }

    function openPlaylistPopup(item) {
      playlistTitleEl.textContent = item.title || 'Playlist';
      lastOpenedPlaylistItem = item;
      const playlistId = normalizeIdFromB64(item.idB64 || '');

      if (playlistCache[playlistId]) {
        renderPlaylistBody(playlistCache[playlistId]);
        playlistPopup.classList.add('visible');
        playlistPopup.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
      } else {
        playlistCountEl.textContent = 'Loading...';
        playlistBody.innerHTML = `
          <div class="playlist-loading-indicator">
            <div class="spinner"></div>
            <div class="loading-text">Initializing VIDU Fetcher...</div>
          </div>
        `;
        playlistPopup.classList.add('visible');
        playlistPopup.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';

        (async () => {
          try {
            const videos = await fetchPlaylistVideos(playlistId);
            playlistCache[playlistId] = videos; 

            if (lastOpenedPlaylistItem === item && playlistPopup.classList.contains('visible')) {
              renderPlaylistBody(videos);
            }
          } catch (err) {
            console.error("Playlist fetch error:", err);
            if (lastOpenedPlaylistItem === item && playlistPopup.classList.contains('visible')) {
              playlistBody.innerHTML = `<div style="padding:18px;color:#ffdede">Failed to load playlist: ${escapeHtml(err && err.message ? err.message : String(err))}</div>`;
              playlistCountEl.textContent = '0 Videos';
            }
          }
        })();
      }
    }

    function closePlaylistPopup(){
      playlistPopup.classList.remove('visible');
      playlistPopup.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    playlistCloseBtn.addEventListener('click', ()=> closePlaylistPopup());
    playlistPopup.addEventListener('click', (e)=> { if(e.target === playlistPopup) closePlaylistPopup(); });

    async function showLoadingPopupThenPlay(v) {
      loadingBar.style.transition = 'width 0.5s ease-out';
      loadingBar.style.width = '0%';
      loadingPopup.classList.add('visible');
      loadingPopup.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      
      setTimeout(() => { loadingBar.style.width = '30%'; }, 20);

      const videoItem = { type: 'video', title: v.title, idB64: btoa(v.videoId) };
      
      try {
        const playerPromise = openViewer(videoItem); 
        
        setTimeout(() => { loadingBar.style.width = '90%'; }, 500);

        await playerPromise;

        loadingBar.style.transition = 'width 0.3s ease-out';
        loadingBar.style.width = '100%';

        setTimeout(() => {
            loadingPopup.classList.remove('visible');
            loadingPopup.setAttribute('aria-hidden','true');
            
            setTimeout(() => {
                loadingBar.style.transition = 'none';
                loadingBar.style.width = '0%';
            }, 300);
        }, 300);

      } catch (error) {
        console.error("Failed to load player:", error);
        loadingPopup.classList.remove('visible');
        loadingPopup.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
      }
    }

    function handleTileClick(item) {
        const noAccessModal = document.getElementById('no-access-modal');
        const accessModal = document.getElementById('access-modal');
        if (currentUser) {
            if (currentUser.permissions.includes(item.title)) {
                if (item && item.type === 'playlist') {
                    openPlaylistPopup(item);
                } else {
                    lastOpenedPlaylistItem = null;
                    const videoDetails = { videoId: normalizeIdFromB64(item.idB64), title: item.title };
                    showLoadingPopupThenPlay(videoDetails);
                }
            } else {
                showModal(noAccessModal);
            }
        } else {
            showModal(accessModal);
        }
    }

    /* ---------- (Original) password modal - kept for integrity ---------- */
    let currentItem = null;
    const pwModal = document.getElementById('pw-modal');
    const pwTitleEl = document.getElementById('pw-title');
    const pwInput = document.getElementById('pw-input');
    const pwSubmit = document.getElementById('pw-submit');
    const pwCancel = document.getElementById('pw-cancel');
    const pwClose = document.getElementById('pw-close');
    const pwError = document.getElementById('pw-error');
    const modalPreview = document.getElementById('modal-preview');

    function openPasswordModal(item){
      try{
        const decoded = item && typeof item.passB64 === 'string' ? atob(item.passB64) : '';
        if(!decoded || decoded.trim() === ''){ 
          const videoDetails = { videoId: normalizeIdFromB64(item.idB64), title: item.title };
          showLoadingPopupThenPlay(videoDetails);
          return;
        }
      }catch(e){ console.warn('passB64 decode failed, showing modal', e); }
      currentItem = item;
      pwError.textContent = '';
      pwInput.value = '';
      pwTitleEl.textContent = `Unlock: ${item.title}`;
      modalPreview.innerHTML = ``;
      showModal(pwModal);
      setTimeout(()=> pwInput.focus(), 120);
    }

    function verifyPassword(){
      if(!currentItem) return;
      const entered = (pwInput.value || '').trim();
      try{
        const expected = atob(currentItem.passB64 || '');
        if(entered === expected){
          closeModal(pwModal);
          const videoDetails = { videoId: normalizeIdFromB64(currentItem.idB64), title: currentItem.title };
          showLoadingPopupThenPlay(videoDetails);
        } else {
          pwError.textContent = 'Incorrect password. Try again.';
          pwInput.select();
        }
      }catch(e){ pwError.textContent = 'Error checking password.'; }
    }

    pwSubmit.addEventListener('click', verifyPassword);
    pwInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') verifyPassword(); });
    pwCancel.addEventListener('click', ()=> closeModal(pwModal));
    pwClose.addEventListener('click', ()=> closeModal(pwModal));
    pwModal.addEventListener('click', (e)=> { if(e.target === pwModal) closeModal(pwModal); });

    /* ---------- YT API loader ---------- */
    function loadYTApi(){
      if(window.YT && window.YT.Player) return Promise.resolve();
      if(window._vidu_loading_yt_promise) return window._vidu_loading_yt_promise;
      window._vidu_loading_yt_promise = new Promise((resolve, reject)=>{
        const s = document.createElement('script'); s.src = 'https://www.youtube.com/iframe_api'; s.async = true;
        s.onerror = () => reject(new Error('YT API failed to load (network error)'));
        document.head.appendChild(s); let finished = false;
        window.onYouTubeIframeAPIReady = function(){ if(finished) return; finished = true; resolve(); };
        const poll = setInterval(()=> {
          if(window.YT && window.YT.Player){ if(finished) return; finished = true; clearInterval(poll); resolve(); }
        }, 200);
        setTimeout(()=> {
          if(finished) return; finished = true; clearInterval(poll); reject(new Error('YT API timed out'));
        }, YT_API_LOAD_TIMEOUT);
      });
      return window._vidu_loading_yt_promise;
    }

    /* ---------- Player module ---------- */
    (function playerModule(){
      if(window.__viduPlayerLoaded) return;
      window.__viduPlayerLoaded = true;

      const state = { player: null, updateInterval: null, keyHandler: null, mo: null, host: null, mount: null, fsListener: null, fsResizeHandler: null, inactivityTimer: null, lastActivity: Date.now(), desiredPlaying: null, lastVolume: 100, volumeHideTimer: null };

      function pad2(n){ n = Math.max(0, Math.floor(n||0)); return (n < 10 ? '0' + n : String(n)); }
      function fmtTime(s){ s = Math.max(0, Math.floor(s||0)); const h = Math.floor(s/3600); const m = Math.floor((s%3600)/60); const sec = s%60; return (h > 0 ? pad2(h) + ' : ' : '') + pad2(m) + ' : ' + pad2(sec); }
      function playSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 4.5v15l12-7.5L6 4.5z" fill="#fff"/></svg>`; }
      function pauseSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="5" y="4" width="4" height="16" rx="1.2" fill="#fff"/><rect x="15" y="4" width="4" height="16" rx="1.2" fill="#fff"/></svg>`; }
      function gearSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zm7.4-3.5c0-.4-.03-.78-.09-1.15l1.86-1.44a.5.5 0 0 0 .12-.65l-1.76-3.05a.5.5 0 0 0-.6-.22l-2.2.88a7.72 7.72 0 0 0-1.9-1.1l-.33-2.33A.5.5 0 0 0 13.9 2h-3.8a.5.5 0 0 0-.5.42l-.33 2.33c-.69.25-1.35.6-1.95 1.02l-2.2-.88a.5.5 0 0 0-.6.22L2.7 6.96a.5.5 0 0 0 .12.65l1.86 1.44c-.06.37-.09.75-.09 1.15s.03.78.09 1.15L2.82 14.95a.5.5 0 0 0-.12.65l1.76 3.05c.14.24.4.34.64.28l2.2-.88c.6.42 1.26.77 1.95 1.02l.33 2.33c.03.25.25.42.5.42h3.8c.25 0 .47-.17.5-.42l.33-2.33c.69-.25 1.35-.6 1.95-1.02l2.2.88c.24.09.5-.04.64-.28l1.76-3.05a.5.5 0 0 0-.12-.65l-1.86-1.44c.06-.37.09-.75.09-1.15z" fill="#fff"/></svg>`; }
      function enterFullscreenSVG() { return `<svg viewBox="0 0 24 24" width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 3h6v6m-2-4L11 13m-2 8H3v-6m2 4l8-8" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`; }
      function exitFullscreenSVG() { return `<svg viewBox="0 0 24 24" width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 9V3h6m4 2L5 13m16-2v6h-6m-2-4l8 8" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`; }

      function createHostElementsIn(mountRootId){
        const wrap = document.getElementById(mountRootId);
        if(!wrap) throw new Error('#' + mountRootId + ' not found');
        const prev = wrap.querySelector('.vidu-player-host');
        if(prev) prev.remove();
        const host = document.createElement('div'); host.className = 'vidu-player-host';
        const mount = document.createElement('div'); mount.className = 'vidu-mount'; mount.id = 'vidu_mount_'+Math.floor(Math.random()*1e6);
        mount.style.height = '100%'; mount.style.background = '#000';
        host.appendChild(mount);
        const loadingDiv = document.createElement('div'); loadingDiv.className = 'vidu-loading'; host.appendChild(loadingDiv);
        const ctrlBg = document.createElement('div'); ctrlBg.className = 'vidu-controls-bg'; host.appendChild(ctrlBg);
        const overlay = document.createElement('div'); overlay.className = 'vidu-overlay';
        overlay.innerHTML = `
          <button class="vidu-btn" id="vidu_playbtn">${playSVG()}</button>
          <div class="vidu-time" id="vidu_cur">${fmtTime(0)}</div>
          <input id="vidu_seek" class="vidu-range" type="range" min="0" max="100" step="0.1" value="0" />
          <div class="vidu-time" id="vidu_dur">${fmtTime(0)}</div>
          <button class="vidu-btn" id="vidu_playbackbtn" title="Playback speed" aria-label="Playback speed">${gearSVG()}</button>
          <button class="vidu-btn" id="vidu_fullbtn" title="Toggle fullscreen" aria-label="Toggle fullscreen">${enterFullscreenSVG()}</button>
        `;
        host.appendChild(overlay);
        const closeBtn = document.createElement('button'); closeBtn.className = 'vidu-close-btn'; closeBtn.id = 'vidu_closebtn'; closeBtn.title = 'Close'; closeBtn.type = 'button'; closeBtn.innerHTML = '✕';
        closeBtn.addEventListener('click', ()=> { document.getElementById('viewer-close').click(); });
        host.appendChild(closeBtn);
        const volWrap = document.createElement('div'); volWrap.className = 'vidu-volume-overlay'; volWrap.setAttribute('aria-hidden','true');
        volWrap.innerHTML = `<div class="vidu-volume-card" role="status" aria-live="polite"><div class="vidu-vol-icon" id="vidu_vol_icon"></div><div style="display:flex;flex-direction:column;align-items:flex-start;justify-content:center"><div class="vidu-vol-percent" id="vidu_vol_pct">100%</div><div class="vidu-vol-sub">Volume</div></div></div>`;
        host.appendChild(volWrap);
        wrap.appendChild(host);
        return { host, mount, overlay, ctrlBg, closeBtn, loadingDiv, volWrap };
      }

      function disableIframeClicks(host){ try{ const ifr = host.querySelector('iframe'); if(ifr){ ifr.style.pointerEvents = 'none'; } }catch(e){ console.warn('disableIframeClicks', e); } }

      async function createYTPlayer(videoId, mountRootId='player-wrap'){
        await loadYTApi();
        const { host, mount, overlay, ctrlBg, closeBtn, loadingDiv, volWrap } = createHostElementsIn(mountRootId);
        state.host = host; state.mount = mount;
        const playBtn = overlay.querySelector('#vidu_playbtn');
        const curEl = overlay.querySelector('#vidu_cur');
        const durEl = overlay.querySelector('#vidu_dur');
        const seekEl = overlay.querySelector('#vidu_seek');
        const playbackBtn = overlay.querySelector('#vidu_playbackbtn');
        const fullBtn = overlay.querySelector('#vidu_fullbtn');
        function renderVolIcon(vol){ const muted = (vol === 0); if(muted){ return `<svg viewBox="0 0 24 24" width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 6L6 10H3v4h3l5 4V6z" fill="#fff" opacity="0.96"/><path d="M19 9l-1.4-1.4L16 9.2 17.4 10.6 19 9z" fill="#fff"/><line x1="21" y1="3" x2="3" y2="21" stroke="#ff7f7f" stroke-width="1.6" stroke-linecap="round"/></svg>`; } else { return `<svg viewBox="0 0 24 24" width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 6L6 10H3v4h3l5 4V6z" fill="#fff" opacity="0.96"/><path d="M16.5 7.5c.9.9 1.5 2.1 1.5 3.5s-.6 2.6-1.5 3.5" stroke="#bfffbf" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>`; } }
        function showVolumeOverlay(volume){ try{ if(!volWrap) return; const pct = Math.max(0, Math.min(100, Math.round(Number(volume)||0))); const pctEl = volWrap.querySelector('#vidu_vol_pct'); const iconEl = volWrap.querySelector('#vidu_vol_icon'); if(pctEl) pctEl.textContent = pct + '%'; if(iconEl) iconEl.innerHTML = renderVolIcon(pct); volWrap.classList.add('visible'); volWrap.setAttribute('aria-hidden','false'); if(state.volumeHideTimer) { clearTimeout(state.volumeHideTimer); state.volumeHideTimer = null; } state.volumeHideTimer = setTimeout(()=>{ try{ volWrap.classList.remove('visible'); volWrap.setAttribute('aria-hidden','true'); state.volumeHideTimer = null; }catch(e){} }, 3000); }catch(e){ console.warn('showVolumeOverlay err', e); } }
        function toggleFullscreen(){ const fs = document.fullscreenElement || document.webkitFullscreenElement; if(fs){ document.exitFullscreen ? document.exitFullscreen() : document.webkitExitFullscreen && document.webkitExitFullscreen(); } else { host.requestFullscreen ? host.requestFullscreen() : host.webkitRequestFullscreen && host.webkitRequestFullscreen(); } }
        fullBtn.addEventListener('click', toggleFullscreen);
        let playbackMenu = null; let menuOpen = false;
        function closePlaybackMenu(){ if(!playbackMenu) return; try{ playbackMenu.remove(); }catch(e){} playbackMenu = null; menuOpen = false; document.removeEventListener('click', docClickCloseHandler); }
        function docClickCloseHandler(e){ if(!playbackMenu) return; if(playbackMenu.contains(e.target) || playbackBtn.contains(e.target)) return; closePlaybackMenu(); }
        function formatRateLabel(r){ return (Math.round(r*100)/100) + '×'; }
        function openPlaybackMenu(){ if(menuOpen){ closePlaybackMenu(); return; } playbackMenu = document.createElement('div'); playbackMenu.className = 'vidu-playback-menu'; let rates = [0.25,0.5,0.75,1,1.25,1.5,1.75,2]; try{ if(state.player && typeof state.player.getAvailablePlaybackRates === 'function'){ const avail = state.player.getAvailablePlaybackRates() || []; if(Array.isArray(avail) && avail.length) rates = avail; } }catch(e){} const curRate = (state.player && typeof state.player.getPlaybackRate === 'function') ? (state.player.getPlaybackRate()||1) : 1; rates.forEach(r=>{ const btn = document.createElement('button'); btn.type = 'button'; btn.className = 'vidu-playback-item' + (Math.abs(r - curRate) < 0.0001 ? ' active' : ''); btn.textContent = formatRateLabel(r); btn.addEventListener('click', (ev)=>{ ev.stopPropagation(); try{ if(state.player && typeof state.player.setPlaybackRate === 'function') state.player.setPlaybackRate(Number(r)); closePlaybackMenu(); }catch(e){} }); playbackMenu.appendChild(btn); }); host.appendChild(playbackMenu); const btnRect = playbackBtn.getBoundingClientRect(); const hostRect = host.getBoundingClientRect(); playbackMenu.style.left = Math.max(8, (btnRect.left - hostRect.left) + (btnRect.width/2) - (playbackMenu.offsetWidth/2)) + 'px'; playbackMenu.style.bottom = (hostRect.height - (btnRect.top - hostRect.top) + 8) + 'px'; menuOpen = true; setTimeout(()=> document.addEventListener('click', docClickCloseHandler)); }
        playbackBtn.addEventListener('click', (e)=>{ e.stopPropagation(); openPlaybackMenu(); });
        function setOverlayHidden(hidden){ if(hidden){ overlay.classList.add('hidden'); ctrlBg.classList.add('hidden'); closeBtn.classList.add('hidden'); } else { overlay.classList.remove('hidden'); ctrlBg.classList.remove('hidden'); closeBtn.classList.remove('hidden'); } }
        
        state.keyHandler = function(e){
            const modal = document.getElementById('viewer');
            if(!modal || modal.classList.contains('hidden')) return;

            if (e.key === 'ArrowUp' || e.key === 'ArrowDown'){ 
                try{ 
                    if(!state.player) return; 
                    e.preventDefault(); 
                    let curVol = (typeof state.player.getVolume === 'function') ? state.player.getVolume() : (state.lastVolume || 100); 
                    const delta = e.key === 'ArrowUp' ? 5 : -5; 
                    let target = Math.max(0, Math.min(100, Math.round(curVol + delta))); 
                    state.player.setVolume(target); 
                    state.lastVolume = target; 
                    globalLastVolume = target; 
                    showVolumeOverlay(target); 
                } catch(err){} 
                return;
            }

            const activeEl = document.activeElement;
            if (activeEl && (activeEl.tagName === 'INPUT' && activeEl.type !== 'range') || activeEl.isContentEditable) return;

            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                e.preventDefault();
                try {
                    if (!state.player || typeof state.player.getCurrentTime !== 'function') return;
                    const currentTime = state.player.getCurrentTime();
                    const newTime = e.key === 'ArrowLeft' ? currentTime - 10 : currentTime + 10;
                    state.player.seekTo(newTime, true);
                } catch (err) {}
            } else if (e.code === 'Space' || e.key === ' ') {
                e.preventDefault();
                const st = state.player.getPlayerState ? state.player.getPlayerState() : -1;
                if(st === 1) state.player.pauseVideo(); else state.player.playVideo();
            } else if (e.code === 'KeyF' || e.key === 'f' || e.key === 'F') {
                e.preventDefault();
                toggleFullscreen();
            }
        };
        document.addEventListener('keydown', state.keyHandler);

        seekEl.addEventListener('pointerdown', ()=> seekEl._drag=true, {passive:true});
        seekEl.addEventListener('pointerup', ()=>{ 
            seekEl._drag=false; 
            if(!state.player) return; 
            const dur = state.player.getDuration ? state.player.getDuration() : 0; 
            if(dur) state.player.seekTo(dur * (parseFloat(seekEl.value)/100), true);
            seekEl.blur();
        }, {passive:true});
        seekEl.addEventListener('input', ()=>{ if(seekEl._drag && state.player){ const dur = state.player.getDuration ? state.player.getDuration() : 0; if(dur) curEl.textContent = fmtTime(Math.floor(dur * (parseFloat(seekEl.value)/100))); updateSeekBackground(seekEl); } }, {passive:true});
        function updateSeekBackground(el){ try{ const v = Math.max(0, Math.min(100, parseFloat(el.value) || 0)); el.style.background = `linear-gradient(90deg, var(--accent-primary) ${v}%, rgba(255,255,255,0.2) ${v}%)`; }catch(e){} } updateSeekBackground(seekEl);
        playBtn.addEventListener('click', ()=> { if(!state.player) return; let st = state.player.getPlayerState ? state.player.getPlayerState() : -1; const wantPlay = !(st === 1); state.desiredPlaying = wantPlay; playBtn.innerHTML = wantPlay ? pauseSVG() : playSVG(); if(wantPlay) state.player.playVideo(); else state.player.pauseVideo(); resetInactivityTimer(); });
        function onFSChange(){ const fs = document.fullscreenElement || document.webkitFullscreenElement; fullBtn.innerHTML = fs ? exitFullscreenSVG() : enterFullscreenSVG(); }
        state.fsListener = onFSChange; document.addEventListener('fullscreenchange', state.fsListener); document.addEventListener('webkitfullscreenchange', state.fsListener);
        function resetInactivityTimer(){ state.lastActivity = Date.now(); setOverlayHidden(false); if(state.inactivityTimer) clearTimeout(state.inactivityTimer); state.inactivityTimer = setTimeout(()=>{ const st = state.player && typeof state.player.getPlayerState === 'function' ? state.player.getPlayerState() : -1; if(st === 1) setOverlayHidden(true); }, 3000); }
        host.addEventListener('mousemove', resetInactivityTimer, {passive:true});
        return new Promise((resolve,reject)=>{
          state.player = new YT.Player(mount.id, { videoId: videoId, playerVars: { controls: 0, disablekb: 1, rel: 0, modestbranding: 1, playsinline: 1, iv_load_policy: 3, origin: location.origin }, events: {
            onReady: function(evt){
              disableIframeClicks(host);
              const v = Math.max(0, Math.min(100, globalLastVolume)); evt.target.setVolume(v); state.lastVolume = v;
              evt.target.playVideo();
              if(state.updateInterval) clearInterval(state.updateInterval);
              state.updateInterval = setInterval(()=>{
                if(!state.player) return;
                const dur = state.player.getDuration ? state.player.getDuration() : 0; const cur = state.player.getCurrentTime ? state.player.getCurrentTime() : 0;
                curEl.textContent = fmtTime(cur); durEl.textContent = fmtTime(dur);
                if(!seekEl._drag && dur) { seekEl.value = (cur / dur) * 100; updateSeekBackground(seekEl); }
                const st = state.player.getPlayerState ? state.player.getPlayerState() : -1;
                playBtn.innerHTML = (st === 1) ? pauseSVG() : playSVG();
              }, 160);
              resolve(state.player);
            },
            onStateChange: function(e){ if(e && e.data === 1){ loadingDiv.classList.add('hidden'); } },
            onError: function(err){ reject(err); }
          }});
        });
      }
      function destroyPlayer(){ try{ if(state.updateInterval) clearInterval(state.updateInterval); if(state.keyHandler) document.removeEventListener('keydown', state.keyHandler); if(state.player) state.player.destroy(); if(state.fsListener){ document.removeEventListener('fullscreenchange', state.fsListener); document.removeEventListener('webkitfullscreenchange', state.fsListener); } if(state.host) state.host.remove(); }catch(e){} }
      window.showViduPlayer = (videoId, mountRootId) => createYTPlayer(videoId, mountRootId);
      window.destroyViduPlayer = () => destroyPlayer();
    })();

    /* ---------- Playlist fetcher ---------- */
    async function fetchPlaylistVideos(playlistId){
      if(!YT_API_KEY||YT_API_KEY==='YOUR_API_KEY_HERE')throw new Error('No API key configured.');
      const results=[];let pageToken='';
      do{const url=`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${encodeURIComponent(playlistId)}&key=${encodeURIComponent(YT_API_KEY)}`+(pageToken?`&pageToken=${pageToken}`:'');const res=await fetch(url);if(!res.ok){const txt=await res.text().catch(()=>null);throw new Error('YouTube API error: '+res.status+' '+res.statusText+' '+(txt||''));}const data=await res.json();(data.items||[]).forEach(it=>{const sn=it.snippet||{};if(sn.resourceId&&sn.resourceId.videoId){const thumb=(sn.thumbnails&&(sn.thumbnails.high||sn.thumbnails.medium||sn.thumbnails.default))||{};results.push({videoId:sn.resourceId.videoId,title:sn.title||'Untitled',thumb:thumb.url||`https://img.youtube.com/vi/${sn.resourceId.videoId}/hqdefault.jpg`});}});pageToken=data.nextPageToken||'';}while(pageToken);
      return results;
    }

    /* ---------- open viewer helper ---------- */
    function openViewer(item){
      try{
        const viewer = document.getElementById('viewer');
        if(!viewer) return Promise.reject(new Error("Viewer element not found"));
        const iframeWrap = document.getElementById('iframe-wrap');
        iframeWrap.innerHTML = '';
        const np = document.getElementById('now-playing-title');
        if(np) np.textContent = item.title || 'Now playing';
        viewer.classList.remove('hidden');
        viewer.setAttribute('aria-hidden','false');
        document.body.style.overflow = 'hidden';
        document.body.classList.add('viewer-is-open');
        const mountRoot = document.createElement('div');
        mountRoot.id = 'player-wrap';
        mountRoot.style.width='100%';
        mountRoot.style.height='100%';
        iframeWrap.appendChild(mountRoot);
        return window.showViduPlayer(normalizeIdFromB64(item.idB64), 'player-wrap').catch(err=>{
          mountRoot.innerHTML = `<div style="padding:18px;color:#ffdede;">${escapeHtml(err && err.message ? err.message : String(err))}</div>`;
          return Promise.reject(err);
        });
      }catch(e){ 
        console.warn('openViewer err', e);
        return Promise.reject(e);
      }
    }

    document.getElementById('viewer-close').addEventListener('click', ()=>{
      try{
        const v = document.getElementById('viewer');
        if(v){ v.classList.add('hidden'); v.setAttribute('aria-hidden','true'); }
        if(window.destroyViduPlayer) window.destroyViduPlayer();
        const wrap = document.getElementById('iframe-wrap');
        if(wrap) wrap.innerHTML = '';
        document.body.style.overflow = '';
        document.body.classList.remove('viewer-is-open');
        if(lastOpenedPlaylistItem){
          setTimeout(()=> openPlaylistPopup(lastOpenedPlaylistItem), 120);
        }
      }catch(e){}
    });

    /* ===== Login & access UI wiring ===== */
    const loginBtnTop = document.getElementById('login-btn-top');
    const loginModal = document.getElementById('login-modal');
    const loginClose = document.getElementById('login-close');
    const loginUsernameInput = document.getElementById('login-username');
    const loginPasswordInput = document.getElementById('login-password');
    const loginSubmit = document.getElementById('login-submit');
    const loginError = document.getElementById('login-error');
    const accessModal = document.getElementById('access-modal');
    const accessClose = document.getElementById('access-close');
    const accessRequestBtn = document.getElementById('access-request-btn');
    const noAccessModal = document.getElementById('no-access-modal');
    const noAccessClose = document.getElementById('no-access-close');
    const noAccessRequestBtn = document.getElementById('no-access-request-btn');
    const requestAccessLink = 'https://wa.me/254703255099';

    function handleLogin() {
        const username = loginUsernameInput.value.trim();
        const password = loginPasswordInput.value.trim();
        loginError.textContent = '';
        const userAccount = userPermissions[username];
        if (userAccount && userAccount.password === password) {
            currentUser = { username: username, permissions: userAccount.access || [] };
            alert('✅ Logged in successfully! [VIDU]');
            closeModal(loginModal);
            loginBtnTop.textContent = `✅ Logged In as ${username}`;
            loginBtnTop.disabled = true;
        } else {
            loginError.textContent = 'Invalid username or password.';
        }
    }

    loginBtnTop.addEventListener('click', () => {
        loginError.textContent = '';
        loginUsernameInput.value = '';
        loginPasswordInput.value = '';
        showModal(loginModal);
        setTimeout(() => loginUsernameInput.focus(), 120);
    });
    loginClose.addEventListener('click', () => closeModal(loginModal));
    loginModal.addEventListener('click', (e) => { if (e.target === loginModal) closeModal(loginModal); });
    loginSubmit.addEventListener('click', handleLogin);
    loginPasswordInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') handleLogin(); });
    accessClose.addEventListener('click', () => closeModal(accessModal));
    accessModal.addEventListener('click', (e) => { if (e.target === accessModal) closeModal(accessModal); });
    accessRequestBtn.addEventListener('click', () => window.open(requestAccessLink, '_blank'));
    noAccessClose.addEventListener('click', () => closeModal(noAccessModal));
    noAccessModal.addEventListener('click', (e) => { if (e.target === noAccessModal) closeModal(noAccessModal); });
    noAccessRequestBtn.addEventListener('click', () => window.open(requestAccessLink, '_blank'));

    // Initial render
    buildTiles();

  })();
  </script>
</body>
</html>
