<!DOCTYPE HTML>
<html>
<head>
  <title>VIDU</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <!-- IMPORTANT: this page is self-styled. No site-wide main.css is loaded here. -->
  <style>
  /* Strongly scoped page CSS. Scoped under body.videos-page to avoid affecting other pages. */
  body.videos-page {
    background: url('assets/images/background.gif') no-repeat center center fixed !important;
    background-size: cover !important;
    font-family: "Helvetica Neue", Arial, sans-serif !important;
    margin:0 !important;
    color: #fff !important;
  }

  /* Header */
  body.videos-page header#header {
    display:flex !important;
    align-items:center !important;
    justify-content:space-between !important;
    padding:12px 18px !important;
    background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)) !important;
    backdrop-filter: blur(6px) saturate(120%) !important;
    border-bottom:1px solid rgba(255,255,255,0.03) !important;
    box-shadow: 0 8px 40px rgba(2,4,12,0.6) !important;
    z-index: 40 !important;
  }
  body.videos-page header#header .logo { display:flex; align-items:center; gap:10px; text-decoration:none; color:#fff; user-select:none; position:relative; z-index:50; }
  body.videos-page header#header .logo img { height:78px; width:auto; border-radius:0; box-shadow: 0 10px 30px rgba(0,0,0,0.6); display:block; }

  body.videos-page nav ul { list-style:none; display:flex; gap:12px; margin:0; padding:0; align-items:center; }
  body.videos-page nav ul li a {
    color:#fff !important;
    text-decoration:none !important;
    padding:8px 12px !important;
    border-radius:8px !important;
    font-weight:700 !important;
    font-size:14px !important;
    display:inline-block !important;
    position:relative !important;
    transition: transform .18s ease, color .18s ease !important;
  }
  body.videos-page nav ul li a:hover { transform: translateY(-3px); color:#fff; }

  /* Content wrapper */
  body.videos-page .inner { max-width:1080px; margin: 0 auto; padding: 32px; color:#fff; position:relative; z-index:30; }
  body.videos-page h2 { margin-top:0; font-weight:800; font-size:28px; text-shadow:0 2px 6px rgba(0,0,0,0.6); }

  /* Video cards */
  body.videos-page .list-container { list-style: none; padding: 0; display: flex; flex-wrap: wrap; gap: 1rem; align-items:flex-start; }
  body.videos-page .list-item {
    width: 220px !important;
    cursor: pointer !important;
    text-align: center !important;
    background: rgba(0,0,0,0.45) !important;
    border-radius:8px !important;
    padding:8px !important;
    transition:transform .12s, box-shadow .12s !important;
    position:relative !important;
    overflow:visible !important;
    box-shadow: 0 6px 22px rgba(0,0,0,0.45);
  }
  body.videos-page .list-item:hover { transform: translateY(-6px) !important; box-shadow: 0 14px 40px rgba(0,0,0,0.6) !important; }
  body.videos-page .list-item img { width: 100% !important; border-radius: 6px !important; display:block !important; }
  body.videos-page .list-item .title { display:block; margin-top: 0.6rem; color:#fff; font-weight:600; font-size:14px; text-shadow:0 1px 1px rgba(0,0,0,0.6); }

  /* Modal */
  body.videos-page .modal-backdrop { position:fixed; inset:0; background: rgba(0,0,0,0.65); display:flex; align-items:center; justify-content:center; z-index:99999; }
  body.videos-page .modal { width: min(960px, 95%); background:#0b0b0b; border-radius:10px; padding:16px; color:#fff; box-shadow: 0 20px 80px rgba(0,0,0,0.6); }
  body.videos-page .modal .controls { display:flex; gap:8px; justify-content:space-between; align-items:center; margin-bottom:8px; }
  body.videos-page .modal iframe { width:100%; height:540px; border-radius:8px; border:0; background:#000; }

  /* Buttons / inputs */
  body.videos-page .btn { background:#ff6b6b !important; color:#fff !important; padding:8px 12px !important; border-radius:6px !important; text-decoration:none !important; display:inline-block !important; border:0 !important; cursor:pointer !important; position:relative !important; z-index:1; }
  body.videos-page .btn.secondary { background:#333 !important; color:#fff !important; }
  body.videos-page .password-row { display:flex; gap:8px; margin-top:8px; }
  body.videos-page .password-row input { flex:1; padding:8px; border-radius:6px; border:1px solid #222; background:#0f0f0f; color:#fff; }

  body.videos-page .muted { color:#bbb; font-size:13px; }

  body.videos-page footer#footer { text-align:center; padding:18px; color:#ddd; margin-top:30px; z-index:5; }

  @media (max-width:720px) {
    body.videos-page .list-item { width: calc(50% - 12px) !important; }
    body.videos-page .modal iframe { height:300px !important; }
    body.videos-page header#header .logo img { height:56px !important; }
  }

  /* entrance animation - still present */
  body.videos-page .list-item { opacity:0; transform-origin:center; animation: fadeIn .45s forwards; }
  @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

  /* Playlist list inside modal adjustments */
  body.videos-page .playlist-list { display:block; max-height:260px; overflow:auto; margin-top:8px; padding:0; }
  body.videos-page .playlist-list .list-item {
    display:flex; align-items:flex-start; gap:12px; padding:10px 12px; border-radius:8px; cursor:pointer; background:transparent; color:#fff; margin-bottom:6px; transition:background .12s, transform .08s; width:100%; max-width:100%; box-sizing:border-box; overflow:visible; opacity:1; animation:none;
  }
  body.videos-page .playlist-list .list-item img { width:120px; height:68px; object-fit:cover; border-radius:6px; flex: 0 0 120px; }
  body.videos-page .playlist-list .title-wrap { flex:1; min-width:0; display:flex; align-items:flex-start; }
  body.videos-page .playlist-list .playlist-title { font-size:14px; font-weight:600; color:#fff; line-height:1.25; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; text-overflow:ellipsis; }

  /* small visual nicety */
  body.videos-page #playlist-list-wrap .muted { margin-bottom:6px; display:block; }

  /* ensure particles canvas sits above background but below content */
  #fx-canvas { z-index:2 !important; pointer-events:none !important; }

  /* small reset for html5up main.js classes that might be loaded */
  .wrapper.style2 { background:transparent !important; box-shadow:none !important; }
  </style>
</head>
<body class="landing is-preload videos-page">

  <div id="wrapper">
    <!-- Header -->
    <header id="header">
      <a href="index.html" class="logo" aria-label="VIDU home">
        <img src="https://i.pinimg.com/736x/4d/fa/7b/4dfa7b57656b556f257b4a2e4f8fc8fa.jpg" alt="VIDU Logo" />
      </a>

      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="videos.html">Private</a></li>
          <li><a href="about.html">About</a></li>
        </ul>
      </nav>

      <!-- Auth area -->
      <div id="auth-area">
        <button id="signin-fallback" class="btn">Sign in with Google</button>
      </div>
    </header>

    <!-- Videos Section -->
    <section id="videos" class="wrapper style2 fade-up">
      <div class="inner">
        <h2>Private Classes</h2>
        <p class="muted">To access Enter the password or sign in with a Google account that has admin access</p>
        <ul id="global-video-list" class="list-container"></ul>
      </div>
    </section>

    <!-- Footer -->
    <footer id="footer">
      <p>&copy; VIDU. All rights reserved.</p>
    </footer>
  </div>

  <!-- Modal root -->
  <div id="modal-root" style="display:none;"></div>

  <!-- Serve hint -->
  <div id="serve-hint" style="display:none; position:fixed; left:50%; top:10%; transform:translateX(-50%); background:rgba(6,6,8,0.95); color:#fff; padding:14px; border-radius:10px; z-index:99999; max-width:720px; box-shadow:0 30px 80px rgba(0,0,0,0.6);">
    <div style="font-weight:700; margin-bottom:8px;">Google sign-in won't run from <code>file://</code></div>
    <div class="muted" style="margin-bottom:8px;">Open the site via <code>http://localhost:8000</code> — quick commands:</div>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      <div style="flex:1; min-width:180px;"><div style="font-weight:700">Python</div><code>python -m http.server 8000</code></div>
      <div style="flex:1; min-width:180px;"><div style="font-weight:700">Node</div><code>npx http-server -p 8000</code></div>
    </div>
    <div style="text-align:right; margin-top:10px;"><button id="serve-close" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);">Close</button></div>
  </div>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- =========================
       Player + Page JS (updated)
       - Player code (YT loader, showViduPlayer, destroyViduPlayer)
       - Page-level code (keeps your original behavior, but showPlayerForVideo now uses the player)
       ========================= -->
  <script>
  /*************************************************************************
   * Player module (same robust player used on index.html) - exposes:
   *   window.loadYTApi() -> Promise
   *   window.showViduPlayer(videoId) -> Promise (mounts player into #player-wrap)
   *   window.destroyViduPlayer()
   *
   * This is the same code I used on your index page (loader + controls + volume
   * + auto-quality/default + inactivity hide + HH : MM : SS) — copied here so
   * videos.html can use the exact same player.
   *************************************************************************/
  (function(){
    if(window.__viduPlayerLoaded) return;
    window.__viduPlayerLoaded = true;

    const state = {
      player: null,
      updateInterval: null,
      keyHandler: null,
      mo: null,
      host: null,
      mount: null,
      fsResizeHandler: null,
      fsListener: null,
      inactivityTimer: null,
      lastActivity: Date.now(),
      desiredPlaying: null,
      lastVolume: 100
    };

    function pad2(n){ n = Math.max(0, Math.floor(n||0)); return (n < 10 ? '0' + n : String(n)); }
    function fmtTime(s){ s = Math.max(0, Math.floor(s||0)); const h = Math.floor(s/3600); const m = Math.floor((s%3600)/60); const sec = s%60; return pad2(h) + ' : ' + pad2(m) + ' : ' + pad2(sec); }
    function playSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 4.5v15l12-7.5L6 4.5z" fill="#fff"/></svg>`; }
    function pauseSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="5" y="4" width="4" height="16" rx="1.2" fill="#fff"/><rect x="15" y="4" width="4" height="16" rx="1.2" fill="#fff"/></svg>`; }

    function loadYTApi(){
      if(window.YT && window.YT.Player) return Promise.resolve();
      if(window._vidu_loading_yt){
        return new Promise((res, rej)=>{
          const t = setInterval(()=>{ if(window.YT && window.YT.Player){ clearInterval(t); res(); } },80);
          setTimeout(()=>{ clearInterval(t); rej(new Error('YT API load timeout')); },20000);
        });
      }
      window._vidu_loading_yt = true;
      return new Promise((resolve,reject)=>{
        const s=document.createElement('script');
        s.src='https://www.youtube.com/iframe_api';
        s.async=true;
        s.onerror = ()=> reject(new Error('YT API failed to load'));
        document.head.appendChild(s);
        window.onYouTubeIframeAPIReady = function(){ resolve(); };
        setTimeout(()=>{ if(window.YT && window.YT.Player) resolve(); },1200);
        setTimeout(()=>{ if(!(window.YT && window.YT.Player)) reject(new Error('YT API timed out')); },20000);
      });
    }
    try{ window.loadYTApi = loadYTApi; }catch(e){}

    function createHostElements(){
      const wrap = document.getElementById('player-wrap');
      if(!wrap) throw new Error('#player-wrap not found');

      const prev = wrap.querySelector('.vidu-player-host');
      if(prev) prev.remove();

      const host = document.createElement('div'); host.className = 'vidu-player-host';
      const mount = document.createElement('div'); mount.className = 'vidu-mount'; mount.id = 'vidu_mount_'+Math.floor(Math.random()*1e6);
      mount.style.height = '520px';
      mount.style.background = '#000';
      host.appendChild(mount);

      const ctrlBg = document.createElement('div'); ctrlBg.className = 'vidu-controls-bg';
      host.appendChild(ctrlBg);

      const overlay = document.createElement('div'); overlay.className = 'vidu-overlay';
      overlay.innerHTML = `
        <div class="inner-bg" aria-hidden="true"></div>
        <button class="vidu-btn" id="vidu_playbtn">${playSVG()}</button>
        <div class="vidu-time" id="vidu_cur">` + fmtTime(0) + `</div>
        <input id="vidu_seek" class="vidu-range" type="range" min="0" max="100" step="0.1" value="0" />
        <div class="vidu-time" id="vidu_dur">` + fmtTime(0) + `</div>
        <input id="vidu_vol" class="vidu-volume" type="range" min="0" max="100" step="1" value="100" aria-label="Volume" />
        <button class="vidu-btn" id="vidu_fullbtn">⤢</button>
      `;
      host.appendChild(overlay);

      const closeBtn = document.createElement('button');
      closeBtn.className = 'vidu-close-btn';
      closeBtn.id = 'vidu_closebtn';
      closeBtn.title = 'Close';
      closeBtn.type = 'button';
      closeBtn.innerHTML = '✕';
      closeBtn.addEventListener('click', ()=> {
        try{
          // close modal and destroy player
          const root = document.getElementById('modal-root'); if(root) root.style.display='none';
          if(window.destroyViduPlayer) window.destroyViduPlayer();
        }catch(e){ console.warn('closeBtn error', e); }
      });
      host.appendChild(closeBtn);

      wrap.appendChild(host);
      return { host, mount, overlay, ctrlBg, closeBtn };
    }

    function disableIframeClicks(host){
      try{
        const ifr = host.querySelector('iframe');
        if(ifr){
          ifr.style.pointerEvents = 'none';
          ifr.setAttribute('allow','autoplay; encrypted-media; fullscreen');
          ifr.setAttribute('allowfullscreen','');
          ifr.setAttribute('tabindex','-1');
        }
      }catch(e){ console.warn('disableIframeClicks', e); }
    }

    function createPlayer(videoId){
      const { host, mount, overlay, ctrlBg, closeBtn } = createHostElements();
      state.host = host; state.mount = mount;

      const playBtn = overlay.querySelector('#vidu_playbtn');
      const curEl = overlay.querySelector('#vidu_cur');
      const durEl = overlay.querySelector('#vidu_dur');
      const seekEl = overlay.querySelector('#vidu_seek');
      const fullBtn = overlay.querySelector('#vidu_fullbtn');
      const volEl = overlay.querySelector('#vidu_vol');

      try{ if(curEl) curEl.textContent = fmtTime(0); }catch(e){}
      try{ if(durEl) durEl.textContent = fmtTime(0); }catch(e){}

      function getFullscreenElement(){
        return document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement || null;
      }

      const saved = { stored:false, host:{}, mount:{}, iframe:{}, modal:{}, backdrop:{}, playerWrap:{} };

      function toggleFullscreen(){
        const fs = getFullscreenElement();
        if(fs === host){
          const exit = document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen;
          if(exit) exit.call(document);
        } else {
          const req = host.requestFullscreen || host.webkitRequestFullscreen || host.mozRequestFullScreen || host.msRequestFullscreen;
          if(req) req.call(host);
        }
      }

      fullBtn.addEventListener('click', toggleFullscreen);

      function setOverlayHidden(hidden){
        if(hidden){
          overlay.classList.add('hidden');
          ctrlBg.classList.add('hidden');
          if(closeBtn) closeBtn.classList.add('hidden');
        } else {
          overlay.classList.remove('hidden');
          ctrlBg.classList.remove('hidden');
          if(closeBtn) closeBtn.classList.remove('hidden');
        }
      }

      state.keyHandler = function(e){
        const active = document.activeElement;
        if(active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA' || active.isContentEditable)) return;
        const modal = document.getElementById('modal-root');
        if(!modal || modal.style.display === 'none') return;
        if(e.code === 'Space' || e.key === ' '){
          e.preventDefault();
          if(state.player){
            const st = state.player.getPlayerState ? state.player.getPlayerState() : -1;
            if(st === 1) {
              try{ state.player.pauseVideo(); }catch(e){}
            } else {
              try{ state.player.playVideo(); }catch(e){}
            }
          }
        } else if(e.code === 'KeyF' || e.key === 'f' || e.key === 'F'){
          e.preventDefault();
          toggleFullscreen();
        }
      };
      document.addEventListener('keydown', state.keyHandler);

      // seek handling
      seekEl.addEventListener('pointerdown', ()=> seekEl._drag=true, {passive:true});
      seekEl.addEventListener('pointerup', ()=>{ 
        seekEl._drag=false;
        if(!state.player) return;
        const dur = state.player.getDuration ? state.player.getDuration() : 0;
        if(dur) state.player.seekTo(dur * (parseFloat(seekEl.value)/100), true);
      }, {passive:true});
      seekEl.addEventListener('input', ()=>{ 
        if(seekEl._drag && state.player){
          const dur = state.player.getDuration ? state.player.getDuration() : 0;
          if(dur) curEl.textContent = fmtTime(Math.floor(dur * (parseFloat(seekEl.value)/100)));
          updateSeekBackground(seekEl);
        }
      }, {passive:true});

      function updateSeekBackground(el){
        try{
          const v = Math.max(0, Math.min(100, parseFloat(el.value) || 0));
          el.style.background = `linear-gradient(90deg, var(--accent-2) ${v}%, rgba(255,255,255,0.06) ${v}%)`;
        }catch(e){}
      }
      updateSeekBackground(seekEl);

      // play/pause with immediate UI response
      playBtn.addEventListener('click', ()=>{
        if(!state.player) return;
        let st = -1;
        try{ st = state.player.getPlayerState ? state.player.getPlayerState() : -1; }catch(e){}
        const wantPlay = !(st === 1);
        state.desiredPlaying = wantPlay;
        playBtn.innerHTML = wantPlay ? pauseSVG() : playSVG();
        try{
          if(wantPlay){
            if(typeof state.player.playVideo === 'function') state.player.playVideo();
          } else {
            if(typeof state.player.pauseVideo === 'function') state.player.pauseVideo();
          }
        }catch(e){ console.warn('play/pause toggle err', e); }
        resetInactivityTimer();
      });

      // volume
      volEl.addEventListener('input', ()=> {
        const v = Math.max(0, Math.min(100, parseInt(volEl.value,10) || 0));
        state.lastVolume = v;
        try{
          if(state.player && typeof state.player.setVolume === 'function'){
            state.player.setVolume(v);
            if(v === 0 && typeof state.player.mute === 'function') state.player.mute();
            else if(v > 0 && typeof state.player.unMute === 'function') state.player.unMute();
          }
        }catch(e){ console.warn('setVolume err', e); }
        try{ volEl.style.background = `linear-gradient(90deg, var(--accent-2) ${v}%, rgba(255,255,255,0.06) ${v}%)`; }catch(e){}
        resetInactivityTimer();
      }, {passive:true});

      (function initVolBg(){
        try{
          const v = Math.max(0, Math.min(100, parseInt(volEl.value,10) || state.lastVolume || 100));
          volEl.style.background = `linear-gradient(90deg, var(--accent-2) ${v}%, rgba(255,255,255,0.06) ${v}%)`;
        }catch(e){}
      })();

      function onFSChange(){
        const fs = getFullscreenElement();
        const isOurFullscreen = !!(fs && (fs === host || host.contains(fs) || (fs.contains && fs.contains(host))));
        if(isOurFullscreen){
          if(!saved.stored){
            saved.host.position = host.style.position || '';
            saved.host.top = host.style.top || '';
            saved.host.left = host.style.left || '';
            saved.host.width = host.style.width || '';
            saved.host.height = host.style.height || '';
            saved.host.zIndex = host.style.zIndex || '';
            saved.host.borderRadius = host.style.borderRadius || '';

            saved.mount.height = mount.style.height || '';
            saved.mount.width = mount.style.width || '';
            saved.mount.maxHeight = mount.style.maxHeight || '';
            saved.mount.maxWidth = mount.style.maxWidth || '';

            const ifr = host.querySelector('iframe');
            if(ifr){
              saved.iframe.height = ifr.style.height || '';
              saved.iframe.width = ifr.style.width || '';
              saved.iframe.pointerEvents = ifr.style.pointerEvents || '';
              saved.iframe.maxHeight = ifr.style.maxHeight || '';
              saved.iframe.maxWidth = ifr.style.maxWidth || '';
            } else saved.iframe = {};

            const modalEl = host.closest('.modal');
            if(modalEl){
              saved.modal.display = modalEl.style.display || '';
              saved.modal.width = modalEl.style.width || '';
              saved.modal.maxWidth = modalEl.style.maxWidth || '';
              saved.modal.position = modalEl.style.position || '';
              saved.modal.zIndex = modalEl.style.zIndex || '';
            } else saved.modal = {};

            const backdrop = document.getElementById('modal-backdrop');
            if(backdrop){
              saved.backdrop.display = backdrop.style.display || '';
              saved.backdrop.zIndex = backdrop.style.zIndex || '';
            } else saved.backdrop = {};

            const playerWrap = document.getElementById('player-wrap');
            if(playerWrap){
              saved.playerWrap.display = playerWrap.style.display || '';
              saved.playerWrap.position = playerWrap.style.position || '';
              saved.playerWrap.zIndex = playerWrap.style.zIndex || '';
            } else saved.playerWrap = {};

            saved.stored = true;
          }

          try{
            host.style.position = 'fixed';
            host.style.top = '0';
            host.style.left = '0';
            host.style.width = '100vw';
            host.style.height = '100vh';
            host.style.zIndex = '2147483647';
            host.style.borderRadius = '0';
          }catch(e){}

          try{
            mount.style.width = '100%';
            mount.style.height = '100%';
            mount.style.maxHeight = 'none';
            mount.style.maxWidth = 'none';
          }catch(e){}

          try{
            const ifr = host.querySelector('iframe');
            if(ifr){
              ifr.style.width = '100%';
              ifr.style.height = '100%';
              ifr.style.maxHeight = 'none';
              ifr.style.maxWidth = 'none';
              ifr.style.pointerEvents = 'auto';
            }
          }catch(e){}

          ctrlBg.classList.remove('hidden');
          overlay.classList.remove('hidden');
          if(closeBtn) closeBtn.classList.remove('hidden');

          if(!state.fsResizeHandler){
            state.fsResizeHandler = ()=> {
              const curFS = getFullscreenElement();
              const stillOurFS = !!(curFS && (curFS === host || host.contains(curFS) || (curFS.contains && curFS.contains(host))));
              if(stillOurFS){
                try{ host.style.width = window.innerWidth + 'px'; host.style.height = window.innerHeight + 'px'; }catch(e){}
                try{ mount.style.height = window.innerHeight + 'px'; }catch(e){}
                try{
                  const ifr = host.querySelector('iframe');
                  if(ifr) ifr.style.height = window.innerHeight + 'px';
                }catch(e){}
              }
            };
            window.addEventListener('resize', state.fsResizeHandler);
          }

        } else {
          if(saved.stored){
            try{
              host.style.position = saved.host.position;
              host.style.top = saved.host.top;
              host.style.left = saved.host.left;
              host.style.width = saved.host.width;
              host.style.height = saved.host.height;
              host.style.zIndex = saved.host.zIndex;
              host.style.borderRadius = saved.host.borderRadius;
            }catch(e){}

            try{
              mount.style.height = saved.mount.height;
              mount.style.width = saved.mount.width;
              mount.style.maxHeight = saved.mount.maxHeight;
              mount.style.maxWidth = saved.mount.maxWidth;
            }catch(e){}

            try{
              const ifr = host.querySelector('iframe');
              if(ifr){
                ifr.style.height = saved.iframe.height;
                ifr.style.width = saved.iframe.width;
                ifr.style.pointerEvents = saved.iframe.pointerEvents;
                ifr.style.maxHeight = saved.iframe.maxHeight;
                ifr.style.maxWidth = saved.iframe.maxWidth;
              }
            }catch(e){}

            try{
              const modalEl = host.closest('.modal');
              if(modalEl){
                modalEl.style.display = saved.modal.display;
                modalEl.style.width = saved.modal.width;
                modalEl.style.maxWidth = saved.modal.maxWidth;
                modalEl.style.position = saved.modal.position;
                modalEl.style.zIndex = saved.modal.zIndex;
              }
            }catch(e){}

            try{
              const backdrop = document.getElementById('modal-backdrop');
              if(backdrop){
                backdrop.style.display = saved.backdrop.display;
                backdrop.style.zIndex = saved.backdrop.zIndex;
              }
            }catch(e){}

            try{
              const playerWrap = document.getElementById('player-wrap');
              if(playerWrap){
                playerWrap.style.display = saved.playerWrap.display;
                playerWrap.style.position = saved.playerWrap.position;
                playerWrap.style.zIndex = saved.playerWrap.zIndex;
              }
            }catch(e){}

            saved.stored = false;
          } else {
            try{ mount.style.height = '520px'; mount.style.width = '100%'; }catch(e){}
            try{
              const ifr = host.querySelector('iframe');
              if(ifr) ifr.style.pointerEvents = 'none';
            }catch(e){}
          }

          if(state.fsResizeHandler){
            window.removeEventListener('resize', state.fsResizeHandler);
            state.fsResizeHandler = null;
          }

          if(overlay.classList.contains('hidden')){
            ctrlBg.classList.add('hidden');
            if(closeBtn) closeBtn.classList.add('hidden');
          } else {
            ctrlBg.classList.remove('hidden');
            if(closeBtn) closeBtn.classList.remove('hidden');
          }
        }
      }

      state.fsListener = onFSChange;
      document.addEventListener('fullscreenchange', state.fsListener);
      document.addEventListener('webkitfullscreenchange', state.fsListener);
      document.addEventListener('mozfullscreenchange', state.fsListener);
      document.addEventListener('MSFullscreenChange', state.fsListener);

      function resetInactivityTimer(){
        state.lastActivity = Date.now();
        setOverlayHidden(false);
        if(state.inactivityTimer) { clearTimeout(state.inactivityTimer); state.inactivityTimer = null; }
        state.inactivityTimer = setTimeout(()=>{
          try{
            const st = state.player && typeof state.player.getPlayerState === 'function' ? state.player.getPlayerState() : -1;
            if(st === 1 || st === 3 || st === -1 || st === 0 || st === 5){
              setOverlayHidden(true);
            }
          }catch(e){}
        }, 5000);
      }

      function attachActivityListeners(){
        try{
          ['mousemove','pointermove','touchstart','touchmove','keydown','mousedown'].forEach(ev=>{
            host.addEventListener(ev, resetInactivityTimer, {passive:true});
            document.addEventListener(ev, resetInactivityTimer, {passive:true});
          });
        }catch(e){}
      }
      function detachActivityListeners(){
        try{
          ['mousemove','pointermove','touchstart','touchmove','keydown','mousedown'].forEach(ev=>{
            host.removeEventListener(ev, resetInactivityTimer);
            document.removeEventListener(ev, resetInactivityTimer);
          });
        }catch(e){}
      }
      attachActivityListeners();

      // load YT and mount player
      return loadYTApi().then(()=> new Promise((resolve,reject)=>{
        if(state.player && typeof state.player.destroy === 'function'){ try{ state.player.destroy(); }catch(e){} state.player = null; }

        try{
          state.player = new YT.Player(mount.id, {
            videoId: videoId,
            width: '100%',
            height: '100%',
            playerVars: {
              controls: 0,
              disablekb: 1,
              rel: 0,
              modestbranding: 1,
              playsinline: 1,
              iv_load_policy: 3,
              origin: location.origin
            },
            events: {
              onReady: function(evt){
                disableIframeClicks(host);

                try{
                  if(typeof evt.target.setVolume === 'function'){
                    const v = Math.max(0, Math.min(100, state.lastVolume || 100));
                    evt.target.setVolume(v);
                    if(v === 0 && typeof evt.target.mute === 'function') evt.target.mute();
                    else if(v > 0 && typeof evt.target.unMute === 'function') evt.target.unMute();
                    const volEl = document.getElementById('vidu_vol');
                    if(volEl) { volEl.value = v; volEl.style.background = `linear-gradient(90deg, var(--accent-2) ${v}%, rgba(255,255,255,0.06) ${v}%)`; }
                  }
                }catch(e){}

                try{
                  if(typeof evt.target.setPlaybackQuality === 'function'){
                    evt.target.setPlaybackQuality('default');
                    setTimeout(()=> { try{ evt.target.setPlaybackQuality('default'); }catch(e){} }, 800);
                    setTimeout(()=> { try{ evt.target.setPlaybackQuality('default'); }catch(e){} }, 2200);
                  }
                }catch(e){}

                try{ evt.target.playVideo(); }catch(e){}

                mount.style.height = mount.style.height || '520px';

                if(state.updateInterval) clearInterval(state.updateInterval);
                state.updateInterval = setInterval(()=>{
                  try{
                    if(!state.player) return;
                    const dur = state.player.getDuration ? state.player.getDuration() : 0;
                    const cur = state.player.getCurrentTime ? state.player.getCurrentTime() : 0;
                    const curElLocal = document.getElementById('vidu_cur');
                    const durElLocal = document.getElementById('vidu_dur');
                    if(curElLocal) curElLocal.textContent = fmtTime(Math.floor(cur));
                    if(durElLocal) durElLocal.textContent = (dur && isFinite(dur)) ? fmtTime(Math.floor(dur)) : fmtTime(0);
                    if(!seekEl._drag && dur && isFinite(dur)) {
                      seekEl.value = (cur / Math.max(1,dur)) * 100;
                      updateSeekBackground(seekEl);
                    }
                    const st = state.player.getPlayerState ? state.player.getPlayerState() : -1;
                    if(state.desiredPlaying !== null){
                      if(state.desiredPlaying && st !== 1){
                        try{ state.player.playVideo(); }catch(e){}
                      } else if(!state.desiredPlaying && st === 1){
                        try{ state.player.pauseVideo(); }catch(e){}
                      }
                    }
                    const currentIcon = (st === 1) ? pauseSVG() : playSVG();
                    if(Date.now() - state.lastActivity > 300) {
                      playBtn.innerHTML = currentIcon;
                    } else {
                      setTimeout(()=> {
                        try{
                          const check = state.player.getPlayerState ? state.player.getPlayerState() : -1;
                          if(check === 1) playBtn.innerHTML = pauseSVG(); else playBtn.innerHTML = playSVG();
                        }catch(e){}
                      }, 600);
                    }
                  }catch(e){}
                }, 160);

                if(state.mo) state.mo.disconnect();
                state.mo = new MutationObserver(()=> disableIframeClicks(host));
                state.mo.observe(host, { childList:true, subtree:true });

                resetInactivityTimer();

                resolve(state.player);
              },
              onError: function(err){ console.error('YT player error', err); reject(err); }
            }
          });
        }catch(err){
          reject(err || new Error('YT player creation failed'));
        }
      })).catch(err=>{
        throw err;
      }).then(p=>{
        setTimeout(()=> resetInactivityTimer(), 40);
        return p;
      });
    }

    function destroyPlayer(){
      try{
        if(state.updateInterval){ clearInterval(state.updateInterval); state.updateInterval = null; }
        if(state.keyHandler){ document.removeEventListener('keydown', state.keyHandler); state.keyHandler = null; }
        if(state.player){ try{ state.player.destroy(); }catch(e){} state.player = null; }
        if(state.mo){ try{ state.mo.disconnect(); }catch(e){} state.mo = null; }
        if(state.fsResizeHandler){ window.removeEventListener('resize', state.fsResizeHandler); state.fsResizeHandler = null; }
        if(state.fsListener){
          document.removeEventListener('fullscreenchange', state.fsListener);
          document.removeEventListener('webkitfullscreenchange', state.fsListener);
          document.removeEventListener('mozfullscreenchange', state.fsListener);
          document.removeEventListener('MSFullscreenChange', state.fsListener);
          state.fsListener = null;
        }
        if(state.inactivityTimer){ clearTimeout(state.inactivityTimer); state.inactivityTimer = null; }
        if(state.host){
          try{
            ['mousemove','pointermove','touchstart','touchmove','keydown','mousedown'].forEach(ev=>{
              state.host.removeEventListener(ev, resetInactivityTimer);
              document.removeEventListener(ev, resetInactivityTimer);
            });
          }catch(e){}
        }
        if(state.host){ try{ state.host.remove(); }catch(e){} state.host = null; state.mount = null; }
      }catch(e){ console.warn('destroyPlayer err', e); }
    }

    window.showViduPlayer = function(videoId){
      if(typeof window.loadYTApi !== 'function') window.loadYTApi = loadYTApi;
      return createPlayer(videoId).catch(err => { console.error('createPlayer failed', err); throw err; });
    };
    window.destroyViduPlayer = function(){
      destroyPlayer();
      const w = document.getElementById('player-wrap'); if(w) w.innerHTML = '';
    };

    window.addEventListener('beforeunload', ()=> { try{ window.destroyViduPlayer(); }catch(e){} }, {passive:true});
  })();


  /*************************************************************************
   * Page code (kept your original behavior; only showPlayerForVideo &
   * playlist wiring were updated to use the new player)
   *************************************************************************/
  /* --- CONFIG - replace with your values --- */
  const OAUTH_CLIENT_ID = '342354359423-s42kqoigp8207erl9i88pmo324clf6ps.apps.googleusercontent.com';
  const YT_API_KEY = 'AIzaSyDFyNxJJ_LbTEwLZkcLZ0wT3bDNfGcHCAI';

  const globalVideos = [
    { type: 'video', title: 'TEST', thumb: 'https://i.pinimg.com/736x/e9/f1/5d/e9f15d10baf0131ab65bdc35d620adce.jpg', idB64:btoa("Lexok6H2c2s"), passB64:btoa("vidu123test")},
    { type: 'playlist', title: 'SFT - Theory + Revision', thumb: 'https://i.pinimg.com/736x/b8/de/57/b8de57f639bb30fd9f48cda542dd96d2.jpg', idB64:btoa("PL9zX0VbNmKiGt19HZ9wzIwC-VQ_AN0z9K&si=0jJc5HTa68Weq851"), passB64:btoa("vidu123sft") },
    { type: 'playlist', title: 'ICT', thumb: 'https://i.pinimg.com/736x/81/f4/0d/81f40de2906f0c61f2f17d6db61d7271.jpg', idB64:btoa("PL9zX0VbNmKiFlxda5PCTn4_hA_7iKjEaA&si=9nF_7qpAzKt4cYZd"), passB64:btoa("6002vidu") },
    { type: 'playlist', title: 'ET', thumb: 'https://i.pinimg.com/736x/19/b2/42/19b2424009813fc558e8a785c794cbdf.jpg', idB64:btoa("PL9zX0VbNmKiF-Q7bnmM1v_DrT3_Ol-Of5&si=efJHPzWR-kZcGwYw"), passB64:btoa("vidu123et")}
  ];

  let oauthToken = null;
  let profileInfo = null;
  let tokenClient = null;
  let currentItemIndex = null;
  const isFileProtocol = (location.protocol === 'file:');

  function b64decode(s) { try { return atob(s); } catch(e) { return s; } }
  function escapeHtml(s){ return (s||'').replace(/[&<>\"'`]/g, ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;","`":"&#96;"}[ch])); }

  function showServeHint(){ const el=document.getElementById('serve-hint'); if(!el) return; el.style.display='block'; document.getElementById('serve-close').onclick = ()=> el.style.display='none'; }

  function createModal() {
    const root = document.getElementById('modal-root');
    root.innerHTML = `
      <div class="modal-backdrop" id="modal-backdrop">
        <div class="modal" role="dialog" aria-modal="true">
          <div class="controls">
            <div>
              <strong id="modal-title">Locked</strong>
              <div class="muted" id="modal-subtitle"></div>
            </div>
            <div><button id="modal-close" class="btn secondary">Close</button></div>
          </div>
          <div id="modal-content">
            <div id="password-block">
              <div class="muted">This item is password-protected. Enter the password to unlock and play.</div>
              <div class="password-row" style="margin-top:10px;">
                <input id="password-input" type="password" placeholder="Enter password" />
                <button id="password-submit" class="btn">Unlock</button>
              </div>
              <div id="password-error" class="muted" style="margin-top:8px;color:#f66;display:none;"></div>
            </div>

            <div id="player-block" style="display:none; margin-top:10px;">
              <div style="display:flex; gap:8px; align-items:center; justify-content:space-between; margin-bottom:8px;">
                <div id="now-playing-label" class="muted">Now playing</div>
                <div>
                  <button id="close-player" class="btn">Close Player</button>
                </div>
              </div>

              <div id="player-wrap"></div>

              <div id="playlist-list-wrap" style="display:none; margin-top:12px;">
                <div class="muted">Playlist contents</div>
                <div class="playlist-list" id="playlist-video-list" style="max-height:260px; overflow:auto;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>`;
    document.getElementById('modal-close').onclick = closeModal;
    document.getElementById('close-player').onclick = closeModal;
    document.getElementById('password-submit').onclick = onPasswordSubmit;
    document.getElementById('password-input').onkeydown = (e)=>{ if(e.key === 'Enter') onPasswordSubmit(); };
    document.getElementById('modal-backdrop').onclick = function(e){ if(e.target === this) closeModal(); };
  }

  function openPasswordModal(idx) {
    currentItemIndex = idx;
    const item = globalVideos[idx];
    const title = item.title || 'Protected item';
    const subtitle = (item.type === 'playlist') ? 'Playlist' : 'Video';
    const root = document.getElementById('modal-root');
    root.style.display = 'block';
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-subtitle').textContent = subtitle + ' — password required';
    document.getElementById('password-input').value = '';
    document.getElementById('password-error').style.display = 'none';
    document.getElementById('password-block').style.display = 'block';
    document.getElementById('player-block').style.display = 'none';
    setTimeout(()=>document.getElementById('password-input').focus(), 50);
  }

  function closeModal() {
    const root = document.getElementById('modal-root');
    root.style.display = 'none';
    const wrap = document.getElementById('player-wrap');
    if (wrap) wrap.innerHTML = '';
    const pl = document.getElementById('playlist-video-list'); if(pl) pl.innerHTML = '';
    currentItemIndex = null;
    // ensure player is destroyed when modal closes
    if(window.destroyViduPlayer) try{ window.destroyViduPlayer(); }catch(e){}
  }

  function onPasswordSubmit() {
    const val = (document.getElementById('password-input').value || '').trim();
    const item = globalVideos[currentItemIndex];
    const expected = b64decode((item.passB64 || '').trim());
    if (val === expected) {
      document.getElementById('password-block').style.display = 'none';
      document.getElementById('password-error').style.display = 'none';
      showPlayerForItem(item);
    } else {
      const err = document.getElementById('password-error');
      err.style.display = 'block';
      err.textContent = 'Incorrect password — try again.';
    }
  }

  // showPlayerForVideo now uses the robust player if available.
  function showPlayerForVideo(videoId, title){
    const wrap = document.getElementById('player-wrap');
    const now = document.getElementById('now-playing-label');
    if(now) now.textContent = title ? `Now playing — ${title}` : 'Now playing';
    if(wrap) wrap.innerHTML = '';
    document.getElementById('player-block').style.display = 'block';
    // Use the advanced player if available
    if(window.showViduPlayer){
      window.showViduPlayer(videoId).catch(err=>{
        console.error('showViduPlayer failed', err);
        if(wrap) wrap.innerHTML = `<div class="muted">Failed to load player: ${escapeHtml(err.message||'')}</div>`;
      });
    } else {
      // fallback: plain iframe (keeps behaviour in environments where player script didn't load)
      const iframe = document.createElement('iframe');
      iframe.setAttribute('src', `https://www.youtube.com/embed/${encodeURIComponent(videoId)}?rel=0&autoplay=1`);
      iframe.setAttribute('allow', 'autoplay; encrypted-media; fullscreen');
      iframe.setAttribute('allowfullscreen', '');
      iframe.style.width = '100%';
      iframe.style.height = '520px';
      if(wrap) { wrap.innerHTML = ''; wrap.appendChild(iframe); }
    }
  }

  async function fetchPlaylistVideos(playlistId){
    const items = []; let pageToken = '';
    do{
      let url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${encodeURIComponent(playlistId)}`;
      const headers = {};
      if(oauthToken) headers['Authorization'] = 'Bearer ' + oauthToken;
      else if(YT_API_KEY && YT_API_KEY !== 'YOUR_API_KEY_HERE') url += `&key=${encodeURIComponent(YT_API_KEY)}`;
      else throw new Error('No OAuth token and no API key configured. Sign in or set an API key.');
      if(pageToken) url += `&pageToken=${pageToken}`;
      const res = await fetch(url, { headers });
      if(!res.ok){
        const txt = await res.text().catch(()=>null);
        throw new Error('YouTube API error: '+res.status+' '+res.statusText+' '+(txt||''));
      }
      const data = await res.json();
      (data.items||[]).forEach(it => {
        const sn = it.snippet || {};
        if(sn.resourceId && sn.resourceId.videoId){
          const thumb = (sn.thumbnails && (sn.thumbnails.medium||sn.thumbnails.high||sn.thumbnails.default))||{};
          items.push({ videoId: sn.resourceId.videoId, title: sn.title||'Untitled', thumb: thumb.url||`https://img.youtube.com/vi/${sn.resourceId.videoId}/hqdefault.jpg` });
        }
      });
      pageToken = data.nextPageToken || '';
    } while(pageToken);
    return items;
  }

  async function showPlaylistInsideModal(item){
    const rawId = b64decode(item.idB64), playlistId = rawId.split('&')[0];
    try{
      const videos = await fetchPlaylistVideos(playlistId);
      if(!videos.length){ document.getElementById('player-wrap').innerHTML = `<div class="muted">No videos found or playlist is private.</div>`; document.getElementById('player-block').style.display='block'; return; }

      const listWrap = document.getElementById('playlist-video-list');
      listWrap.innerHTML = '';

      videos.forEach(v=>{
        const li = document.createElement('div');
        li.className = 'list-item';
        li.setAttribute('data-video-id', v.videoId);
        const thumb = escapeHtml(v.thumb || `https://img.youtube.com/vi/${v.videoId}/hqdefault.jpg`);
        const titleHtml = `<div class="title-wrap"><div class="playlist-title">${escapeHtml(v.title)}</div></div>`;
        li.innerHTML = `<img src="${thumb}" alt="${escapeHtml(v.title)}" loading="lazy" />` + titleHtml;
        li.onclick = ()=> showPlayerForVideo(v.videoId, v.title);
        listWrap.appendChild(li);
      });

      document.getElementById('player-block').style.display='block';
      document.getElementById('playlist-list-wrap').style.display='block';
      showPlayerForVideo(videos[0].videoId, videos[0].title);
    } catch(err){
      console.error('Playlist fetch error', err);
      document.getElementById('player-wrap').innerHTML = `<div class="muted">Failed to load playlist: ${escapeHtml(err.message||'')}</div>`;
      document.getElementById('player-block').style.display='block';
    }
  }

  function showPlayerForItem(item){ if(item.type==='video'){ const id=b64decode(item.idB64); showPlayerForVideo(id, item.title||item.name); } else showPlaylistInsideModal(item); }

  function getThumb(item) {
    if (item.thumb && item.thumb.trim().length) return item.thumb;
    try {
      const id = b64decode(item.idB64);
      if (item.type === 'video') return `https://img.youtube.com/vi/${id}/hqdefault.jpg`;
      return 'https://i.imgur.com/8Km9tLL.png';
    } catch(e) { return 'https://i.imgur.com/8Km9tLL.png'; }
  }

  function renderList() {
    const ul = document.getElementById('global-video-list');
    ul.innerHTML = '';
    globalVideos.forEach((v, i) => {
      const li = document.createElement('li');
      li.className = 'list-item ripple';
      const thumb = getThumb(v);
      li.innerHTML = `
        <img src="${escapeHtml(thumb)}" alt="${escapeHtml(v.title)}" loading="lazy" />
        <span class="title">${escapeHtml(v.title)}</span>
      `;
      li.onclick = ()=> openPasswordModal(i);
      ul.appendChild(li);
    });
  }

  function initGoogleOAuth(){
    if (isFileProtocol) { return; }
    if(!OAUTH_CLIENT_ID || OAUTH_CLIENT_ID === 'YOUR_OAUTH_CLIENT_ID_HERE'){ console.warn('OAUTH_CLIENT_ID not set.'); return; }
    if(!window.google){ setTimeout(initGoogleOAuth, 300); return; }
    if(tokenClient) return;
    tokenClient = google.accounts.oauth2.initTokenClient({
      client_id: OAUTH_CLIENT_ID,
      scope: 'openid email profile https://www.googleapis.com/auth/youtube.readonly',
      callback: (resp) => {
        if(resp.error){ console.error('OAuth failed', resp); alert('Google sign-in failed: ' + (resp.error || 'unknown')); return; }
        oauthToken = resp.access_token;
        fetch('https://www.googleapis.com/oauth2/v3/userinfo', { headers: { Authorization: 'Bearer ' + oauthToken } })
          .then(r=>r.json()).then(profile => {
            profileInfo = profile;
            const auth = document.getElementById('auth-area');
            auth.classList.add('logged-in');
            auth.innerHTML = `<div class="avatar"><img src="${profile.picture||''}" alt="avatar"/></div><div style="display:flex;align-items:center;gap:8px;"><button id="signout-btn" class="btn">Sign out</button></div>`;
            document.getElementById('signout-btn').onclick = signOutGoogle;
          }).catch(err => { console.warn('userinfo fetch failed', err); });
      }
    });
  }

  function signInWithGoogle(){
    if(isFileProtocol){ showServeHint(); return; }
    if(!tokenClient){ initGoogleOAuth(); setTimeout(signInWithGoogle, 300); return; }
    tokenClient.requestAccessToken({ prompt: 'consent' });
  }

  function signOutGoogle(){
    if(oauthToken){
      const revokeUrl = 'https://oauth2.googleapis.com/revoke?token=' + encodeURIComponent(oauthToken);
      fetch(revokeUrl, { method:'POST', headers:{ 'Content-type':'application/x-www-form-urlencoded' } }).catch(()=>{}).finally(()=>{
        oauthToken = null; profileInfo = null;
        const auth = document.getElementById('auth-area');
        auth.classList.remove('logged-in');
        auth.innerHTML = `<button id="signin-fallback" class="btn">Sign in with Google</button>`;
        document.getElementById('signin-fallback').addEventListener('click', ()=> {
          if(isFileProtocol){ showServeHint(); return; }
          initGoogleOAuth(); setTimeout(signInWithGoogle, 250);
        });
      });
    } else { profileInfo = null; }
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    createModal();
    renderList();
    attachHeaderInteractions();
    if(!isFileProtocol) initGoogleOAuth();
    const cards=document.querySelectorAll('.list-item'); cards.forEach((c,i)=> c.style.animationDelay=(i*60)+'ms');

    const fb = document.getElementById('signin-fallback');
    if(fb) fb.addEventListener('click', ()=> {
      if(isFileProtocol){ showServeHint(); return; }
      initGoogleOAuth(); setTimeout(signInWithGoogle, 250);
    });
  });

  (function createParticles(){
    try {
      const canvas=document.createElement('canvas'); canvas.id='fx-canvas'; canvas.style.position='fixed'; canvas.style.left='0'; canvas.style.top='0'; canvas.style.width='100%'; canvas.style.height='100%'; canvas.style.zIndex='1'; canvas.style.pointerEvents='none'; document.body.appendChild(canvas);
      const ctx=canvas.getContext('2d'); let dpr=Math.min(2, window.devicePixelRatio || 1);

      function resize(){ canvas.width=innerWidth*dpr; canvas.height=innerHeight*dpr; canvas.style.width=innerWidth+'px'; canvas.style.height=innerHeight+'px'; ctx.setTransform(dpr,0,0,dpr,0,0); }
      window.addEventListener('resize', resize, {passive:true}); resize();

      const stars=[]; for(let i=0;i<80;i++){ stars.push({ x:Math.random()*innerWidth, y:Math.random()*innerHeight, r:Math.random()*1.8+0.3, vx:(Math.random()-0.5)*0.12, vy:(Math.random()-0.5)*0.06, hue:200+Math.random()*120, alpha:Math.random()*0.22+0.06 }); }

      function draw(){ ctx.clearRect(0,0,innerWidth,innerHeight); const g=ctx.createRadialGradient(innerWidth*0.7, innerHeight*0.35, 0, innerWidth*0.4, innerHeight*0.6, Math.max(innerWidth,innerHeight)); g.addColorStop(0,'rgba(123,97,255,0.05)'); g.addColorStop(0.45,'rgba(57,255,20,0.02)'); g.addColorStop(1,'rgba(0,0,0,0)'); ctx.fillStyle=g; ctx.fillRect(0,0,innerWidth,innerHeight);

        for(const s of stars){ s.x+=s.vx; s.y+=s.vy; if(s.x<-10) s.x=innerWidth+10; if(s.x>innerWidth+10) s.x=-10; if(s.y<-10) s.y=innerHeight+10; if(s.y>innerHeight+10) s.y=-10; ctx.beginPath(); ctx.fillStyle=`hsla(${s.hue},85%,70%,${s.alpha})`; ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill(); }

        for(let i=0;i<stars.length;i++){ const a=stars[i]; for(let j=i+1;j<stars.length;j++){ const b=stars[j]; const dx=a.x-b.x, dy=a.y-b.y; const d=Math.sqrt(dx*dx+dy*dy); if(d<140){ ctx.beginPath(); ctx.strokeStyle=`rgba(120,150,255,${(1-d/140)*0.03})`; ctx.lineWidth=1; ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); } } }

        requestAnimationFrame(draw);
      }
      draw();
    } catch(e){ console.warn('particles failed', e); }
  })();

  function attachHeaderInteractions(){
    const selector = 'header nav ul li a, header .logo';
    const els = Array.from(document.querySelectorAll(selector));
    if(els.length === 0){ setTimeout(attachHeaderInteractions, 200); return; }

    function onPointerEnter(e){ if(e.pointerType === 'touch') return; e.currentTarget.classList.add('hover-strong'); }
    function onPointerLeave(e){ e.currentTarget.classList.remove('hover-strong'); }
    function onPointerDown(e){ const el = e.currentTarget; el.classList.add('touch-active'); el.classList.add('pulse'); setTimeout(()=> el.classList.remove('pulse'), 480); setTimeout(()=> el.classList.remove('touch-active'), 420); }
    function onTouchStart(e){ const el = e.currentTarget; el.classList.add('touch-active'); setTimeout(()=> el.classList.remove('touch-active'), 420); }

    els.forEach(el=>{
      if(getComputedStyle(el).position === 'static') el.style.position = 'relative';
      el.addEventListener('pointerenter', onPointerEnter, {passive:true});
      el.addEventListener('pointerleave', onPointerLeave, {passive:true});
      el.addEventListener('pointerdown', onPointerDown, {passive:true});
      el.addEventListener('touchstart', onTouchStart, {passive:true});
      el.addEventListener('focus', ()=> el.classList.add('hover-strong'));
      el.addEventListener('blur', ()=> el.classList.remove('hover-strong'));
    });

    const mo = new MutationObserver(()=> attachHeaderInteractions());
    mo.observe(document.body, { childList:true, subtree:true });
  }

  document.addEventListener('contextmenu', function(e){ e.preventDefault(); }, false);
  document.addEventListener('keydown', function(e){
    if ((e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j')) ||
        (e.ctrlKey && (e.key === 'U' || e.key === 'u')) ||
        (e.key === 'F12')) { e.preventDefault(); return false; }
  });
  document.addEventListener('keydown', function(e){ if (e.key === 'Escape') { closeModal(); } });

  </script>

  <!-- Keep other scripts (they won't override the inlined scoped styles) -->
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/browser.min.js"></script>
  <script src="assets/js/breakpoints.min.js"></script>
  <script src="assets/js/util.js"></script>
  <script src="assets/js/main.js"></script>
</body>
</html>
