<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Private Classes</title>

  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    html,body { height:100%; }
    body {
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background-image: url('assets/images/background.gif');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: #eaf7ea;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.35;
    }

    /* Topbar */
    .topbar {
      position: fixed;
      inset: 0 0 auto 0;
      z-index: 120;
      background: linear-gradient(180deg, rgba(8,10,10,0.45), rgba(8,10,10,0.18));
      backdrop-filter: blur(6px) saturate(120%);
      border-bottom: 1px solid rgba(255,255,255,0.03);
      box-shadow: 0 6px 20px rgba(0,0,0,0.6);
    }
    .topbar-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .left { display:flex; align-items:center; gap:14px; }
    .logo-btn{
      display:inline-flex; align-items:center; justify-content:center;
      width:46px; height:46px; border-radius:6px;
      background: linear-gradient(180deg,#07110a,#06200b);
      box-shadow: 0 8px 26px rgba(0,0,0,0.6);
      text-decoration:none;
    }
    .nav { display:flex; gap:12px; align-items:center; }
    .nav a, .nav button {
      color:#dfeee1; text-decoration:none; padding:8px 10px;
      font-weight:700; border-radius:6px; font-size:14px;
      background: transparent; border: none; cursor: pointer;
    }
    .nav a:hover, .nav button:hover { transform: translateY(-2px); transition: transform .18s ease; }

    /* Main */
    .page { margin-top: 100px; min-height: calc(100vh - 120px); }
    .container { max-width:1200px; margin: 0 auto; padding: 28px; }
    .title { font-size: 42px; color: #fff; text-shadow: 0 8px 36px rgba(0,0,0,0.65); margin-bottom:8px; font-weight:900; }
    .subtitle { color: rgba(230,240,230,0.78); margin-bottom: 32px; font-size:15px; }

    /* Tiles */
    .tiles { display:grid; grid-template-columns: repeat(2, 1fr); gap: 22px; align-items:start; }
    @media (min-width:900px) { .tiles { grid-template-columns: repeat(4, 1fr); } }
    @media (max-width:640px) { .tiles { grid-template-columns: 1fr; gap:14px; } }

    .card {
      display:flex; flex-direction:column;
      background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.45));
      border-radius:10px; overflow:hidden; border: 1px solid rgba(255,255,255,0.03);
      cursor:pointer; transition: transform 220ms, box-shadow 220ms; box-shadow: 0 14px 30px rgba(0,0,0,0.55);
      min-height: 300px;
    }
    .card:hover { transform: translateY(-8px); box-shadow: 0 34px 60px rgba(0,0,0,0.65); }

    .card-media {
      position:relative; height: 220px; display:flex; align-items:center; justify-content:center;
      background: linear-gradient(180deg, rgba(0,0,0,0.95), rgba(0,0,0,0.75));
      border-bottom: 1px solid rgba(255,255,255,0.03); overflow:visible;
    }
    .neon {
      font-weight:900; letter-spacing:6px; font-size:94px; color:#00ff3a;
      text-shadow:0 0 6px rgba(0,255,120,0.95), 0 0 18px rgba(0,255,120,0.45), 0 18px 28px rgba(0,0,0,0.6);
      mix-blend-mode:screen; line-height:0.9; transform: translateY(-6px); pointer-events:none; user-select:none; white-space:nowrap;
    }
    .neon.small { font-size:60px; letter-spacing:4px; }
    .neon-reflect {
      position:absolute; bottom:-38px; left:0; right:0; text-align:center; transform: scaleY(-1); opacity:0.22;
      filter: blur(4px); font-weight:900; font-size:94px; color:#00ff3a; mix-blend-mode:screen; pointer-events:none; white-space:nowrap;
    }
    .neon-reflect.small { font-size:60px; bottom:-30px; }

    .card-caption { padding: 14px 12px 18px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); display:flex; flex-direction:column; align-items:center; gap:6px; }
    .card-title { font-weight:800; color:#eaf8ea; font-size:14px; text-align:center; }
    .card-type { font-size:11px; color: rgba(170,255,190,0.92); font-weight:700; text-transform:uppercase; }

    /* Modal & viewer */
    .modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,0.62); z-index:300; padding:18px; }
    .modal.hidden { display:none; }
    .modal-box { max-width:420px; width:100%; background: linear-gradient(180deg, rgba(8,10,8,0.98), rgba(6,8,6,0.95)); border-radius:12px; padding:18px; box-shadow: 0 20px 60px rgba(0,0,0,0.7); color:#fff; text-align:center; position:relative; }
    .modal-close { position:absolute; right:10px; top:10px; background:transparent; border:none; color:#ddd; font-size:18px; cursor:pointer; }
    .modal-preview { height:120px; display:flex; align-items:center; justify-content:center; margin-bottom:12px; }
    .pw-input { width:100%; padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.02); color:#fff; margin-top:8px; }
    .pw-actions { display:flex; gap:8px; margin-top:12px; justify-content:center; }
    .btn { padding:10px 14px; border-radius:8px; border:none; font-weight:700; cursor:pointer; background: linear-gradient(180deg,#00c85f,#00a955); color:white; }
    .btn.ghost { background:transparent; border:1px solid rgba(255,255,255,0.04); color:#dfeee1; }

    .viewer { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,0.78); z-index:400; padding:22px; }
    .viewer.hidden { display:none; }
    .viewer-inner { width:100%; max-width:1100px; height:72vh; border-radius:12px; overflow:hidden; background: rgba(2,2,2,0.75); position:relative; box-shadow: 0 30px 80px rgba(0,0,0,0.8); }
    .viewer-close { position:absolute; top:10px; right:10px; background:transparent; border:none; color:#ddd; font-size:20px; cursor:pointer; z-index:5; }
    .iframe-wrap iframe { width:100%; height:100%; border:0; display:block; }
    .iframe-fallback { display:block; margin:10px auto 0; text-align:center; color:#bfeeb2; font-weight:700; text-decoration:underline; }

    .copyright { margin-top:28px; text-align:center; color:rgba(255,255,255,0.85); font-size:13px; }

    @media (max-width:700px) {
      .neon { font-size:44px; letter-spacing:4px; }
      .neon-reflect { font-size:44px; bottom:-26px; }
      .card-media { height:180px; }
      .card { min-height:230px; }
    }

    #js-fail-note { display:none; position:fixed; right:14px; bottom:14px; background: rgba(255,80,80,0.12); color:#ffdede; border:1px solid rgba(255,80,80,0.2); padding:8px 12px; border-radius:8px; font-size:13px; z-index:9999; }
    #js-fail-note.visible { display:block; }
  </style>

<style>
:root{
  --accent-1: #7b61ff;
  --accent-2: #39ff14;
  --accent-3: #ff6b6b;
  --muted: #bfc8dd;
  --text: #f2f6ff;
}
/* Player CSS (from index.html) */
.vidu-player-host { position: relative; width:100%; overflow:hidden; border-radius:8px; background:#000; }
.vidu-mount { width:100%; height:520px; background:#000; display:block; }
.vidu-mount iframe{ width:100%; height:100%; display:block; border:0; pointer-events:none; }

.vidu-controls-bg {
  position:absolute;
  left:0;
  right:0;
  bottom:0;
  height:64px;
  background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.75));
  pointer-events:none;
  z-index:9996;
  opacity:1;
  transition:opacity .22s ease, transform .22s ease;
  backdrop-filter: blur(4px);
}
.vidu-controls-bg.hidden { opacity:0; transform: translateY(6px); }

.vidu-overlay { position:absolute; left:12px; right:12px; bottom:12px; z-index:9999; display:flex; gap:12px; align-items:center;
                padding:8px 12px; border-radius:10px; box-sizing:border-box; transition:opacity .18s ease,transform .18s ease; }
.vidu-overlay.hidden { opacity:0; transform: translateY(6px); pointer-events:none; }

.vidu-overlay .inner-bg{ position:absolute; inset:0; border-radius:10px; pointer-events:none; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); z-index:-1; }

.vidu-btn { background: rgba(255,255,255,0.06); color:#fff; padding:8px; border-radius:22px; cursor:pointer; font-weight:700;
           user-select:none; border:1px solid rgba(255,255,255,0.04); display:flex; align-items:center; justify-content:center;
           width:46px; height:46px; transition:transform .12s ease; }
.vidu-btn:active{ transform: scale(.96); }

.vidu-range { flex:1; -webkit-appearance:none; height:8px; border-radius:8px; background: rgba(255,255,255,0.06); }
.vidu-range::-webkit-slider-thumb{ -webkit-appearance:none; width:16px; height:16px; border-radius:50%; background:var(--accent-2); box-shadow:0 2px 8px rgba(0,0,0,0.5); border:2px solid rgba(0,0,0,0.18); margin-top:-4px; }
.vidu-range::-moz-range-thumb{ width:16px; height:16px; border-radius:50%; background:var(--accent-2); border:2px solid rgba(0,0,0,0.18); }

.vidu-time { min-width:90px; font-size:14px; font-weight:800; color:#cbd5ff; text-align:center; letter-spacing:1px; }

.vidu-volume { width:140px; appearance:none; -webkit-appearance:none; height:8px; border-radius:8px; background: rgba(255,255,255,0.06); margin-left:8px; margin-right:8px; }
.vidu-volume::-webkit-slider-thumb{ -webkit-appearance:none; width:14px; height:14px; border-radius:50%; background:var(--accent-2); box-shadow:0 2px 6px rgba(0,0,0,0.45); border:2px solid rgba(0,0,0,0.12); margin-top:-3px; }
.vidu-volume::-moz-range-thumb{ width:14px; height:14px; border-radius:50%; background:var(--accent-2); border:2px solid rgba(0,0,0,0.12); }

.vidu-close-btn {
  position:absolute;
  top:10px;
  right:10px;
  z-index:10002;
  width:36px;
  height:36px;
  padding:6px;
  border-radius:8px;
  background:rgba(0,0,0,0.46);
  border:1px solid rgba(255,255,255,0.06);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  cursor:pointer;
  box-shadow:0 8px 24px rgba(0,0,0,0.6);
  transition: opacity .18s ease, transform .18s ease;
}
.vidu-close-btn.hidden { opacity:0; transform: translateY(-6px); pointer-events:none; }

#close-player { display:none !important; }

/* Fullscreen adjustments */
.vidu-player-host:-webkit-full-screen .vidu-mount,
.vidu-player-host:-moz-full-screen .vidu-mount,
.vidu-player-host:fullscreen .vidu-mount { height:100vh !important; width:100% !important; }
.vidu-player-host:-webkit-full-screen .vidu-mount iframe,
.vidu-player-host:-moz-full-screen .vidu-mount iframe,
.vidu-player-host:fullscreen .vidu-mount iframe { height:100vh !important; width:100% !important; max-height:none !important; }

@media (max-width:720px){
  .vidu-mount{ height:320px; }
  .vidu-overlay{ left:8px; right:8px; bottom:8px; }
  .vidu-controls-bg { height:56px; }
  .vidu-time { min-width:76px; font-size:12px; }
}
</style>
</head>
<body>
  <!-- Topbar -->
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="left">
        <a class="logo-btn" href="index.html" title="Home" aria-label="Home">
          <!-- INLINE SVG LOGO SHOWING "V" -->
          <svg width="30" height="30" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
            <defs>
              <linearGradient id="gV" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="#00ff55"/>
                <stop offset="1" stop-color="#00b86a"/>
              </linearGradient>
            </defs>
            <rect x="4" y="4" width="56" height="56" rx="8" fill="#07120b"/>
            <path d="M16 16 L32 46 L48 16" stroke="url(#gV)" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>

        <!-- Nav: Home, Private, About -->
        <nav class="nav" aria-label="Main navigation">
          <a href="index.html">Home</a>
          <button id="nav-private">Private</button>
          <a href="about.html">About</a>
        </nav>
      </div>

      <!-- placeholder to keep spacing (sign-in removed) -->
      <div style="width:46px; height:46px;"></div>
    </div>
  </header>

  <!-- Main content -->
  <main class="page" role="main">
    <div class="container">
      <h1 class="title">Private Classes</h1>
      <p class="subtitle">To access Enter the password or sign in with a Google account that has admin access</p>

      <!-- Tiles -->
      <section id="tiles" class="tiles" aria-live="polite"></section>

      <div class="copyright">© VIDU. All rights reserved.</div>
    </div>
  </main>

  <!-- Password modal -->
  <div id="pw-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-box" role="document">
      <button class="modal-close" id="pw-close" aria-label="Close">✕</button>
      <div class="modal-preview" id="modal-preview"></div>
      <h3 id="pw-title" style="color:#dfeee1;font-weight:800;margin-bottom:6px;">Enter password</h3>
      <input id="pw-input" class="pw-input" type="password" placeholder="Password" autocomplete="off" />
      <div class="pw-actions">
        <button id="pw-submit" class="btn">Unlock</button>
        <button id="pw-cancel" class="btn ghost">Cancel</button>
      </div>
      <p id="pw-error" style="color:#ff8080;margin-top:10px;min-height:18px;"></p>
    </div>
  </div>

  <!-- Viewer overlay -->
  <div id="viewer" class="viewer hidden" aria-hidden="true">
    <div class="viewer-inner">
      <button id="viewer-close" class="viewer-close" aria-label="Close viewer">✕</button>
      <div class="iframe-wrap" id="iframe-wrap"></div>
    </div>
  </div>

  <!-- JS-fail helper -->
  <div id="js-fail-note">Some features may be unavailable — enable JavaScript.</div>

  <script>
    (function(){
      try {
        // items (btoa/atob logic preserved)
        const items = [
          { type: 'video', title: 'TEST', idB64: btoa("Lexok6H2c2s"), passB64: btoa("vidu123test")},
          { type: 'playlist', title: 'SFT - Theory + Revision', idB64: btoa("PL9zX0VbNmKiGt19HZ9wzIwC-VQ_AN0z9K&si=0jJc5HTa68Weq851"), passB64: btoa("vidu123sft") },
          { type: 'playlist', title: 'ICT', idB64: btoa("PL9zX0VbNmKiFlxda5PCTn4_hA_7iKjEaA&si=9nF_7qpAzKt4cYZd"), passB64: btoa("6002vidu") },
          { type: 'playlist', title: 'ET', idB64: btoa("PL9zX0VbNmKiF-Q7bnmM1v_DrT3_Ol-Of5&si=efJHPzWR-kZcGwYw"), passB64: btoa("vidu123et")}
        ];

        // DOM refs
        const tiles = document.getElementById('tiles');
        const pwModal = document.getElementById('pw-modal');
        const pwTitleEl = document.getElementById('pw-title');
        const pwInput = document.getElementById('pw-input');
        const pwSubmit = document.getElementById('pw-submit');
        const pwCancel = document.getElementById('pw-cancel');
        const pwClose = document.getElementById('pw-close');
        const pwError = document.getElementById('pw-error');
        const modalPreview = document.getElementById('modal-preview');
        const viewer = document.getElementById('viewer');
        const iframeWrap = document.getElementById('iframe-wrap');
        const viewerClose = document.getElementById('viewer-close');
        const navPrivate = document.getElementById('nav-private');

        let currentItem = null;

        function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

        // Use unicode escapes for en-dash and em-dash to avoid regex syntax issues
        const dashSplitRegex = /[\u2013\u2014\-+]/;

        function neonTextFor(title){
          if(!title) return '';
          // split on common separators (hyphen, en-dash, em-dash, plus)
          const main = title.split(dashSplitRegex)[0].trim();
          const words = main.split(/\s+/);
          if(words.length === 1) return words[0].toUpperCase().slice(0, 6);
          return words[0].toUpperCase();
        }

        // normalize id from base64: decode and take part before any & param
        function normalizeIdFromB64(idB64){
          try {
            const decoded = atob(idB64 || '');
            return decoded.split('&')[0];
          } catch(e){
            console.warn('Invalid idB64', idB64, e);
            return '';
          }
        }

        function buildTiles(){
          if(!tiles) return;
          tiles.innerHTML = '';
          items.forEach((it, idx) => {
            const card = document.createElement('button');
            card.className = 'card';
            card.type = 'button';
            card.setAttribute('data-idx', idx);
            card.setAttribute('aria-label', it.title + ' ' + it.type);

            const neon = neonTextFor(it.title);
            const neonSmallClass = (neon.length > 6) ? ' small' : '';
            card.innerHTML = `
              <div class="card-media" role="img" aria-label="${escapeHtml(it.title)} thumbnail">
                <div class="neon${neonSmallClass}">${escapeHtml(neon)}</div>
                <div class="neon-reflect${neonSmallClass}" aria-hidden="true">${escapeHtml(neon)}</div>
              </div>
              <div class="card-caption">
                <div class="card-title">${escapeHtml(it.title)}</div>
                <div class="card-type">${escapeHtml(it.type)}</div>
              </div>
            `;
            card.addEventListener('click', () => openPasswordModal(it));
            tiles.appendChild(card);
          });
        }

        function showModal(el){
          el.classList.remove('hidden');
          el.setAttribute('aria-hidden','false');
          document.body.style.overflow = 'hidden';
        }
        function closeModal(el){
          el.classList.add('hidden');
          el.setAttribute('aria-hidden','true');
          document.body.style.overflow = '';
        }

        function openPasswordModal(item){
          currentItem = item;
          pwError.textContent = '';
          pwInput.value = '';
          pwTitleEl.textContent = `Unlock: ${item.title}`;
          modalPreview.innerHTML = `<div class="neon" style="font-size:56px;">${escapeHtml(neonTextFor(item.title))}</div>`;
          showModal(pwModal);
          setTimeout(()=> pwInput.focus(), 120);
        }

        function verifyPassword(){
          if(!currentItem) return;
          const entered = pwInput.value || '';
          try {
            const enteredB64 = btoa(entered);
            if(enteredB64 === currentItem.passB64){
              closeModal(pwModal);
              openViewer(currentItem);
            } else {
              pwError.textContent = 'Incorrect password. Try again.';
              pwInput.select();
            }
          } catch(err){
            pwError.textContent = 'Error checking password.';
            console.error(err);
          }
        }

        // build embed + external URL for fallback
        function getEmbedFor(item){
          const normalized = normalizeIdFromB64(item.idB64);
          if(!normalized) return { src: '', external: '' };
          if(item.type === 'video'){
            const vid = normalized.split('&')[0];
            const src = 'https://www.youtube.com/embed/' + encodeURIComponent(vid) + '?rel=0&autoplay=1';
            const external = 'https://youtu.be/' + encodeURIComponent(vid);
            return { src, external };
          } else {
            const list = normalized.split('&')[0];
            const src = 'https://www.youtube.com/embed?listType=playlist&list=' + encodeURIComponent(list) + '&rel=0&autoplay=1';
            const external = 'https://www.youtube.com/playlist?list=' + encodeURIComponent(list);
            return { src, external };
          }
        }

        function openViewer(item){
          if(!iframeWrap) return;
          iframeWrap.innerHTML = '';
          const embed = getEmbedFor(item);
          if(!embed.src){
            alert('Unable to load the selected item.');
            return;
          }

          const ifr = document.createElement('iframe');
          ifr.src = embed.src;
          ifr.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen');
          ifr.setAttribute('allowfullscreen', '');
          ifr.style.background = '#000';
          ifr.loading = 'lazy';
          iframeWrap.appendChild(ifr);

          const fallback = document.createElement('a');
          fallback.href = embed.external;
          fallback.target = '_blank';
          fallback.rel = 'noopener noreferrer';
          fallback.className = 'iframe-fallback';
          fallback.textContent = 'Open in YouTube (if the video does not appear)';
          iframeWrap.appendChild(fallback);

          showModal(viewer);
        }

        // events
        document.addEventListener('keydown', (e) => {
          if(e.key === 'Escape'){
            if(!pwModal.classList.contains('hidden')) closeModal(pwModal);
            if(!viewer.classList.contains('hidden')) { closeModal(viewer); iframeWrap.innerHTML = ''; }
          }
        });

        if(pwSubmit) pwSubmit.addEventListener('click', verifyPassword);
        if(pwInput) pwInput.addEventListener('keydown', function(e){ if(e.key === 'Enter') verifyPassword(); });
        if(pwCancel) pwCancel.addEventListener('click', ()=> closeModal(pwModal));
        if(pwClose) pwClose.addEventListener('click', ()=> closeModal(pwModal));
        if(pwModal) pwModal.addEventListener('click', (e)=> { if(e.target === pwModal) closeModal(pwModal); });

        if(viewerClose) viewerClose.addEventListener('click', ()=> { closeModal(viewer); iframeWrap.innerHTML = ''; });
        if(viewer) viewer.addEventListener('click', (e)=> { if(e.target === viewer) { closeModal(viewer); iframeWrap.innerHTML = ''; } });

        if(navPrivate) navPrivate.addEventListener('click', ()=> location.reload());

        // render tiles
        document.addEventListener('DOMContentLoaded', function(){
          try {
            buildTiles();
          } catch(err){
            console.error('buildTiles error', err);
            const note = document.getElementById('js-fail-note');
            if(note) note.classList.add('visible');
          }
        });

        // show js-fail note if tiles didn't render quickly
        setTimeout(function(){
          const tilesPresent = tiles && tiles.children && tiles.children.length > 0;
          if(!tilesPresent){
            const note = document.getElementById('js-fail-note');
            if(note) note.classList.add('visible');
          }
        }, 1200);

      } catch(err){
        console.error('Fatal script error', err);
        const note = document.getElementById('js-fail-note');
        if(note) note.classList.add('visible');
      }
    })();
  </script>

<!-- VIDU modal root and player + playlist fetching from index.html -->
<div id="modal-root" style="display:none;"></div>

<script>
(function(){
  if(window.__viduPlayerLoaded) return;
  window.__viduPlayerLoaded = true;

  const state = {
    player: null,
    updateInterval: null,
    keyHandler: null,
    mo: null,
    host: null,
    mount: null,
    fsResizeHandler: null,
    fsListener: null,
    docClickHandler: null,
    inactivityTimer: null,
    lastActivity: Date.now(),
    desiredPlaying: null,
    lastVolume: 100
  };

  /**
   * Load YouTube iframe API. Exposed on window as well (defensive).
   * Returns a Promise that resolves when API ready.
   */
  function loadYTApi(){
    if(window.YT && window.YT.Player) return Promise.resolve();
    if(window._vidu_loading_yt){
      return new Promise((res, rej)=>{
        const t = setInterval(()=>{ if(window.YT && window.YT.Player){ clearInterval(t); res(); } },80);
        setTimeout(()=>{ clearInterval(t); rej(new Error('YT load timeout')); },20000);
      });
    }
    window._vidu_loading_yt = true;
    return new Promise((resolve,reject)=>{
      const s=document.createElement('script');
      s.src='https://www.youtube.com/iframe_api';
      s.async=true;
      s.onerror = ()=> reject(new Error('YT API failed to load'));
      document.head.appendChild(s);
      // YouTube will call this global when ready
      window.onYouTubeIframeAPIReady = function(){ resolve(); };
      // small fallbacks
      setTimeout(()=>{ if(window.YT && window.YT.Player) resolve(); },1200);
      setTimeout(()=>{ if(!(window.YT && window.YT.Player)) reject(new Error('YT API timed out')); },20000);
    });
  }
  // make available globally so other modules/callbacks can call it safely
  try{ window.loadYTApi = loadYTApi; }catch(e){ /* ignore */ }

  function pad2(n){
    n = Math.max(0, Math.floor(n||0));
    return (n < 10 ? '0' + n : String(n));
  }

  // HH : MM : SS
  function fmtTime(s){
    s = Math.max(0, Math.floor(s||0));
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;
    return pad2(h) + ' : ' + pad2(m) + ' : ' + pad2(sec);
  }

  function playSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 4.5v15l12-7.5L6 4.5z" fill="#fff"/></svg>`; }
  function pauseSVG(){ return `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="5" y="4" width="4" height="16" rx="1.2" fill="#fff"/><rect x="15" y="4" width="4" height="16" rx="1.2" fill="#fff"/></svg>`; }

  function createHostElements(){
    const wrap = document.getElementById('player-wrap');
    if(!wrap) throw new Error('#player-wrap not found');

    const prev = wrap.querySelector('.vidu-player-host');
    if(prev) prev.remove();

    const host = document.createElement('div'); host.className = 'vidu-player-host';
    const mount = document.createElement('div'); mount.className = 'vidu-mount'; mount.id = 'vidu_mount_'+Math.floor(Math.random()*1e6);
    mount.style.height = '520px';
    mount.style.background = '#000';
    host.appendChild(mount);

    const ctrlBg = document.createElement('div'); ctrlBg.className = 'vidu-controls-bg';
    host.appendChild(ctrlBg);

    const overlay = document.createElement('div'); overlay.className = 'vidu-overlay';
    overlay.innerHTML = `
      <div class="inner-bg" aria-hidden="true"></div>
      <button class="vidu-btn" id="vidu_playbtn">${playSVG()}</button>
      <div class="vidu-time" id="vidu_cur">` + fmtTime(0) + `</div>
      <input id="vidu_seek" class="vidu-range" type="range" min="0" max="100" step="0.1" value="0" />
      <div class="vidu-time" id="vidu_dur">` + fmtTime(0) + `</div>
      <input id="vidu_vol" class="vidu-volume" type="range" min="0" max="100" step="1" value="100" aria-label="Volume" />
      <button class="vidu-btn" id="vidu_fullbtn">⤢</button>
    `;
    host.appendChild(overlay);

    const closeBtn = document.createElement('button');
    closeBtn.className = 'vidu-close-btn';
    closeBtn.id = 'vidu_closebtn';
    closeBtn.title = 'Close';
    closeBtn.type = 'button';
    closeBtn.innerHTML = '✕';
    closeBtn.addEventListener('click', ()=> {
      try{
        if(typeof window.closeModal === 'function') window.closeModal();
        else {
          const root = document.getElementById('modal-root'); if(root) root.style.display='none';
          if(window.destroyViduPlayer) window.destroyViduPlayer();
        }
      }catch(e){ console.warn('closeBtn error', e); }
    });
    host.appendChild(closeBtn);

    wrap.appendChild(host);
    return { host, mount, overlay, ctrlBg, closeBtn };
  }

  function disableIframeClicks(host){
    try{
      const ifr = host.querySelector('iframe');
      if(ifr){
        ifr.style.pointerEvents = 'none';
        ifr.setAttribute('allow','autoplay; encrypted-media; fullscreen');
        ifr.setAttribute('allowfullscreen','');
        ifr.setAttribute('tabindex','-1');
      }
    }catch(e){ console.warn('disableIframeClicks', e); }
  }

  function createPlayer(videoId){
    const { host, mount, overlay, ctrlBg, closeBtn } = createHostElements();
    state.host = host; state.mount = mount;

    const playBtn = overlay.querySelector('#vidu_playbtn');
    const curEl = overlay.querySelector('#vidu_cur');
    const durEl = overlay.querySelector('#vidu_dur');
    const seekEl = overlay.querySelector('#vidu_seek');
    const fullBtn = overlay.querySelector('#vidu_fullbtn');
    const volEl = overlay.querySelector('#vidu_vol');

    try{ if(curEl) curEl.textContent = fmtTime(0); }catch(e){}
    try{ if(durEl) durEl.textContent = fmtTime(0); }catch(e){}

    function getFullscreenElement(){
      return document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement || null;
    }

    const saved = { stored:false, host:{}, mount:{}, iframe:{}, modal:{}, backdrop:{}, playerWrap:{} };

    function toggleFullscreen(){
      const fs = getFullscreenElement();
      if(fs === host){
        const exit = document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen;
        if(exit) exit.call(document);
      } else {
        const req = host.requestFullscreen || host.webkitRequestFullscreen || host.mozRequestFullScreen || host.msRequestFullscreen;
        if(req) req.call(host);
      }
    }

    fullBtn.addEventListener('click', toggleFullscreen);

    function setOverlayHidden(hidden){
      if(hidden){
        overlay.classList.add('hidden');
        ctrlBg.classList.add('hidden');
        if(closeBtn) closeBtn.classList.add('hidden');
      } else {
        overlay.classList.remove('hidden');
        ctrlBg.classList.remove('hidden');
        if(closeBtn) closeBtn.classList.remove('hidden');
      }
    }

    state.keyHandler = function(e){
      const active = document.activeElement;
      if(active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA' || active.isContentEditable)) return;
      const modal = document.getElementById('modal-root');
      if(!modal || modal.style.display === 'none') return;
      if(e.code === 'Space' || e.key === ' '){
        e.preventDefault();
        if(state.player){
          const st = state.player.getPlayerState ? state.player.getPlayerState() : -1;
          if(st === 1) {
            try{ state.player.pauseVideo(); }catch(e){}
          } else {
            try{ state.player.playVideo(); }catch(e){}
          }
        }
      } else if(e.code === 'KeyF' || e.key === 'f' || e.key === 'F'){
        e.preventDefault();
        toggleFullscreen();
      }
    };
    document.addEventListener('keydown', state.keyHandler);

    // seek handling
    seekEl.addEventListener('pointerdown', ()=> seekEl._drag=true, {passive:true});
    seekEl.addEventListener('pointerup', ()=>{ 
      seekEl._drag=false;
      if(!state.player) return;
      const dur = state.player.getDuration ? state.player.getDuration() : 0;
      if(dur) state.player.seekTo(dur * (parseFloat(seekEl.value)/100), true);
    }, {passive:true});
    seekEl.addEventListener('input', ()=>{ 
      if(seekEl._drag && state.player){
        const dur = state.player.getDuration ? state.player.getDuration() : 0;
        if(dur) curEl.textContent = fmtTime(Math.floor(dur * (parseFloat(seekEl.value)/100)));
        updateSeekBackground(seekEl);
      }
    }, {passive:true});

    function updateSeekBackground(el){
      try{
        const v = Math.max(0, Math.min(100, parseFloat(el.value) || 0));
        el.style.background = `linear-gradient(90deg, var(--accent-2) ${v}%, rgba(255,255,255,0.06) ${v}%)`;
      }catch(e){}
    }
    updateSeekBackground(seekEl);

    // play/pause with immediate UI response
    playBtn.addEventListener('click', ()=>{
      if(!state.player) return;
      let st = -1;
      try{ st = state.player.getPlayerState ? state.player.getPlayerState() : -1; }catch(e){}
      const wantPlay = !(st === 1);
      state.desiredPlaying = wantPlay;
      playBtn.innerHTML = wantPlay ? pauseSVG() : playSVG();
      try{
        if(wantPlay){
          if(typeof state.player.playVideo === 'function') state.player.playVideo();
        } else {
          if(typeof state.player.pauseVideo === 'function') state.player.pauseVideo();
        }
      }catch(e){ console.warn('play/pause toggle err', e); }
      resetInactivityTimer();
    });

    // volume
    volEl.addEventListener('input', ()=> {
      const v = Math.max(0, Math.min(100, parseInt(volEl.value,10) || 0));
      state.lastVolume = v;
      try{
        if(state.player && typeof state.player.setVolume === 'function'){
          state.player.setVolume(v);
          if(v === 0 && typeof state.player.mute === 'function') state.player.mute();
          else if(v > 0 && typeof state.player.unMute === 'function') state.player.unMute();
        }
      }catch(e){ console.warn('setVolume err', e); }
      try{ volEl.style.background = `linear-gradient(90deg, var(--accent-2) ${v}%, rgba(255,255,255,0.06) ${v}%)`; }catch(e){}
      resetInactivityTimer();
    }, {passive:true});

    (function initVolBg(){
      try{
        const v = Math.max(0, Math.min(100, parseInt(volEl.value,10) || state.lastVolume || 100));
        volEl.style.background = `linear-gradient(90deg, var(--accent-2) ${v}%, rgba(255,255,255,0.06) ${v}%)`;
      }catch(e){}
    })();

    function onFSChange(){
      const fs = getFullscreenElement();
      const isOurFullscreen = !!(fs && (fs === host || host.contains(fs) || (fs.contains && fs.contains(host))));
      if(isOurFullscreen){
        if(!saved.stored){
          saved.host.position = host.style.position || '';
          saved.host.top = host.style.top || '';
          saved.host.left = host.style.left || '';
          saved.host.width = host.style.width || '';
          saved.host.height = host.style.height || '';
          saved.host.zIndex = host.style.zIndex || '';
          saved.host.borderRadius = host.style.borderRadius || '';

          saved.mount.height = mount.style.height || '';
          saved.mount.width = mount.style.width || '';
          saved.mount.maxHeight = mount.style.maxHeight || '';
          saved.mount.maxWidth = mount.style.maxWidth || '';

          const ifr = host.querySelector('iframe');
          if(ifr){
            saved.iframe.height = ifr.style.height || '';
            saved.iframe.width = ifr.style.width || '';
            saved.iframe.pointerEvents = ifr.style.pointerEvents || '';
            saved.iframe.maxHeight = ifr.style.maxHeight || '';
            saved.iframe.maxWidth = ifr.style.maxWidth || '';
          } else saved.iframe = {};

          const modalEl = host.closest('.modal');
          if(modalEl){
            saved.modal.display = modalEl.style.display || '';
            saved.modal.width = modalEl.style.width || '';
            saved.modal.maxWidth = modalEl.style.maxWidth || '';
            saved.modal.position = modalEl.style.position || '';
            saved.modal.zIndex = modalEl.style.zIndex || '';
          } else saved.modal = {};

          const backdrop = document.getElementById('modal-backdrop');
          if(backdrop){
            saved.backdrop.display = backdrop.style.display || '';
            saved.backdrop.zIndex = backdrop.style.zIndex || '';
          } else saved.backdrop = {};

          const playerWrap = document.getElementById('player-wrap');
          if(playerWrap){
            saved.playerWrap.display = playerWrap.style.display || '';
            saved.playerWrap.position = playerWrap.style.position || '';
            saved.playerWrap.zIndex = playerWrap.style.zIndex || '';
          } else saved.playerWrap = {};

          saved.stored = true;
        }

        try{
          host.style.position = 'fixed';
          host.style.top = '0';
          host.style.left = '0';
          host.style.width = '100vw';
          host.style.height = '100vh';
          host.style.zIndex = '2147483647';
          host.style.borderRadius = '0';
        }catch(e){}

        try{
          mount.style.width = '100%';
          mount.style.height = '100%';
          mount.style.maxHeight = 'none';
          mount.style.maxWidth = 'none';
        }catch(e){}

        try{
          const ifr = host.querySelector('iframe');
          if(ifr){
            ifr.style.width = '100%';
            ifr.style.height = '100%';
            ifr.style.maxHeight = 'none';
            ifr.style.maxWidth = 'none';
            ifr.style.pointerEvents = 'auto';
          }
        }catch(e){}

        ctrlBg.classList.remove('hidden');
        overlay.classList.remove('hidden');
        if(closeBtn) closeBtn.classList.remove('hidden');

        if(!state.fsResizeHandler){
          state.fsResizeHandler = ()=> {
            const curFS = getFullscreenElement();
            const stillOurFS = !!(curFS && (curFS === host || host.contains(curFS) || (curFS.contains && curFS.contains(host))));
            if(stillOurFS){
              try{ host.style.width = window.innerWidth + 'px'; host.style.height = window.innerHeight + 'px'; }catch(e){}
              try{ mount.style.height = window.innerHeight + 'px'; }catch(e){}
              try{
                const ifr = host.querySelector('iframe');
                if(ifr) ifr.style.height = window.innerHeight + 'px';
              }catch(e){}
            }
          };
          window.addEventListener('resize', state.fsResizeHandler);
        }

      } else {
        if(saved.stored){
          try{
            host.style.position = saved.host.position;
            host.style.top = saved.host.top;
            host.style.left = saved.host.left;
            host.style.width = saved.host.width;
            host.style.height = saved.host.height;
            host.style.zIndex = saved.host.zIndex;
            host.style.borderRadius = saved.host.borderRadius;
          }catch(e){}

          try{
            mount.style.height = saved.mount.height;
            mount.style.width = saved.mount.width;
            mount.style.maxHeight = saved.mount.maxHeight;
            mount.style.maxWidth = saved.mount.maxWidth;
          }catch(e){}

          try{
            const ifr = host.querySelector('iframe');
            if(ifr){
              ifr.style.height = saved.iframe.height;
              ifr.style.width = saved.iframe.width;
              ifr.style.pointerEvents = saved.iframe.pointerEvents;
              ifr.style.maxHeight = saved.iframe.maxHeight;
              ifr.style.maxWidth = saved.iframe.maxWidth;
            }
          }catch(e){}

          try{
            const modalEl = host.closest('.modal');
            if(modalEl){
              modalEl.style.display = saved.modal.display;
              modalEl.style.width = saved.modal.width;
              modalEl.style.maxWidth = saved.modal.maxWidth;
              modalEl.style.position = saved.modal.position;
              modalEl.style.zIndex = saved.modal.zIndex;
            }
          }catch(e){}

          try{
            const backdrop = document.getElementById('modal-backdrop');
            if(backdrop){
              backdrop.style.display = saved.backdrop.display;
              backdrop.style.zIndex = saved.backdrop.zIndex;
            }
          }catch(e){}

          try{
            const playerWrap = document.getElementById('player-wrap');
            if(playerWrap){
              playerWrap.style.display = saved.playerWrap.display;
              playerWrap.style.position = saved.playerWrap.position;
              playerWrap.style.zIndex = saved.playerWrap.zIndex;
            }
          }catch(e){}

          saved.stored = false;
        } else {
          try{ mount.style.height = '520px'; mount.style.width = '100%'; }catch(e){}
          try{
            const ifr = host.querySelector('iframe');
            if(ifr) ifr.style.pointerEvents = 'none';
          }catch(e){}
        }

        if(state.fsResizeHandler){
          window.removeEventListener('resize', state.fsResizeHandler);
          state.fsResizeHandler = null;
        }

        if(overlay.classList.contains('hidden')){
          ctrlBg.classList.add('hidden');
          if(closeBtn) closeBtn.classList.add('hidden');
        } else {
          ctrlBg.classList.remove('hidden');
          if(closeBtn) closeBtn.classList.remove('hidden');
        }
      }
    }

    state.fsListener = onFSChange;
    document.addEventListener('fullscreenchange', state.fsListener);
    document.addEventListener('webkitfullscreenchange', state.fsListener);
    document.addEventListener('mozfullscreenchange', state.fsListener);
    document.addEventListener('MSFullscreenChange', state.fsListener);

    function resetInactivityTimer(){
      state.lastActivity = Date.now();
      setOverlayHidden(false);
      if(state.inactivityTimer) { clearTimeout(state.inactivityTimer); state.inactivityTimer = null; }
      state.inactivityTimer = setTimeout(()=>{
        try{
          const st = state.player && typeof state.player.getPlayerState === 'function' ? state.player.getPlayerState() : -1;
          if(st === 1 || st === 3 || st === -1 || st === 0 || st === 5){
            setOverlayHidden(true);
          }
        }catch(e){}
      }, 5000);
    }

    function attachActivityListeners(){
      try{
        ['mousemove','pointermove','touchstart','touchmove','keydown','mousedown'].forEach(ev=>{
          host.addEventListener(ev, resetInactivityTimer, {passive:true});
          document.addEventListener(ev, resetInactivityTimer, {passive:true});
        });
      }catch(e){}
    }
    function detachActivityListeners(){
      try{
        ['mousemove','pointermove','touchstart','touchmove','keydown','mousedown'].forEach(ev=>{
          host.removeEventListener(ev, resetInactivityTimer);
          document.removeEventListener(ev, resetInactivityTimer);
        });
      }catch(e){}
    }
    attachActivityListeners();

    // load YT and mount player
    return loadYTApi().then(()=> new Promise((resolve,reject)=>{
      if(state.player && typeof state.player.destroy === 'function'){ try{ state.player.destroy(); }catch(e){} state.player = null; }

      // create YT player
      try{
        state.player = new YT.Player(mount.id, {
          videoId: videoId,
          width: '100%',
          height: '100%',
          playerVars: {
            controls: 0,
            disablekb: 1,
            rel: 0,
            modestbranding: 1,
            playsinline: 1,
            iv_load_policy: 3,
            origin: location.origin
          },
          events: {
            onReady: function(evt){
              disableIframeClicks(host);

              // apply volume
              try{
                if(typeof evt.target.setVolume === 'function'){
                  const v = Math.max(0, Math.min(100, state.lastVolume || 100));
                  evt.target.setVolume(v);
                  if(v === 0 && typeof evt.target.mute === 'function') evt.target.mute();
                  else if(v > 0 && typeof evt.target.unMute === 'function') evt.target.unMute();
                  const volEl = document.getElementById('vidu_vol');
                  if(volEl) { volEl.value = v; volEl.style.background = `linear-gradient(90deg, var(--accent-2) ${v}%, rgba(255,255,255,0.06) ${v}%)`; }
                }
              }catch(e){}

              // request default quality (let YT pick)
              try{
                if(typeof evt.target.setPlaybackQuality === 'function'){
                  evt.target.setPlaybackQuality('default');
                  setTimeout(()=> { try{ evt.target.setPlaybackQuality('default'); }catch(e){} }, 800);
                  setTimeout(()=> { try{ evt.target.setPlaybackQuality('default'); }catch(e){} }, 2200);
                }
              }catch(e){}

              try{ evt.target.playVideo(); }catch(e){}

              mount.style.height = mount.style.height || '520px';

              if(state.updateInterval) clearInterval(state.updateInterval);
              state.updateInterval = setInterval(()=>{
                try{
                  if(!state.player) return;
                  const dur = state.player.getDuration ? state.player.getDuration() : 0;
                  const cur = state.player.getCurrentTime ? state.player.getCurrentTime() : 0;
                  curEl.textContent = fmtTime(Math.floor(cur));
                  durEl.textContent = (dur && isFinite(dur)) ? fmtTime(Math.floor(dur)) : fmtTime(0);
                  if(!seekEl._drag && dur && isFinite(dur)) {
                    seekEl.value = (cur / Math.max(1,dur)) * 100;
                    updateSeekBackground(seekEl);
                  }
                  const st = state.player.getPlayerState ? state.player.getPlayerState() : -1;
                  if(state.desiredPlaying !== null){
                    if(state.desiredPlaying && st !== 1){
                      try{ state.player.playVideo(); }catch(e){}
                    } else if(!state.desiredPlaying && st === 1){
                      try{ state.player.pauseVideo(); }catch(e){}
                    }
                  }
                  const currentIcon = (st === 1) ? pauseSVG() : playSVG();
                  if(Date.now() - state.lastActivity > 300) {
                    playBtn.innerHTML = currentIcon;
                  } else {
                    setTimeout(()=> {
                      try{
                        const check = state.player.getPlayerState ? state.player.getPlayerState() : -1;
                        if(check === 1) playBtn.innerHTML = pauseSVG(); else playBtn.innerHTML = playSVG();
                      }catch(e){}
                    }, 600);
                  }
                }catch(e){}
              }, 160);

              if(state.mo) state.mo.disconnect();
              state.mo = new MutationObserver(()=> disableIframeClicks(host));
              state.mo.observe(host, { childList:true, subtree:true });

              resetInactivityTimer();

              resolve(state.player);
            },
            onError: function(err){ console.error('YT player error', err); reject(err); }
          }
        });
      }catch(err){
        reject(err || new Error('YT player creation failed'));
      }
    })).catch(err=>{
      // surface a clear error in the UI
      throw err;
    }).then(p=>{
      setTimeout(()=> resetInactivityTimer(), 40);
      return p;
    });
  }

  function destroyPlayer(){
    try{
      if(state.updateInterval){ clearInterval(state.updateInterval); state.updateInterval = null; }
      if(state.keyHandler){ document.removeEventListener('keydown', state.keyHandler); state.keyHandler = null; }
      if(state.docClickHandler){ document.removeEventListener('click', state.docClickHandler); state.docClickHandler = null; }
      if(state.player){ try{ state.player.destroy(); }catch(e){} state.player = null; }
      if(state.mo){ try{ state.mo.disconnect(); }catch(e){} state.mo = null; }
      if(state.fsResizeHandler){ window.removeEventListener('resize', state.fsResizeHandler); state.fsResizeHandler = null; }
      if(state.fsListener){
        document.removeEventListener('fullscreenchange', state.fsListener);
        document.removeEventListener('webkitfullscreenchange', state.fsListener);
        document.removeEventListener('mozfullscreenchange', state.fsListener);
        document.removeEventListener('MSFullscreenChange', state.fsListener);
        state.fsListener = null;
      }
      if(state.inactivityTimer){ clearTimeout(state.inactivityTimer); state.inactivityTimer = null; }
      if(state.host){
        try{
          ['mousemove','pointermove','touchstart','touchmove','keydown','mousedown'].forEach(ev=>{
            state.host.removeEventListener(ev, resetInactivityTimer);
            document.removeEventListener(ev, resetInactivityTimer);
          });
        }catch(e){}
      }
      if(state.host){ try{ state.host.remove(); }catch(e){} state.host = null; state.mount = null; }
    }catch(e){ console.warn('destroyPlayer err', e); }
  }

  // Public API
  window.showViduPlayer = function(videoId){
    // defensive: ensure loader exists globally before calling (so other callers won't hit "loadYTApi is not defined")
    if(typeof window.loadYTApi !== 'function') {
      window.loadYTApi = loadYTApi;
    }
    return createPlayer(videoId).catch(err => { console.error('createPlayer failed', err); throw err; });
  };
  window.destroyViduPlayer = function(){
    destroyPlayer();
    const w = document.getElementById('player-wrap'); if(w) w.innerHTML = '';
  };

  // cleanup on unload
  window.addEventListener('beforeunload', ()=> { try{ window.destroyViduPlayer(); }catch(e){} }, {passive:true});
})();
</script>

<script>
/*************************************************************************
 * Playlist data + UI + modal + Playlist-inside-modal + YouTube playlist fetching
 *************************************************************************/
const playlists = [
  {
    id: 0,
    name: 'SUBJECTS',
    thumbnail: 'https://i.pinimg.com/736x/71/82/6e/71826ec9ece9f33d9034bb0acd3b8d1f.jpg',
    videos: [
      {
        id: 1,
        name: 'ET',
        thumbnail: 'https://i.pinimg.com/736x/19/b2/42/19b2424009813fc558e8a785c794cbdf.jpg',
        videos: [
          { name:'', thumbnail:'https://i.pinimg.com/736x/19/b2/42/19b2424009813fc558e8a785c794cbdf.jpg', type:'playlist', idB64: btoa("PL9zX0VbNmKiHFvj6Q-p04TgdZj_tv0eI3&si=pAyX-6SJILH6QSg2"), passB64: btoa("vidu123et") },
          { name:'', thumbnail:'https://i.pinimg.com/736x/ea/60/d8/ea60d83595332fe2a7d11f1844072251.jpg', type:'playlist', idB64: btoa("PL9zX0VbNmKiFcYCAzfcyI0cz8cOfyWlTc&si=nZ224kprFgDGTG9Z"), passB64: btoa("vidu123et") }
        ]
      },
      {
        id: 2,
        name: 'SFT',
        thumbnail: 'https://i.pinimg.com/736x/b8/de/57/b8de57f639bb30fd9f48cda542dd96d2.jpg',
        videos: [
          { name:'', thumbnail:'https://i.pinimg.com/736x/2d/9d/1a/2d9d1a4affd566269879267ca70b74b8.jpg', type:'playlist', idB64: btoa("PL9zX0VbNmKiG94fMjA7v-6nw55htWj6LH&si=PUXqK2wlIin_tUZm"), passB64: btoa("vidu123sft") },
          { name:'', thumbnail:'https://i.pinimg.com/736x/42/9d/84/429d847241cfba744292224956707f45.jpg', type:'playlist', idB64: btoa("PL9zX0VbNmKiEmn6j0O870XYlFRasYABD2&si=vjOY0tK0Em5LZvsf"), passB64: btoa("vidu123sft") }
        ]
      },
      {
        id: 3,
        name: 'ICT',
        thumbnail: 'https://i.pinimg.com/736x/81/f4/0d/81f40de2906f0c61f2f17d6db61d7271.jpg',
        videos: [
          { name:'', thumbnail:'https://i.pinimg.com/736x/81/f4/0d/81f40de2906f0c61f2f17d6db61d7271.jpg', type:'playlist', idB64: btoa("PL9zX0VbNmKiFUhYSDfiEVVMuBbc2AiwpC&si=1g80otmZOXdp1hE_"), passB64: btoa("vidu123ict") }
        ]
      }
    ]
  }
];

function b64decode(s){ try{ return atob(s); }catch(e){ return s; } }
function escapeHtml(s){ return (s||'').replace(/[&<>"'`]/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;","`":"&#96;"}[ch])); }

function renderPlaylists(){
  const ul = document.getElementById('playlist-list');
  if(!ul) return;
  ul.innerHTML = '';
  if(!playlists || playlists.length === 0){ ul.innerHTML = '<li class="muted">No playlists available.</li>'; return; }
  playlists.forEach(pl=>{
    const li = document.createElement('li'); li.className='list-item ripple';
    li.innerHTML = `<img src="${escapeHtml(pl.thumbnail)}" alt="${escapeHtml(pl.name)}" /><span class="title">${escapeHtml(pl.name)}</span>`;
    li.addEventListener('click', (ev)=>{ spawnRipple(ev, li); showPlaylistVideos(pl); });
    attachTilt(li);
    ul.appendChild(li);
  });
  ul.style.display = 'flex';
}

function showPlaylistVideos(pl, skipPush){
  const ul = document.getElementById('playlist-list');
  const container = document.getElementById('playlist-videos');
  if(!container || !ul) return;
  if(!window.__viduGlobal) window.__viduGlobal = {};
  if(!window.__viduGlobal.playlistStack) window.__viduGlobal.playlistStack = [];
  if(!skipPush){ window.__viduGlobal.playlistStack.push(window.__viduGlobal.currentPl || null); }
  window.__viduGlobal.currentPl = pl;
  ul.style.display = 'none';
  container.style.display = 'block';
  container.innerHTML = `<h3 style="text-align:center;color:#fff;">${escapeHtml(pl.name)}</h3>`;
  const vids = document.createElement('ul'); vids.className='list-container';
  (pl.videos||[]).forEach(v=>{
    const vli = document.createElement('li'); vli.className='list-item ripple';
    const thumb = v.thumbnail || '';
    vli.innerHTML = `<img src="${escapeHtml(thumb)}" alt="${escapeHtml(v.name)}" /><span class="title">${escapeHtml(v.name)}</span>`;
    if(v && Array.isArray(v.videos)){ vli.addEventListener('click',(ev)=>{ spawnRipple(ev, vli); showPlaylistVideos(v); }); }
    else { vli.addEventListener('click',(ev)=>{ spawnRipple(ev, vli); openPasswordModal(v); }); }
    attachTilt(vli); vids.appendChild(vli);
  });
  const back = document.createElement('div'); back.style.textAlign='center'; back.style.marginTop='16px';
  back.innerHTML = `<button id="back-to-playlists" class="btn secondary">Back</button>`;
  container.appendChild(vids); container.appendChild(back);
  document.getElementById('back-to-playlists').onclick = ()=>{
    const prev = (window.__viduGlobal.playlistStack && window.__viduGlobal.playlistStack.length) ? window.__viduGlobal.playlistStack.pop() : null;
    if(prev === null){ ul.style.display='flex'; container.style.display='none'; window.__viduGlobal.currentPl = null; }
    else { showPlaylistVideos(prev, true); }
  };
}

function spawnRipple(ev,target){ const rect = target.getBoundingClientRect(); const drop = document.createElement('div'); drop.className = 'drop'; drop.style.left = (ev.clientX - rect.left) + 'px'; drop.style.top = (ev.clientY - rect.top) + 'px'; target.appendChild(drop); setTimeout(()=> drop.remove(),700); }
function attachTilt(card){ if(!card) return; const img = card.querySelector('img'); function onMove(e){ if(window.__viduGlobal && window.__viduGlobal.visualsPaused) return; const r = card.getBoundingClientRect(); const px = (e.clientX - r.left) / r.width; const py = (e.clientY - r.top) / r.height; const rx = (py - 0.5) * 10; const ry = (px - 0.5) * -10; card.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(6px)`; if(img) img.style.transform = `translateZ(26px) scale(1.06) translateY(${(0.5-py)*6}px)`; } function onLeave(){ card.style.transform = ''; if(img) img.style.transform = ''; } card.addEventListener('pointermove', onMove, {passive:true}); card.addEventListener('pointerleave', onLeave, {passive:true}); }

 // Modal + password + player mount logic
let currentItem = null;
function createModal(){
  const root = document.getElementById('modal-root');
  root.innerHTML = `
    <div class="modal-backdrop" id="modal-backdrop">
      <div class="modal" role="dialog" aria-modal="true">
        <div class="controls">
          <div>
            <strong id="modal-title">Locked</strong>
            <div class="muted" id="modal-subtitle" style="color:#bbb;font-size:12px;"></div>
          </div>
          <div>
            <button id="modal-close" class="btn secondary">Close</button>
          </div>
        </div>

        <div id="modal-body">
          <div id="password-block">
            <div style="color:#bbb;margin-bottom:8px;">This item is password-protected. Enter password to unlock and play.</div>
            <div class="password-row">
              <input id="password-input" type="password" placeholder="Enter password" />
              <button id="password-submit" class="btn">Unlock</button>
            </div>
            <div id="password-error" style="margin-top:8px;color:#f66;display:none;"></div>
          </div>

          <div id="player-block" style="display:none;margin-top:12px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
              <div style="color:#bbb" id="now-playing-label">Now playing</div>
              <div>
                <button id="close-player" class="btn">Close</button>
              </div>
            </div>

            <!-- Player mount point (do not rename) -->
            <div id="player-wrap"></div>

            <div id="playlist-list-wrap" style="display:none;margin-top:12px;">
              <div class="muted">Playlist contents</div>
              <div class="playlist-list" id="playlist-video-list"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
  document.getElementById('modal-close').onclick = closeModal;
  document.getElementById('close-player').onclick = closeModal;
  document.getElementById('password-submit').onclick = onPasswordSubmit;
  document.getElementById('password-input').onkeydown = (e)=>{ if(e.key === 'Enter') onPasswordSubmit(); };
  document.getElementById('modal-backdrop').onclick = function(e){ if(e.target === this) closeModal(); };
}

function openPasswordModal(item){
  currentItem = item;
  const root = document.getElementById('modal-root');
  root.style.display = 'block';
  document.getElementById('modal-title').textContent = item.name || 'Protected';
  document.getElementById('modal-subtitle').textContent = (item.type || 'video') + ' — password required';
  document.getElementById('password-input').value = '';
  document.getElementById('password-error').style.display = 'none';
  document.getElementById('password-block').style.display = 'block';
  document.getElementById('player-block').style.display = 'none';
  const plwrap = document.getElementById('playlist-list-wrap');
  if(plwrap) plwrap.style.display='none';
}

function closeModal(){
  const root = document.getElementById('modal-root');
  if(root) root.style.display = 'none';
  try{ if(window.destroyViduPlayer) window.destroyViduPlayer(); }catch(e){}
}

function onPasswordSubmit(){
  if(!currentItem) return;
  const passEl = document.getElementById('password-input');
  const err = document.getElementById('password-error');
  if(!passEl) return;
  const val = passEl.value || '';
  try{
    const b = btoa(val);
    if(b === (currentItem.passB64||'')){
      // unlocked
      document.getElementById('password-block').style.display = 'none';
      // if this is a playlist, fetch contents and mount the player
      if(currentItem.type === 'playlist'){
        showPlaylistInsideModal(currentItem);
      } else {
        // video - mount player directly
        const wrap = document.getElementById('player-wrap'); if(wrap) wrap.innerHTML = '';
        document.getElementById('player-block').style.display = 'block';
        document.getElementById('now-playing-label').textContent = currentItem.name || 'Now playing';
        const vid = (b64decode(currentItem.idB64 || '') || '').split('&')[0];
        if(window.showViduPlayer) window.showViduPlayer(vid).catch(err2=> {
          console.error('showViduPlayer failed', err2);
          const wrap2 = document.getElementById('player-wrap'); if(wrap2) wrap2.innerHTML = `<div class="muted">Failed to load player: ${escapeHtml(err2.message||'')}</div>`;
        });
      }
    } else {
      err.style.display='block';
      err.textContent = 'Incorrect password — try again.';
    }
  }catch(e){
    err.style.display='block';
    err.textContent = 'Error checking password.';
    console.error(e);
  }
}

// YouTube playlist fetching
const YT_API_KEY = 'AIzaSyDFyNxJJ_LbTEwLZkcLZ0wT3bDNfGcHCAI';
async function fetchPlaylistVideos(playlistId){
  if(!YT_API_KEY || YT_API_KEY === 'YOUR_API_KEY_HERE') throw new Error('No API key configured.');
  const items=[]; let pageToken='';
  do{
    const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${encodeURIComponent(playlistId)}&key=${encodeURIComponent(YT_API_KEY)}` + (pageToken?`&pageToken=${pageToken}`:'');
    const res = await fetch(url);
    if(!res.ok){ const txt = await res.text().catch(()=>null); throw new Error('YouTube API error: '+res.status+' '+res.statusText+' '+(txt||'')); }
    const data = await res.json();
    (data.items||[]).forEach(it=>{
      const sn = it.snippet || {};
      if(sn.resourceId && sn.resourceId.videoId){
        const thumb = (sn.thumbnails && (sn.thumbnails.high||sn.thumbnails.medium||sn.thumbnails.default))||{};
        items.push({ videoId: sn.resourceId.videoId, title: sn.title||'Untitled', thumb: thumb.url||`https://img.youtube.com/vi/${sn.resourceId.videoId}/hqdefault.jpg` });
      }
    });
    pageToken = data.nextPageToken || '';
  } while(pageToken);
  return items;
}

async function showPlaylistInsideModal(item){
  const rawId = b64decode(item.idB64);
  const playlistId = rawId.split('&')[0];
  window.__viduGlobal.visualsPaused = true;
  window.dispatchEvent(new CustomEvent('vidu:visuals:pause', { detail:{ reason:'playlist-load' } }));

  try{
    const videos = await fetchPlaylistVideos(playlistId);
    if(!videos.length){
      const wrap = document.getElementById('player-wrap');
      if(wrap) wrap.innerHTML = `<div class="muted">No videos found or playlist is private.</div>`;
      document.getElementById('player-block').style.display='block';
      return;
    }

    let listWrap = document.getElementById('playlist-video-list');
    if(!listWrap){
      const wrapper = document.createElement('div');
      wrapper.id = 'playlist-list-wrap';
      wrapper.style.marginTop = '12px';
      wrapper.innerHTML = `<div class="muted">Playlist contents</div><div class="playlist-list" id="playlist-video-list"></div>`;
      const playerBlock = document.getElementById('player-block');
      if(playerBlock) playerBlock.appendChild(wrapper);
      listWrap = document.getElementById('playlist-video-list');
    }

    if(listWrap) listWrap.innerHTML = '';
    videos.forEach(v=>{
      const li = document.createElement('div'); li.className = 'list-item';
      li.setAttribute('data-video-id', v.videoId);
      li.style.display='flex'; li.style.alignItems='center'; li.style.gap='12px'; li.style.padding='8px';
      li.innerHTML = `<img src="${escapeHtml(v.thumb)}" alt="${escapeHtml(v.title)}" style="width:120px;height:68px;object-fit:cover;border-radius:6px;" /><div style="flex:1;"><div class="title" style="font-size:13px;">${escapeHtml(v.title)}</div></div>`;
      li.onclick = ()=> {
        document.getElementById('now-playing-label').textContent = v.title || 'Now playing';
        if(window.showViduPlayer) window.showViduPlayer(v.videoId).catch(err => {
          console.error('showViduPlayer failed', err);
          const wrap = document.getElementById('player-wrap'); if(wrap) wrap.innerHTML = `<div class="muted">Failed to load player: ${escapeHtml(err.message || '')}</div>`;
        });
      };
      listWrap.appendChild(li);
    });

    document.getElementById('player-block').style.display='block';
    const outer = document.getElementById('playlist-list-wrap'); if(outer) outer.style.display='block';
    document.getElementById('now-playing-label').textContent = videos[0].title || 'Now playing';
    if(window.showViduPlayer) window.showViduPlayer(videos[0].videoId).catch(err => {
      console.error('showViduPlayer failed', err);
      const wrap = document.getElementById('player-wrap'); if(wrap) wrap.innerHTML = `<div class="muted">Failed to load player: ${escapeHtml(err.message || '')}</div>`;
    });
  } catch(err){
    console.error('Playlist fetch error', err);
    const wrap = document.getElementById('player-wrap');
    if(wrap) wrap.innerHTML = `<div class="muted">Failed to fetch playlist: ${escapeHtml(err.message || '')}</div>`;
    document.getElementById('player-block').style.display='block';
  }
}
</script>
</body>
</html>
